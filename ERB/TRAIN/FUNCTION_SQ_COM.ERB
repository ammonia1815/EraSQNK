;≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡
;主に조교中に使用する関数
;≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡
;-------------------------------------------------
;ひょっとしたら最も重요정かもしれない値である무드の計算
;最低が０で最高は160
;-------------------------------------------------
@MOOD()
#FUNCTION

;基本はTFLAG:33
LOCAL = TFLAG:33

;순종と욕정で25まで
LOCAL:1 = PALAM:순종 + PALAM:욕정
SELECTCASE LOCAL:1
CASE IS > 240000
	LOCAL += 25
;MAX25
CASE IS > 120000
	LOCAL += (LOCAL:1 - 120000)/24000 + 20
;MAX20
CASE IS > 60000
	LOCAL += (LOCAL:1 - 60000)/12000 + 15
;MAX15
CASE IS > 30000
	LOCAL += (LOCAL:1 - 30000)/6000 + 10
;MAX10
CASE IS > 10000
	LOCAL += (LOCAL:1 - 10000)/4000 + 5
;MAX5
CASEELSE
	LOCAL += LOCAL:1/2000
ENDSELECT

;공포, 반감でキツいマイナス보정. 억울はちょっと軽いけどやはりマイナス
LOCAL -= (UP_PALAM(10) + UP_PALAM(11) )/100 + GET_PALAMLV(UP_PALAM(13) )*2

;호감도で30まで보정
SELECTCASE CFLAG:2
CASE IS > 3000
	LOCAL += LIMIT( (CFLAG:2 - 3000)/1000 + 15, 15, 30)
CASE IS > 1500
	LOCAL += (CFLAG:2 - 1500)/300 + 10
CASE IS > 500
	LOCAL += (CFLAG:2 - 500)/200 + 5
CASEELSE
	LOCAL += CFLAG:2/100
ENDSELECT

LOCAL = LIMIT(LOCAL, 0, 160)

RETURNF LOCAL

;-------------------------------------------------
;무드の値をハートマークの個数に変換
;-------------------------------------------------
@MOOD_HEART()
#FUNCTION
LOCAL = (MOOD() + 20) / 30
RETURNF LOCAL

;-------------------------------------------------
;커맨드선택による무드増減の체크
;ARGには커맨드番号が代入される（通常はSELECTCOM）
;-------------------------------------------------
@MOOD_COM, ARG
VARSET LOCAL

SELECTCASE ARG
;애무
CASE 0
	LOCAL += 5
;애무커맨드
CASE 5, 7
	LOCAL += 3
;키스
CASE 6
	LOCAL += 5
	;開幕키스はボーナス
	SIF NUM("턴수") == 0
		LOCAL += 25
;인서트
CASE 60 TO 89
	SELECTCASE ARG
	;대면좌위
	CASE 63, 73
		LOCAL += 4
	ENDSELECT

	SIF COND("마음에 드는 체위中")
		LOCAL += 4
ENDSELECT

;初回선택で無いなら効果は半減
SIF CHOSECOM(SELECTCOM)
	LOCAL /= 2

TFLAG:33 += LOCAL


;-------------------------------------------------
;主に플레이が가능かどうかだが, 他にも様々な内容のものを判定する
;고통なく受け入れられるかの判定にも多用する
;-------------------------------------------------
@CHECK(ARGS, ARG, ARG:1)
#FUNCTION
#DIM BUG_CHECK = 0
VARSET BUG_CHECK
VARSET LOCAL
SIF ARG == 0 && TARGET
	ARG = TARGET

;인서트や삽입系は共通部分が多いので上下に分ける
SELECTCASE ARGS
CASE "손가락넣기", "바이브"
	LOCAL = MAX(SIZE("바이브", ARG), 1)
CASE "Ｖ인서트"
	LOCAL = MAX(SIZE("페니스", PLAYER), 1)
	;Ｖ성교경험がある程度필요
	SIF TALENT:ARG:호색 == 0 && EXP:ARG:Ｖ성교경험 < MAX(EXP_LV(2*(LOCAL - TALENT:ARG:호색) - ABL:ARG:Ｖ확장), 1)
		RETURNF 0
CASE "Ａ손가락넣기", "Ａ바이브"
	LOCAL = MAX(SIZE("Ａ바이브", ARG), 1)
CASE "Ａ인서트"
	LOCAL = MAX(SIZE("페니스", PLAYER), 1)
	;Ａ성교경험がある程度필요
	SIF TALENT:ARG:호색 == 0 && EXP:ARG:Ａ성교경험 < MAX(EXP_LV(LOCAL*2 - ABL:ARG:Ａ확장), 1)
		RETURNF 0
CASE "요도인서트"
	LOCAL = MAX(SIZE("페니스", PLAYER), 1)
	;요도성교경험がある程度필요
	SIF EXP:ARG:요도성교경험 < MAX(EXP_LV(LOCAL*2 - ABL:ARG:요도확장), 1)
		RETURNF 0
CASE "피스트"
	SELECTCASE SELECTCOM
	CASE 141
		ARGS = Ｖ피스트
		LOCAL = SIZE("피스트", PLAYER)
	CASE 142
		ARGS = Ａ피스트
		LOCAL = SIZE("피스트", PLAYER)
	CASE 143
		ARGS = 양구멍피스트
		LOCAL = SIZE("Ｗ피스트", PLAYER)
	ENDSELECT
CASE "Ｖ피스트", "Ａ피스트"
	LOCAL = SIZE("피스트", PLAYER)
CASE "양구멍피스트"
	LOCAL = SIZE("Ｗ피스트", PLAYER)
CASE "용간"
	SELECTCASE SELECTCOM
	CASE 304
		ARGS = Ｖ용간
	CASE 305
		ARGS = Ａ용간
	ENDSELECT
	LOCAL = SIZE("드래곤")
CASE "Ｖ용간", "Ａ용간"
	LOCAL = SIZE("드래곤")
CASEELSE
    BUG_CHECK = 333
ENDSELECT


SELECTCASE ARGS
CASE "손가락넣기", "바이브", "Ｖ인서트", "Ｖ피스트", "Ｖ용간"
	SELECTCASE ARG
	CASE PLAYER
		SIF ABL:ARG:Ｖ확장 < LOCAL
			RETURNF 0
	CASE TARGET
		SIF CUP:ARG:쾌Ｖ >= 3000 && MAX(CUP:ARG:고통, CUP:ARG:공포/10, CUP:ARG:반감) < 300
			RETURNF 1
		;반감が強いとダメ
		SIF CUP:ARG:반감 >= 500
			RETURNF 0
		;호색でない人はうるさい
		IF TALENT:ARG:호색 == 0
			;侵入してくるモノを気持ちよく受け入れられるかを判定
			SIF MIN(MAX(ABL:ARG:Ｖ감각, ABL:ARG:마조끼), ABL:ARG:Ｖ확장) < MAX(LOCAL, 1)
				RETURNF 0
			;経験がある程度필요
			SIF EXP:ARG:Ｖ경험 < MAX(EXP_LV(LOCAL*2 - ABL:ARG:Ｖ확장), 1)
				RETURNF 0
			;Ｖ윤がある程度필요
			SELECTCASE ARGS
			CASE "Ｖ인서트"
				SIF PALAM:ARG:Ｖ윤 + PALAM:PLAYER:Ｐ윤 < PALAM_LV(LOCAL - ABL:ARG:Ｖ확장 + 2)
					RETURNF 0
			CASEELSE
				SIF PALAM:ARG:Ｖ윤 < PALAM_LV(LOCAL - ABL:ARG:Ｖ확장 + 2)
					RETURNF 0
			ENDSELECT
		ENDIF
		;아픔が少ないことが필요
		SIF CUP:ARG:고통 >= 500 + ABL:ARG:마조끼*100 + TALENT:ARG:마조*500
			RETURNF 0
	ENDSELECT
	RETURNF 1
CASE "Ａ손가락넣기", "Ａ바이브", "Ａ인서트", "Ａ피스트", "Ａ용간"
	SELECTCASE ARG
	CASE PLAYER
		SIF ABL:ARG:Ａ확장 < LOCAL
			RETURNF 0
	CASE TARGET
		SIF CUP:ARG:쾌Ａ >= 3000 && MAX(CUP:ARG:고통, CUP:ARG:공포/10, CUP:ARG:반감) < 300
			RETURNF 1
		;반감が強いとダメ
		SIF CUP:ARG:반감 >= 500
			RETURNF 0
		;호색でない人はうるさい
		IF TALENT:ARG:호색 == 0
			;侵入してくるモノを気持ちよく受け入れられるかを判定
			SIF MIN(MAX(ABL:ARG:Ａ감각, ABL:ARG:마조끼), ABL:ARG:Ａ확장) < MAX(LOCAL, 1)
				RETURNF 0
			;経験がある程度필요
			SIF EXP:ARG:Ａ경험 < MAX(EXP_LV(LOCAL*2 - ABL:ARG:Ａ확장), 1)
				RETURNF 0
			;Ａ윤がある程度필요
			SELECTCASE ARGS
			CASE "Ａ인서트"
				SIF PALAM:ARG:Ａ윤 + PALAM:PLAYER:Ｐ윤 < PALAM_LV(LOCAL - ABL:ARG:Ａ확장 + 2)
					RETURNF 0
			CASEELSE
				SIF PALAM:ARG:Ａ윤 < PALAM_LV(LOCAL - ABL:ARG:Ａ확장 + 2)
					RETURNF 0
			ENDSELECT
		ENDIF
		;아픔が少ないことが필요
		SIF CUP:ARG:고통 >= 500 + ABL:ARG:마조끼*100 + TALENT:ARG:마조*500
			RETURNF 0
	ENDSELECT
	RETURNF 1
CASE "요도인서트"
	;快楽が強くて고통などが少ないならＯＫ
	SIF CUP:ARG:쾌Ｃ >= 3000 && MAX(CUP:ARG:고통, CUP:ARG:공포/10, CUP:ARG:반감) < 300
		RETURNF 1
	;반감が強いとダメ
	SIF CUP:ARG:반감 >= 500
		RETURNF 0
	;도착적でない人はうるさい
	IF TALENT:ARG:도착적 == 0
		;侵入してくるモノを気持ちよく受け入れられるかを判定
		SIF ABL:ARG:요도확장 + TALENT:ARG:요도광 <= MAX(LOCAL, 1)
			RETURNF 0
	ENDIF
	;아픔が少ないことが필요
	SIF CUP:ARG:고통 >= 500 + ABL:ARG:마조끼*100 + TALENT:ARG:마조*500
		RETURNF 0
	RETURNF 1
CASE "양구멍피스트"
	SIF MIN(CUP:ARG:쾌Ｖ, CUP:ARG:쾌Ａ) >= 3000 && MAX(CUP:ARG:고통, CUP:ARG:공포/10, CUP:ARG:반감) < 300
		RETURNF 1
	;반감が強いとダメ
	SIF CUP:ARG:반감 >= 500
		RETURNF 0
	SIF MIN(MAX(ABL:ARG:Ｖ감각, ABL:ARG:마조끼), ABL:ARG:Ｖ확장) < MAX(LOCAL, 1)
		RETURNF 0
	SIF MIN(MAX(ABL:ARG:Ａ감각, ABL:ARG:마조끼), ABL:ARG:Ａ확장) < MAX(LOCAL, 1)
		RETURNF 0
	SIF MIN(EXP:ARG:Ｖ경험, EXP:ARG:Ａ경험) < EXP_LV(LOCAL)
		RETURNF 0

	SELECTCASE ARG
	CASE TARGET
		;고통が殆どないならＯＫ
		SIF CUP:ARG:고통 < 100
			RETURNF 1
		;Ｖ윤がある程度필요
		SIF PALAM:ARG:Ｖ윤 < PALAM_LV(LOCAL - ABL:ARG:Ｖ확장 + 2)
			RETURNF 0
		;Ａ윤がある程度필요
		SIF PALAM:ARG:Ａ윤 < PALAM_LV(LOCAL - ABL:ARG:Ａ확장 + 2)
			RETURNF 0
		;아픔が少ないことが필요
		SIF CUP:ARG:고통 >= 500 + ABL:ARG:마조끼*100 + TALENT:ARG:마조*500
			RETURNF 0
	ENDSELECT
	RETURNF 1
CASE "Ｖ두개삽입"
	SIF ABL:Ｖ확장 <= SIZE("Ｗ페니스") || ABL:Ｖ감각 < 3
		RETURNF 0
	RETURNF 1
CASE "Ａ두개삽입"
	SIF ABL:Ａ확장 <= SIZE("Ｗ페니스") || ABL:Ａ감각 < 3
		RETURNF 0
	RETURNF 1
CASE "양구멍삽입"
	SIF MIN(ABL:Ｖ확장, ABL:Ａ확장) < 2 || MIN(ABL:Ｖ감각, ABL:Ａ감각) < 3
		RETURNF 0
	RETURNF 1
CASE "요도플레이"
	;반감が強いとダメ
	SIF CUP:ARG:반감 >= 500
		RETURNF 0
	;고통が殆どないならＯＫ
	SIF CUP:ARG:고통 < 100
		RETURNF 1
	;아픔が少ないことが필요
	SIF CUP:ARG:고통 >= 500 + ABL:ARG:마조끼*100 + TALENT:ARG:마조*500
		RETURNF 0
	RETURNF 1
CASE "喉姦"
	SIF ARG:1 == 0 && PLAYER > 0
		ARG:1 = PLAYER
	;喉まで受け入れられるかを判定. 
	SIF ABL:ARG:목확장 <= SIZE("페니스", ARG:1)
		RETURNF 0
	SIF TALENT:ARG:구토반사내성 == 0 && EXP:ARG:펠라경험 < MIN(EXP_LV(SIZE("페니스", ARG:1) + 2), 100)
		RETURNF 0
	LOCAL = ABL:ARG:목확장 - SIZE("페니스", ARG:1) + TALENT:ARG:구토반사내성 + 1
CASE "입内방뇨", "질内방뇨", "자궁内방뇨", "온천관장", "유内방뇨", "방광内방뇨"
	SIF ABL:ARG:마조끼 >= 3
		RETURNF 1
	;SIF ABL:ARG:마조끼 + TALENT:ARG:도착적 + TALENT:ARG:음란 + TALENT:ARG:불결무시*2 + TALENT:ARG:악취둔감 - TALENT:ARG:악취민감 >= 5
	;	RETURNF 1
	SIF CUP:ARG:공포 + CUP:ARG:반감 + CUP:ARG:억울 < 500
		RETURNF 1
	SIF MAX(CUP:ARG:공포, CUP:ARG:반감, CUP:ARG:억울) < 300
		RETURNF 1
CASE "음모관리", "겨털관리"
	SIF MAX(ABL:ARG:노출벽, ABL:ARG:마조끼) >= 3
		RETURNF 1
CASE "性別による拒絶反応"
	SIF ARG:1 == 0 && PLAYER > 0
		ARG:1 = PLAYER
	SIF TALENT:ARG:여자 && TALENT:(ARG:1):여자 && ABL:ARG:레즈끼 == 0
		RETURNF 1
	SIF TALENT:ARG:남자 && TALENT:(ARG:1):남자 && ABL:ARG:ＢＬ끼 == 0
		RETURNF 1
;ARGのＶがARG:1の페니스にJUST FITしている度合いを判定します
CASE "ＶJUST FIT"
	SIF ARG:1 == 0 && PLAYER > 0
		ARG:1 = PLAYER
	SIF ABL:ARG:Ｖ놀림 < 4 || TALENT:ARG:Ｖ손상 || CALCF("Ｖ이력：기억母数", ARG) < 100
		RETURNF 0

	LOCAL = CALCF("Ｖ이력：Ｐ기억", ARG, ARG:1) * 100 / CALCF("Ｖ이력：기억母数", ARG)
	;50이상でJUST FITなので、それ未満は意味が無いので0を返す
	SIF LOCAL < 50
		RETURNF 0
CASE "ＡJUST FIT"
	SIF ARG:1 == 0 && PLAYER > 0
		ARG:1 = PLAYER
	SIF ABL:ARG:Ａ놀림 < 4 || TALENT:ARG:Ａ손상 || CALCF("Ａ이력：기억母数", ARG) < 100
		RETURNF 0

	LOCAL = CALCF("Ａ이력：Ｐ기억", ARG, ARG:1) * 100 / CALCF("Ａ이력：기억母数", ARG)
	;50이상でJUST FITなので、それ未満は意味が無いので0を返す
	SIF LOCAL < 50
		RETURNF 0
;Ｖに最後に入れたもののサイズを返す。入っていた바이브のサイズ判定などに
CASE "Ｖ最新受け入れ사이즈"
	RETURNF TOINT(EXTSTR(CSTR:ARG:V수용이력, "：", "＠") )
CASE "Ａ最新受け入れ사이즈"
	RETURNF TOINT(EXTSTR(CSTR:ARG:A수용이력, "：", "＠") )
CASEELSE
    BUG_CHECK += 333
ENDSELECT
SIF BUG_CHECK == 666
    THROW "%ARGS%" 를 찾을 수 없습니다.
RETURNF LOCAL

;-------------------------------------------------
;커맨드に対応した装備品の値を返す関数
;CHECK_TEQUIP(31)ならTEQUIP:바이브の値を返す
;-------------------------------------------------
@CHECK_TEQUIP(ARG, ARG:1)
#FUNCTION
SIF ARG < 0
	RETURNF 0
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
SELECTCASE ARG
CASE 31
	RETURNF TEQUIP:(ARG:1):바이브
CASE 33
	RETURNF TEQUIP:(ARG:1):애널바이브
CASE 34
	RETURNF TEQUIP:(ARG:1):클리캡
CASE 35
	RETURNF TEQUIP:(ARG:1):니플캡
CASE 36
	RETURNF TEQUIP:(ARG:1):착유기
CASE 37
	RETURNF TEQUIP:(ARG:1):오나홀
CASE 38
	RETURNF TEQUIP:(ARG:1):샤워
CASE 39
	RETURNF TEQUIP:(ARG:1):로터삽입
CASE 133
	RETURNF TEQUIP:(ARG:1):아이마스크
CASE 134
	RETURNF TEQUIP:(ARG:1):구속
CASE 135
	RETURNF TEQUIP:(ARG:1):재갈
CASE 136
	RETURNF TEQUIP:(ARG:1):관장
CASE 137
	RETURNF TEQUIP:(ARG:1):확장벌룬
CASE 149
	RETURNF TEQUIP:(ARG:1):카테터
ENDSELECT
RETURNF 0

;-------------------------------------------------
;汚れ関連の関数など
;-------------------------------------------------
;-------------------------------------------------
;汚れを数値でなく名称で参照するための関数
;ARGに汚れの数値を入れ, ARGS:0～に체크する汚れを代入する
;例）CHECK_STAIN(STAIN:PLAYER:Ｐ, "정액", "Ａ") だとPLAYERの페니스に정액汚れorＡ汚れがあれば０以外を返す
;-------------------------------------------------
@CHECK_STAIN(ARG, ARGS:0, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5, ARGS:6)
#FUNCTION
#DIM LCOUNT
VARSET LOCAL
FOR LCOUNT, 0, 7
	SELECTCASE ARGS:LCOUNT
	CASE "Ｖ"
		LOCAL = GETBIT(ARG, 0)
	CASE "Ｐ"
		LOCAL = GETBIT(ARG, 1)
	CASE "정액", "精"
		LOCAL = GETBIT(ARG, 2)
	CASE "Ａ"
		LOCAL = GETBIT(ARG, 3)
	CASE "乳"
		LOCAL = GETBIT(ARG, 4)
	CASE "尿"
		LOCAL = GETBIT(ARG, 5)
	CASE "촉수", "触"
		LOCAL = GETBIT(ARG, 6)
	CASE "蒸れ", "蒸"
		LOCAL = GETBIT(ARG, 7)
	CASE "濡れ", "濡"
		LOCAL = GETBIT(ARG, 8)
	CASE "破瓜の血", "血"
		LOCAL = GETBIT(ARG, 10)
	CASE "Ｖ치구"
		LOCAL = GETBIT(ARG, 20)
	CASE "Ｐ치구"
		LOCAL = GETBIT(ARG, 21)
	CASE "치구"
		LOCAL = GETBIT(ARG, 20) | GETBIT(ARG, 21)
	CASE ""
	    ;비워둠
	CASEELSE
        THROW "%ARGS:LCOUNT%" 를 찾을 수 없습니다.
	ENDSELECT
	SIF LOCAL
		RETURNF LOCAL
NEXT
RETURNF LOCAL

;-------------------------------------------------
;汚れを数値でなく名称で参照するための関数
;キャラARGの部位ARGSに落とせる汚れが付着しているかどうかを체크する. ARGはTARGETの場合には省略가능
;例）CHECK_ADD_STAIN("Ｖ", PLAYER)は<Ｖ>汚れ以外のものがあったら０より大きい値を返す
;-------------------------------------------------
@CHECK_ADD_STAIN(ARGS, ARG)
#FUNCTION

SIF ARG < 0
	RETURNF 0
SIF ARG == 0 && TARGET
	ARG = TARGET

;値が０なら汚れは無し
SIF STAIN:ARG:ARGS == 0
	RETURNF 0

SELECTCASE ARGS
CASE "Ｐ"
	;真性包茎はＰ치구があるのが通常
	IF COND("진성포경", ARG)
		IF STAIN:ARG:Ｐ == SET_STAIN(0, "Ｐ") || STAIN:ARG:Ｐ == SET_STAIN(0, "Ｐ치구") || STAIN:ARG:Ｐ == SET_STAIN(0, "Ｐ") + SET_STAIN(0, "Ｐ치구")
		ELSE
			RETURNF 1
		ENDIF
	ELSE
		SIF STAIN:ARG:ARGS != SET_STAIN(0, ARGS)
			RETURNF 1
	ENDIF
CASEELSE
	SIF STAIN:ARG:ARGS != SET_STAIN(0, ARGS)
		RETURNF 1
ENDSELECT
RETURNF 0

;-------------------------------------------------
;汚れを数値でなく名称でセットする関数
;例）STAIN:Ｖ = SET_STAIN(STAIN:Ｖ, "정액") だとTARGETのＶに정액汚れを加える
;これはSETBIT STAIN:Ｖ, 2 や STAIN:Ｖ |= 1p2に等しいが, 直感的にわかりやすくするための関数である
;もちろんSTAIN:Ｖ = SET_STAIN(STAIN:PLAYER:Ｐ, "정액")のようにも使えるが今はあまり推奨しない
;-------------------------------------------------
@SET_STAIN(ARG, ARGS)
#FUNCTION

SELECTCASE ARGS
CASE "Ｖ"
	SETBIT ARG, 0
CASE "Ｐ"
	SETBIT ARG, 1
CASE "정액", "精"
	SETBIT ARG, 2
CASE "Ａ"
	SETBIT ARG, 3
CASE "모유", "乳"
	SETBIT ARG, 4
CASE "尿"
	SETBIT ARG, 5
CASE "촉수", "触"
	SETBIT ARG, 6
CASE "蒸れ", "蒸"
	SETBIT ARG, 7
CASE "濡れ", "濡"
	SETBIT ARG, 8
CASE "破瓜の血", "血"
	SETBIT ARG, 10
CASE "Ｖ치구"
	SETBIT ARG, 20
CASE "Ｐ치구"
	SETBIT ARG, 21
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF ARG

;-------------------------------------------------
;汚れをリセットするデフォルトの関数RESET_STAINの확장版
;ARGSには"全部", "Ｍ", "손", "Ｐ", "Ｖ", "Ａ", "Ｂ"のどれかが使える
;ARGは대상のキャラ
;노폐물については現状だとＰとＶのみ
;-------------------------------------------------
@RESET_STAIN_EX, ARGS, ARG
SELECTCASE ARGS
CASE "全部"
	;페니스に垢あり
	IF CHECK_STAIN(STAIN:ARG:Ｐ, "Ｐ치구")
		RESET_STAIN ARG
		;真性包茎は汚れたまま
		IF COND("진성포경", ARG)
			STAIN:ARG:Ｐ = SET_STAIN(STAIN:ARG:Ｐ, "Ｐ치구")
		ELSE
			CLEARBIT BASE:ARG:노폐물, 0
		ENDIF
	ELSE
		RESET_STAIN ARG
		CLEARBIT BASE:ARG:노폐물, 0
	ENDIF
	CLEARBIT BASE:ARG:노폐물, 1
CASE "Ｍ"
	STAIN:ARG:Ｍ = 0
CASE "손"
	STAIN:ARG:손 = 0
CASE "Ｐ"
	;페니스に垢あり
	IF CHECK_STAIN(STAIN:ARG:Ｐ, "Ｐ치구")
		STAIN:ARG:Ｐ = SET_STAIN(0, "Ｐ")
		;真性包茎は汚れたまま
		IF COND("진성포경", ARG)
			STAIN:ARG:Ｐ = SET_STAIN(STAIN:ARG:Ｐ, "Ｐ치구")
		ELSE
			CLEARBIT BASE:ARG:노폐물, 0
		ENDIF
	ELSE
		STAIN:ARG:Ｐ = SET_STAIN(0, "Ｐ")
		CLEARBIT BASE:ARG:노폐물, 0
	ENDIF
CASE "Ｖ"
	STAIN:ARG:Ｖ = SET_STAIN(0, "Ｖ")
	CLEARBIT BASE:ARG:노폐물, 1
CASE "Ａ"
	STAIN:ARG:Ａ = SET_STAIN(0, "Ａ")
CASE "Ｂ"
	STAIN:ARG:Ｂ = 0
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT

;-------------------------------------------------
;汚れを数値でなく名称でセットする関数その２
;ARGに대상の캐릭터번호, ARGSに汚れを適用する部位, ARGS:1に汚れを代入して用いる
;これは옷の요정素を加味して汚れを加える関数だが, 加えられる汚れの発生源は外側（옷の上から）なのに注意すること
;例）CALL ADD_STAIN, TARGET, "Ｖ", "정액" だとTARGETのＶに정액汚れを加えるが, 
;　もしも팬티などをはいていたらその汚れは팬티のほうにつくこととなる. 
;-------------------------------------------------
@ADD_STAIN, ARG, ARGS, ARGS:1
IF ARGS == "손" && CHECK_GLOVE("손노출", ARG) == 0
	SELECTCASE ARGS:1
	CASE "정액", "精"
		STAIN:ARG:장갑 = SET_STAIN(STAIN:ARG:장갑, "정액")
	ENDSELECT
ELSEIF ARGS == "팬티" || (ARGS == "Ｖ" && CHECK_CLO("Ｖ노출", ARG) == 0) || (ARGS == "Ａ" && CHECK_CLO("Ａ노출", ARG) == 0)
	;정액or尿汚れなら팬티などにつく
	IF CHECK_CLO("보디슈츠노출", ARG)
		ARGS = 보디슈츠바텀
	ELSEIF CHECK_CLO("겉옷노출", ARG)
		ARGS = 겉옷
	ELSEIF CHECK_CLO("팬티노출", ARG)
		ARGS = 팬티
	ENDIF

	SELECTCASE ARGS:1
	CASE "정액", "精", "尿"
		STAIN:ARG:ARGS = SET_STAIN(STAIN:ARG:ARGS, ARGS:1)
	ENDSELECT
ELSEIF ARGS == "Ｂ" && CHECK_CLO("가슴골노출", ARG) == 0
	;정액汚れなら옷などにつく
	IF EQUIP:ARG:웃옷 && CHECK_SHIRT("가슴골노출", ARG) == 0
		ARGS = 옷
	ELSEIF EQUIP:ARG:보디슈츠 && CHECK_BODYS("가슴골노출", ARG) == 0
		ARGS = 보디슈츠탑
	ENDIF

	SELECTCASE ARGS:1
	CASE "정액", "精"
		STAIN:ARG:ARGS = SET_STAIN(STAIN:ARG:ARGS, "정액")
	ENDSELECT
ELSE
	STAIN:ARG:ARGS = SET_STAIN(STAIN:ARG:ARGS, ARGS:1)
ENDIF

@EQ_STAIN, ARG, ARG:1, ARG:2, ARG:3
;ARGのARG:2の汚れと, ARG:1のARG:3の汚れを同じにする. いままでの
;STAIN:Ｍ |= STAIN:PLAYER:Ｐ
;STAIN:PLAYER:Ｐ |= STAIN:Ｍ
;と놀림時は一緒. 
STAIN:ARG:(ARG:2) |= STAIN_CALC(ARG, ARG:1, ARG:2, ARG:3)
STAIN:(ARG:1):(ARG:3) |= STAIN_CALC(ARG:1, ARG, ARG:3, ARG:2)


;-------------------------------------------------
;汚れが実際に移るかどうかを計算する関数
;-------------------------------------------------
@STAIN_CALC(ARG, ARG:1, ARG:2, ARG:3)
#FUNCTION

VARSET LOCAL
;汚れを与える側の部位が노출しているか？
SELECTCASE ARG:3
;손が노출していない
CASE 1
	IF CHECK_GLOVE("손노출", ARG:1) == 0
		;정액으로 얼룩진 장갑など
		IF CHECK_STAIN(STAIN:(ARG:1):장갑, "정액")
			ARG:3 = 18
		ELSE
			RETURNF 0
		ENDIF
	ENDIF
;Ｖが노출していない
CASE 3
	SIF CHECK_CLO("Ｖ노출", ARG:1) == 0
		RETURNF 0
;Ａが노출していない
CASE 4
	SIF CHECK_CLO("Ａ노출", ARG:1) == 0
		RETURNF 0
;가슴が노출していない
CASE 5
	SIF CHECK_CLO("가슴골노출", ARG:1) == 0
		RETURNF 0
ENDSELECT

;입で페니스をしゃぶっても汚れは移らない
SIF ARG:3 == 0 && ARG:2 == 2
	RETURNF 0

;Ｖ汚れはＡよりも弱い
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "Ｖ")
	;ＡにはＶ汚れのあるＰでないと移らない
	IF ARG:2 == 4
		SIF ARG:3 == 2
			LOCAL = SET_STAIN(LOCAL, "Ｖ")
	;Ｖ汚れはＶorＰからしか付かない
	ELSEIF ARG:3 == 2
		LOCAL = SET_STAIN(LOCAL, "Ｖ")
	ELSEIF ARG:3 == 3
		;목욕후だと綺麗
		SIF TEQUIP:(ARG:1):목욕후 == 0
			LOCAL = SET_STAIN(LOCAL, "Ｖ")
	ENDIF
ENDIF
;Ｐ汚れはＰからしか付かない
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "Ｐ")
	IF ARG:3 == 2
		;목욕후だと綺麗
		SIF TEQUIP:(ARG:1):목욕후 == 0
			LOCAL = SET_STAIN(LOCAL, "Ｐ")
	ENDIF
ENDIF
;정액汚れはＶＡには移らない
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "정액")
	SIF ARG:2 != 3 && ARG:2 != 4
		LOCAL = SET_STAIN(LOCAL, "정액")
ENDIF
;Ａ汚れは強い
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "Ａ")
	;ＶにはＡ汚れのあるＰでないと移らない
	IF ARG:2 == 3
		SIF ARG:3 == 2
			LOCAL = SET_STAIN(LOCAL, "Ａ")
	;舐める際には목욕후なら移らない
	ELSEIF ARG:2 == 0
		;목욕후だと綺麗
		SIF TEQUIP:(ARG:1):목욕후 == 0
			LOCAL = SET_STAIN(LOCAL, "Ａ")
	ELSE
		LOCAL = SET_STAIN(LOCAL, "Ａ")
	ENDIF
ENDIF
;乳汚れは입のみ移る
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "乳")
	SIF ARG:2 == 0
		LOCAL = SET_STAIN(LOCAL, "乳")
ENDIF
;尿汚れは입のみ移る
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "尿")
	SIF ARG:2 == 0
		LOCAL = SET_STAIN(LOCAL, "尿")
ENDIF
;촉수汚れは입のみ移る
IF CHECK_STAIN(STAIN:(ARG:1):(ARG:3), "촉수")
	SIF ARG:2 == 0
		LOCAL = SET_STAIN(LOCAL, "촉수")
ENDIF

;정액汚れが無い場合にはここまで
SIF CHECK_STAIN(LOCAL, "정액") == 0
	RETURNF LOCAL

;汚れが増える側の部位が노출してい無い場合には主に정액汚れのみ移す処理
SELECTCASE ARG:2
;손が노출していない
CASE 1
	IF CHECK_CLO("손노출", ARG) == 0
		STAIN:ARG:장갑 = SET_STAIN(STAIN:ARG:장갑, "정액")
		LOCAL = 0
	ENDIF
;Ｖが노출していない
CASE 3
	IF CHECK_CLO("Ｖ노출", ARG) == 0
		IF CHECK_CLO("보디슈츠노출", ARG)
			STAIN:ARG:보디슈츠바텀 = SET_STAIN(STAIN:ARG:보디슈츠바텀, "정액")
		ELSEIF CHECK_CLO("겉옷노출", ARG)
			STAIN:ARG:겉옷 = SET_STAIN(STAIN:ARG:겉옷, "정액")
		ELSEIF CHECK_CLO("팬티노출", ARG)
			STAIN:ARG:팬티 = SET_STAIN(STAIN:ARG:팬티, "정액")
		ENDIF
		LOCAL = 0
	ENDIF
;Ａが노출していない
CASE 4
	IF CHECK_CLO("Ａ노출", ARG) == 0
		IF CHECK_CLO("보디슈츠노출", ARG)
			STAIN:ARG:보디슈츠바텀 = SET_STAIN(STAIN:ARG:보디슈츠바텀, "정액")
		ELSEIF CHECK_CLO("겉옷노출", ARG)
			STAIN:ARG:겉옷 = SET_STAIN(STAIN:ARG:겉옷, "정액")
		ELSEIF CHECK_CLO("팬티노출", ARG)
			STAIN:ARG:팬티 = SET_STAIN(STAIN:ARG:팬티, "정액")
		ENDIF
		LOCAL = 0
	ENDIF
;가슴が노출していない
CASE 5
	IF CHECK_CLO("가슴골노출", ARG) == 0
		IF EQUIP:ARG:웃옷 && !CHECK_SHIRT("가슴골노출", ARG)
			STAIN:ARG:옷 = SET_STAIN(STAIN:ARG:옷, "정액")
		ELSEIF EQUIP:ARG:보디슈츠 && !CHECK_BODYS("가슴골노출", ARG)
			STAIN:ARG:보디슈츠탑 = SET_STAIN(STAIN:ARG:보디슈츠탑, "정액")
		ENDIF
		LOCAL = 0
	ENDIF
;팬티の場合には정액汚れ以外は移らなくさせる
CASE 10
	IF CHECK_CLO("보디슈츠노출", ARG)
		STAIN:ARG:보디슈츠바텀 = SET_STAIN(STAIN:ARG:보디슈츠바텀, "정액")
	ELSEIF CHECK_CLO("겉옷노출", ARG)
		STAIN:ARG:겉옷 = SET_STAIN(STAIN:ARG:겉옷, "정액")
	ELSEIF CHECK_CLO("팬티노출", ARG)
		STAIN:ARG:팬티 = SET_STAIN(STAIN:ARG:팬티, "정액")
	ENDIF
	LOCAL = 0
ENDSELECT

RETURNF LOCAL


@STAIN_CALC_COSPLAY
SELECTCASE CUP:Ｖ윤
CASE IS >= 10000
	LOCAL = 5
CASE IS >= 6000
	LOCAL = 4
CASE IS >= 3000
	LOCAL = 3
CASE IS >= 1500
	LOCAL = 2
CASE IS >= 500
	LOCAL = 1
CASEELSE
	LOCAL = 0
ENDSELECT

SELECTCASE PALAM:Ｖ윤
CASE IS >= 30000
	SIF LOCAL < 3
		LOCAL = 3
CASE IS >= 10000
	SIF LOCAL < 2
		LOCAL = 2
CASE IS >= 3000
	SIF LOCAL < 1
		LOCAL = 1
ENDSELECT
SIF LOCAL < 2 && CALCF("Ｖ발정")
	LOCAL += 1

;팬티の愛液汚れ
IF EQUIP:팬티 && CHECK_PANTIES("Ｖ노출") == 0
	IF CHECK_PANTIES("通気性없음") == 0
		SIF LOCAL >= 3 || (CHECK_STAIN(STAIN:팬티, "蒸れ") && LOCAL >= 2)
			STAIN:팬티 = SET_STAIN(STAIN:팬티, "濡れ")
	ENDIF
	SIF LOCAL >= 1 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 100)
		STAIN:팬티 = SET_STAIN(STAIN:팬티, "蒸れ")
ENDIF
;겉옷(直穿き)の愛液汚れ
IF EQUIP:겉옷 && CHECK_OUTER("Ｖ노출") == 0
	;通気性なし(濡れないけど, 蒸れやすい)
	IF CHECK_OUTER("通気性없음")
		SIF LOCAL >= 1 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 50)
			STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "蒸れ")
	;直穿き
	ELSEIF CHECK_CLO("겉옷直穿き")
		;바지生地
		IF CHECK_OUTER("바지")
			SIF LOCAL >= 5 || (CHECK_STAIN(STAIN:겉옷, "蒸れ") && LOCAL >= 4)
				STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "濡れ")
			SIF LOCAL >= 3 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 500)
				STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "蒸れ")
		ELSE
			SIF LOCAL >= 4 || (CHECK_STAIN(STAIN:겉옷, "蒸れ") && LOCAL >= 3)
				STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "濡れ")
			SIF LOCAL >= 2 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 300)
				STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "蒸れ")
		ENDIF
	;ぱんつ濡れ(바지生地と同様の난이도)
	ELSEIF CHECK_STAIN(STAIN:팬티, "濡れ")
		SIF LOCAL >= 5 || (CHECK_STAIN(STAIN:겉옷, "蒸れ") && LOCAL >= 4)
			STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "濡れ")
		SIF LOCAL >= 3 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 500)
			STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "蒸れ")
	;ぱんつ蒸れ
	ELSEIF CHECK_STAIN(STAIN:팬티, "蒸れ")
		SIF LOCAL >= 3 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 1000)
			STAIN:겉옷 = SET_STAIN(STAIN:겉옷, "蒸れ")
	ENDIF
ENDIF
;보디슈츠（ボトム）の愛液汚れ
IF EQUIP:보디슈츠 && CHECK_BODYS("Ｖ노출") == 0
	;通気性あり
	IF CHECK_BODYS("通気性없음") == 0
		SIF LOCAL >= 4 || (CHECK_STAIN(STAIN:보디슈츠바텀, "蒸れ") && LOCAL >= 3)
			STAIN:보디슈츠바텀 = SET_STAIN(STAIN:보디슈츠바텀, "濡れ")
	ENDIF
	SIF LOCAL >= 3 || (NUM("턴수") == 0 && PALAM:Ｖ윤 >= 500)
		STAIN:보디슈츠바텀 = SET_STAIN(STAIN:보디슈츠바텀, "蒸れ")
ENDIF

;-------------------------------------------------
;～놀림LVによる보정の一括管理
;-------------------------------------------------
@SOURCE_EXABL(ARG, ARG:1, ARG:2)
#FUNCTION
;快感の基礎値を, 対応した技術ＬＶ*100だけ追加
LOCAL = ARG + 100 * ABL:(ARG:2):(ARG:1)

IF CONFIG("ＨＡＲＤ")
	LOCAL:1 = 10 * ABL:(ARG:2):(ARG:1)
ELSE
	LOCAL:1 = 20 * ABL:(ARG:2):(ARG:1)
ENDIF
IF ARG:2 == PLAYER
	LOCAL = MULTIPLY(LOCAL, 100 + LOCAL:1)
ELSE
	LOCAL = MULTIPLY(LOCAL, 100 + LOCAL:1 * 2)
ENDIF

RETURNF LOCAL

;-------------------------------------------------
;페니스判定関数@PENIS
;	引数：대상캐릭터의登録番号
;式中で使用する関数です. 페니스がある場合1を返します
;-------------------------------------------------
@PENIS(ARG)
#FUNCTION
SIF TALENT:ARG:후타나리 || TALENT:ARG:남자
	RETURNF 1
RETURNF 0

;-------------------------------------------------
;질判定関数
;-------------------------------------------------
@VAGINA(ARG)
#FUNCTION
SIF TALENT:ARG:후타나리 || TALENT:ARG:여자
	RETURNF 1
RETURNF 0

;-------------------------------------------------
;인서트の総合管理. ARGの状態ARGSを判定する
;인서트ならば, ＶorＡどっちかに인서트, Ｖ인서트ならＶに인서트中, という風に놀림分ける
;ARG:1に캐릭터번호を代入することでより細かい状態を調べられる
;例）INSERT("인서트", TARGET)だと"TARGETが인서트されてるか"のみを체크するが, 
;　　INSERT("인서트", TARGET, PLAYER)だと"PLAYERがTARGETに인서트しているか"を체크する
;TEQUIP:체위はビットで状態を管理する
;～9bit	체위、10bit Ｖ性交、11bit Ａ性交、12bit 性交
;-------------------------------------------------
@INSERT(ARGS, ARG, ARG:1)
#FUNCTION
SIF ARG < 0 || ARG:1 < 0
	RETURNF 0
SIF ARG == 0 && TARGET
	ARG = TARGET

SELECTCASE ARGS
CASE "인서트"
	SIF ARG:1 > 0 && TEQUIP:(ARG:1):Ｖ삽입 != ARG && TEQUIP:(ARG:1):Ａ삽입 != ARG && TEQUIP:(ARG:1):요도삽입 != ARG
		RETURNF 0
	RETURNF TEQUIP:ARG:체위
CASE "Ｖ인서트"
	SIF ARG:1 > 0 && TEQUIP:(ARG:1):Ｖ삽입 != ARG
		RETURNF 0
	SIF GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF TEQUIP:ARG:체위
CASE "Ｖ두개삽입"
	SIF FINDCHARA(TEQUIP:Ｖ삽입, ARG) > 0 && FINDCHARA(TEQUIP:Ｖ삽입, FINDCHARA(TEQUIP:Ｖ삽입, ARG) ) > 0
		RETURNF TEQUIP:ARG:체위
CASE "Ａ인서트"
	SIF ARG:1 > 0 && TEQUIP:(ARG:1):Ａ삽입 != ARG
		RETURNF 0
	SIF GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF TEQUIP:ARG:체위
CASE "Ａ두개삽입"
	SIF FINDCHARA(TEQUIP:Ａ삽입, ARG) > 0 && FINDCHARA(TEQUIP:Ａ삽입, FINDCHARA(TEQUIP:Ａ삽입, ARG) ) > 0
		RETURNF TEQUIP:ARG:체위
CASE "요도인서트"
	SIF ARG:1 > 0 && TEQUIP:(ARG:1):요도삽입 != ARG
		RETURNF 0
	SIF GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF TEQUIP:ARG:체위
CASE "複数삽입"
	SIF GETBIT(TEQUIP:ARG:체위, 10) && GETBIT(TEQUIP:ARG:체위, 11) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF TEQUIP:ARG:체위
	SIF FINDCHARA(TEQUIP:Ｖ삽입, ARG) > 0 && FINDCHARA(TEQUIP:Ｖ삽입, FINDCHARA(TEQUIP:Ｖ삽입, ARG) ) > 0
		RETURNF TEQUIP:ARG:체위
	SIF FINDCHARA(TEQUIP:Ａ삽입, ARG) > 0 && FINDCHARA(TEQUIP:Ａ삽입, FINDCHARA(TEQUIP:Ａ삽입, ARG) ) > 0
		RETURNF TEQUIP:ARG:체위
	SIF FINDCHARA(TEQUIP:요도삽입, ARG) > 0 && FINDCHARA(TEQUIP:요도삽입, FINDCHARA(TEQUIP:요도삽입, ARG) ) > 0
		RETURNF TEQUIP:ARG:체위
;同じ穴に두개삽입してる時には正確ではないです
CASE "인서트상대"
	LOCAL = MAX(FINDCHARA(TEQUIP:Ｖ삽입, ARG), FINDCHARA(TEQUIP:Ａ삽입, ARG), FINDCHARA(TEQUIP:요도삽입, ARG), 0)
		RETURNF LOCAL
CASE "Ｖ인서트상대"
	LOCAL = MAX(FINDCHARA(TEQUIP:Ｖ삽입, ARG), 0)
		RETURNF LOCAL
CASE "Ａ인서트상대"
	LOCAL = MAX(FINDCHARA(TEQUIP:Ａ삽입, ARG), 0)
		RETURNF LOCAL
CASE "요도인서트상대"
	LOCAL = MAX(FINDCHARA(TEQUIP:요도삽입, ARG), 0)
		RETURNF LOCAL
CASE "삽입중", "삽입中"
	RETURNF MAX(TEQUIP:ARG:Ｖ삽입, TEQUIP:ARG:Ａ삽입, TEQUIP:ARG:요도삽입)
CASE "Ｖ삽입중", "Ｖ삽입中"
	RETURNF TEQUIP:ARG:Ｖ삽입
CASE "Ａ삽입중", "Ａ삽입中"
	RETURNF TEQUIP:ARG:Ａ삽입
CASE "요도삽입中"
	RETURNF TEQUIP:ARG:요도삽입
;現時点ではＶＡ両方の場合を指すこととする
CASE "양구멍삽입"
	SIF (GETBIT(TEQUIP:ARG:체위, 10) > 0) + (GETBIT(TEQUIP:ARG:체위, 11) > 0) >= 2
		RETURNF TEQUIP:ARG:체위
;ARGとARG:1が合体している状況を調べる
;INSERT("인서트", ARG, ARG:1) || INSERT("인서트", ARG:1, ARG)と同じ
CASE "합체中"
	SIF ARG:1 == 0
		ARG:1 = PLAYER
	IF TEQUIP:(ARG:1):Ｖ삽입 == ARG || TEQUIP:(ARG:1):Ａ삽입 == ARG || TEQUIP:(ARG:1):요도삽입 == ARG
		RETURNF TEQUIP:ARG:체위
	ELSEIF TEQUIP:ARG:Ｖ삽입 == ARG:1 || TEQUIP:ARG:Ａ삽입 == ARG:1 || TEQUIP:ARG:요도삽입 == ARG:1
		RETURNF TEQUIP:(ARG:1):체위
	ENDIF
CASE "정상위"
	SIF GETBIT(TEQUIP:ARG:체위, 0)
		RETURNF 1
CASE "Ｖ정상위"
	SIF GETBIT(TEQUIP:ARG:체위, 0) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ정상위"
	SIF GETBIT(TEQUIP:ARG:체위, 0) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도정상위"
	SIF GETBIT(TEQUIP:ARG:체위, 0) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "후배위"
	SIF GETBIT(TEQUIP:ARG:체위, 1)
		RETURNF 1
CASE "Ｖ후배위"
	SIF GETBIT(TEQUIP:ARG:체위, 1) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ후배위"
	SIF GETBIT(TEQUIP:ARG:체위, 1) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도후배위"
	SIF GETBIT(TEQUIP:ARG:체위, 1) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "굴곡위"
	SIF GETBIT(TEQUIP:ARG:체위, 2)
		RETURNF 1
CASE "Ｖ굴곡위"
	SIF GETBIT(TEQUIP:ARG:체위, 2) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ굴곡위"
	SIF GETBIT(TEQUIP:ARG:체위, 2) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도굴곡위"
	SIF GETBIT(TEQUIP:ARG:체위, 2) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "대면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 3)
		RETURNF 1
CASE "Ｖ대면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 3) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ대면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 3) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도대면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 3) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "배면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 4)
		RETURNF 1
CASE "Ｖ배면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 4) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ배면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 4) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도배면좌위"
	SIF GETBIT(TEQUIP:ARG:체위, 4) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "기승위"
	SIF GETBIT(TEQUIP:ARG:체위, 5)
		RETURNF 1
CASE "Ｖ기승위"
	SIF GETBIT(TEQUIP:ARG:체위, 5) && GETBIT(TEQUIP:ARG:체위, 10)
		RETURNF 1
CASE "Ａ기승위"
	SIF GETBIT(TEQUIP:ARG:체위, 5) && GETBIT(TEQUIP:ARG:체위, 11)
		RETURNF 1
CASE "요도기승위"
	SIF GETBIT(TEQUIP:ARG:체위, 5) && GETBIT(TEQUIP:ARG:체위, 12)
		RETURNF 1
CASE "Ｖ対応커맨드"
	IF ARG == TARGET
		IF GETBIT(TEQUIP:ARG:체위, 0)
			RETURNF 60
		ELSEIF GETBIT(TEQUIP:ARG:체위, 1)
			RETURNF 61
		ELSEIF GETBIT(TEQUIP:ARG:체위, 2)
			RETURNF 62
		ELSEIF GETBIT(TEQUIP:ARG:체위, 3)
			RETURNF 63
		ELSEIF GETBIT(TEQUIP:ARG:체위, 4)
			RETURNF 64
		ELSEIF GETBIT(TEQUIP:ARG:체위, 5)
			RETURNF 65
		ENDIF
	ELSE
		IF GETBIT(TEQUIP:ARG:체위, 0)
			RETURNF 120
		ELSEIF GETBIT(TEQUIP:ARG:체위, 1)
			RETURNF 121
		ELSEIF GETBIT(TEQUIP:ARG:체위, 5)
			RETURNF 122
		ELSEIF TEQUIP:ARG:체위
			RETURNF 120
		ENDIF
	ENDIF
CASE "Ａ対応커맨드"
	IF ARG == TARGET
		IF GETBIT(TEQUIP:ARG:체위, 0)
			RETURNF 70
		ELSEIF GETBIT(TEQUIP:ARG:체위, 1)
			RETURNF 71
		ELSEIF GETBIT(TEQUIP:ARG:체위, 2)
			RETURNF 72
		ELSEIF GETBIT(TEQUIP:ARG:체위, 3)
			RETURNF 73
		ELSEIF GETBIT(TEQUIP:ARG:체위, 4)
			RETURNF 74
		ELSEIF GETBIT(TEQUIP:ARG:체위, 5)
			RETURNF 75
		ENDIF
	ELSE
		IF GETBIT(TEQUIP:ARG:체위, 0)
			RETURNF 125
		ELSEIF GETBIT(TEQUIP:ARG:체위, 1)
			RETURNF 126
		ELSEIF GETBIT(TEQUIP:ARG:체위, 5)
			RETURNF 127
		ELSEIF TEQUIP:ARG:체위
			RETURNF 125
		ENDIF
	ENDIF
CASE "요도対応커맨드"
	RETURNF 83
CASE "와일드스윙"
	SIF TEQUIP:ARG:체위
		RETURNF GETBIT(TEQUIP:ARG:특수행동, 0)
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF 0

;-------------------------------------------------
;ARGとARG:1の인서트＆삽입状態を解除させる関数
;通常はARGとARG:1にTARGETとPLAYERを代入する
;高速化のために@INSERTでできることを別の関数で行う事も有る
;-------------------------------------------------
@RESET_INSERT, ARG, ARG:1
#DIM LCOUNT

;ARGに関するTEQUIP:Ｖ삽입とTEQUIP:Ａ삽입を初期化する
FOR LOCAL, 0, (ARG > 0) + (ARG:1 > 0)
	;IF INSERT("인서트", ARG:LOCAL) || INSERT("인서트상대", ARG:LOCAL)
	IF TEQUIP:ARG:체위 || MAX(FINDCHARA(TEQUIP:Ｖ삽입, ARG:LOCAL), FINDCHARA(TEQUIP:Ａ삽입, ARG:LOCAL), FINDCHARA(TEQUIP:요도삽입, ARG:LOCAL), 0)
		;삽입している상대の플래그を消去
		FOR LCOUNT, 1, CHARANUM
			SELECTCASE LCOUNT
			CASE MASTER, ASSI, PLAYER, PLAYER:1, TARGET, TARGET:1
				SIF TEQUIP:LCOUNT:Ｖ삽입 == ARG:LOCAL
					TEQUIP:LCOUNT:Ｖ삽입 = 0
				SIF TEQUIP:LCOUNT:Ａ삽입 == ARG:LOCAL
					TEQUIP:LCOUNT:Ａ삽입 = 0
				SIF TEQUIP:LCOUNT:요도삽입 == ARG:LOCAL
					TEQUIP:LCOUNT:요도삽입 = 0
			ENDSELECT
		NEXT
	ENDIF

	TEQUIP:(ARG:LOCAL):Ｖ삽입 = 0
	TEQUIP:(ARG:LOCAL):Ａ삽입 = 0
	TEQUIP:(ARG:LOCAL):요도삽입 = 0
NEXT

;인서트されていない全ての캐릭터의TEQUIP:체위を初期化
FOR LCOUNT, 1, CHARANUM
	SELECTCASE LCOUNT
	CASE MASTER, ASSI, PLAYER, PLAYER:1, TARGET, TARGET:1
		;SIF INSERT("인서트상대", LCOUNT)
		SIF MAX(FINDCHARA(TEQUIP:Ｖ삽입, LCOUNT), FINDCHARA(TEQUIP:Ａ삽입, LCOUNT), FINDCHARA(TEQUIP:요도삽입, LCOUNT), 0)
			CONTINUE
		TEQUIP:LCOUNT:체위 = 0
		TEQUIP:LCOUNT:러브트랩 = 0
		;와일드스윙初期化
		CLEARBIT TEQUIP:LCOUNT:특수행동, 0
	ENDSELECT
NEXT

;-------------------------------------------------
;인서트の関数を설정する関数
;ARGに삽입される側, ARG:1に삽입する側, ARG:2にSELECTCOM
;ARGSに"解除判定"が代入された場合には解除されるかを체크するのみで인서트플래그の発生は無い
;TEQUIP:체위はビットで状態を管理する
;～9bit	체위、10bit Ｖ性交、11bit Ａ性交、12bit 性交
;-------------------------------------------------
@SET_INSERT, ARG, ARG:1, ARG:2, ARGS
#DIM LCOUNT

SIF ARG <= 0 || ARG:1 <= 0
	RETURN 0

VARSET LOCAL

SELECTCASE ARG:2
;인서트커맨드
CASE 60 TO 79, 83, 120 TO 129, 177
	IF ARGS != "解除判定"
		;これから삽입する側が인서트されている場合は인서트を解除する
		SELECTCASE ARG:2
		CASE 60 TO 79, 177, 83
			SIF INSERT("인서트", ARG:1)
				CALL RESET_INSERT, ARG:1
		CASE 120 TO 129
			SIF INSERT("인서트", ARG)
				CALL RESET_INSERT, ARG
		ENDSELECT

		;인서트される側の체위플래그
		SELECTCASE ARG:2
		CASE 60, 70, 177
			TEQUIP:ARG:체위 = 1p0
			;러브트랩状態の付与
			SIF ARG:2 == 177
				TEQUIP:ARG:러브트랩 = 1
		CASE 61, 71
			TEQUIP:ARG:체위 = 1p1
		CASE 62, 72
			TEQUIP:ARG:체위 = 1p2
		CASE 63, 73
			TEQUIP:ARG:체위 = 1p3
		CASE 64, 74
			TEQUIP:ARG:체위 = 1p4
		CASE 65, 75
			TEQUIP:ARG:체위 = 1p5
		;자궁삽입
		CASE 68
			IF TEQUIP:ARG:체위 == 0
				IF TEQUIP:ARG:넘어뜨리기
					TEQUIP:ARG:체위 = 1p5
				ELSE
					TEQUIP:ARG:체위 = 1p0
				ENDIF
			ENDIF
		CASE 83
			IF TEQUIP:ARG:넘어뜨리기
				TEQUIP:ARG:체위 = 1p5
			ELSE
				TEQUIP:ARG:체위 = 1p0
			ENDIF
		;이하は역인서트
		CASE 120, 125
			TEQUIP:(ARG:1):체위 = 1p0
		CASE 121, 126
			TEQUIP:(ARG:1):체위 = 1p1
		CASE 122, 127
			TEQUIP:(ARG:1):체위 = 1p5
		ENDSELECT

		;삽입する側がどこに入れたかのフラグ
		SELECTCASE ARG:2
		CASE 60 TO 69, 177
			SETBIT TEQUIP:ARG:체위, 10
			TEQUIP:(ARG:1):Ｖ삽입 = ARG
			TEQUIP:(ARG:1):Ａ삽입 = 0
			TEQUIP:(ARG:1):요도삽입 = 0
		CASE 70 TO 79
			SETBIT TEQUIP:ARG:체위, 11
			TEQUIP:(ARG:1):Ｖ삽입 = 0
			TEQUIP:(ARG:1):Ａ삽입 = ARG
			TEQUIP:(ARG:1):요도삽입 = 0
		CASE 83
			SETBIT TEQUIP:ARG:체위, 12
			TEQUIP:(ARG:1):Ｖ삽입 = 0
			TEQUIP:(ARG:1):Ａ삽입 = 0
			TEQUIP:(ARG:1):요도삽입 = ARG
		;이하は역인서트
		CASE 120 TO 124
			SETBIT TEQUIP:(ARG:1):체위, 10
			TEQUIP:ARG:Ｖ삽입 = ARG:1
			TEQUIP:ARG:Ａ삽입 = 0
			TEQUIP:ARG:요도삽입 = 0
		CASE 125 TO 129
			SETBIT TEQUIP:(ARG:1):체위, 11
			TEQUIP:ARG:Ｖ삽입 = 0
			TEQUIP:ARG:Ａ삽입 = ARG:1
			TEQUIP:ARG:요도삽입 = 0
		ENDSELECT
	ENDIF
;이하は커맨드実行時の解除判定. それぞれ역인서트状態かどうかも체크
CASE 3
	SIF INSERT("인서트", ARG:1) || CHECK_COM("인서트자위") == 0
		CALL RESET_INSERT, ARG, ARG:1
CASE 7
	SIF INSERT("인서트", ARG:1) || CHECK_COM("쓱쓱닦기", ARG:2)
		CALL RESET_INSERT, ARG, ARG:1
;손가락넣기
CASE 8
	TEQUIP:ARG:Ｖ삽입 = 0
	;ARG:1がARGに삽입している場合には解除
	SIF INSERT("Ｖ인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):Ｖ삽입 = 0
	TEQUIP:ARG:요도삽입 = 0
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
;요도손가락넣기(TARGETが페니스を삽입している場合にはインサート解除)
CASE 15
	IF PENIS(ARG)
		TEQUIP:ARG:Ｖ삽입 = 0
		TEQUIP:ARG:Ａ삽입 = 0
		TEQUIP:ARG:요도삽입 = 0
	ENDIF
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
CASE 0, 2, 5 TO 7
	;背中側の人には色々できない(역인서트の時)
	SIF INSERT("인서트", ARG:1) && INSERT("후배위", ARG:1) + INSERT("배면좌위", ARG:1)
		CALL RESET_INSERT, ARG, ARG:1
CASE 13
	TEQUIP:ARG:Ｖ삽입 = 0
	SIF INSERT("Ｖ인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):Ｖ삽입 = 0
	TEQUIP:ARG:요도삽입 = 0
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
	SIF INSERT("인서트", ARG:1) || INSERT("후배위", ARG) || INSERT("대면좌위", ARG) || (INSERT("배면좌위", ARG) && TEQUIP:ARG:수치플레이 == 0)
		CALL RESET_INSERT, ARG, ARG:1
CASE 14
	TEQUIP:ARG:요도삽입 = 0
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
	TEQUIP:ARG:Ａ삽입 = 0
	SIF INSERT("Ａ인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):Ａ삽입 = 0
	SIF INSERT("인서트", ARG:1) || (INSERT("후배위", ARG) == 0 && INSERT("기승위", ARG) == 0)
		CALL RESET_INSERT, ARG, ARG:1
;파후파후は장신でないと인서트解除
CASE 104
	;後ろからは駄目
	IF INSERT("후배위", ARG) || INSERT("배면좌위", ARG) || INSERT("후배위", ARG:1) || INSERT("배면좌위", ARG:1)
		CALL RESET_INSERT, ARG, ARG:1
	;기승위は상대と同程度の背がないと駄目
	ELSEIF INSERT("기승위") || INSERT("기승위", ARG:1)
		SIF (TALENT:(ARG:1):장신 && TALENT:장신 == 0) || (TALENT:(ARG:1):장신 == 0 && TALENT:(ARG:1):작은몸집 == 0 && TALENT:작은몸집)
			CALL RESET_INSERT, ARG, ARG:1
	ENDIF
;방뇨は요도삽입されながらは무리
CASE 144
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
;そのグループにおいては稀な인서트継続커맨드
CASE 130, 138, 139, 176, 178, 180
;촉수など, 인서트完全消去
CASE 171 TO 181, 200
	CALL RESET_INSERT, ARG, ARG:1
;미약기승위
CASE 261
	SIF TEQUIP:넘어뜨리기 == 0
		CALL RESET_INSERT, ARG, ARG:1
;問答無用で페니스を抜く커맨드(조교자が別の人ならば, その限りではありません)
CASE IS < 0, 1, 4, 9, 11, 12, 16, 31 TO 59, 80 TO 229, 260 TO 279, 302 TO 305, 307 TO 308, 503 TO 504
	TEQUIP:ARG:Ｖ삽입 = 0
	TEQUIP:ARG:Ａ삽입 = 0
	TEQUIP:ARG:요도삽입 = 0
	SIF INSERT("Ｖ인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):Ｖ삽입 = 0
	SIF INSERT("Ａ인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):Ａ삽입 = 0
	SIF INSERT("요도인서트상대", ARG) == ARG:1
		TEQUIP:(ARG:1):요도삽입 = 0
ENDSELECT

FOR LCOUNT, 1, CHARANUM
	SELECTCASE LCOUNT
	CASE MASTER, ASSI, PLAYER, PLAYER:1, TARGET, TARGET:1
		;인서트している상대がいる
		IF INSERT("인서트상대", LCOUNT)
			;複数삽입の時には体勢が変更される
			IF INSERT("複数삽입", LCOUNT)
				SELECTCASE ARG:2
				CASE 60 TO 69
					TEQUIP:LCOUNT:체위 = 1p4
				CASEELSE
					TEQUIP:LCOUNT:체위 = 1p5
				ENDSELECT
			;넘어뜨리기のときは기승위
			ELSEIF TEQUIP:LCOUNT:넘어뜨리기 && INSERT("인서트", LCOUNT)
				TEQUIP:LCOUNT:체위 = 1p5
			ENDIF
			;체위変更に伴う삽입플래그보정
			IF INSERT("Ｖ인서트상대", LCOUNT)
				SETBIT TEQUIP:LCOUNT:체위, 10
				SIF CHECK_CLO("Ｖ노출", LCOUNT) == 0
					CALL SETFLAG, "바텀을노출：텍스트없음", LCOUNT
			ENDIF
			IF INSERT("Ａ인서트상대", LCOUNT)
				SETBIT TEQUIP:LCOUNT:체위, 11
				SIF CHECK_CLO("Ａ노출", LCOUNT) == 0
					CALL SETFLAG, "바텀을노출：텍스트없음", LCOUNT
			ENDIF
			IF INSERT("요도인서트상대", LCOUNT)
				SETBIT TEQUIP:LCOUNT:체위, 12
				SIF CHECK_CLO("Ｖ노출", LCOUNT) == 0
					CALL SETFLAG, "바텀을노출：텍스트없음", LCOUNT
			ENDIF
		;誰かに삽입中
		ELSEIF INSERT("삽입中", LCOUNT)
			SIF CHECK_CLO("Ｖ노출", LCOUNT) == 0
				CALL SETFLAG, "바텀을노출：텍스트없음", LCOUNT
		;인서트も삽입もしていない
		ELSE
			CALL RESET_INSERT, LCOUNT
		ENDIF
	ENDSELECT
NEXT


;-------------------------------------------------
;各캐릭터의인서트플래그を一括管理する
;ARGSに"解除判定"が代入された場合には解除されるかを체크するのみで인서트플래그の発生は無い
;-------------------------------------------------
@CHECK_INSERT, ARGS
IF COND("조교側") == 0
	CALL SET_INSERT, TARGET, PLAYER, SELECTCOM, ARGS
	SIF SELECTCOM:1 >= 0
		CALL SET_INSERT, TARGET:1, PLAYER, SELECTCOM:1, ARGS
	SIF SELECTCOM:2 >= 0
		CALL SET_INSERT, TARGET, PLAYER:1, SELECTCOM:2, ARGS
ELSEIF ASSI
	CALL SET_INSERT, ASSI, TARGET, SELECTCOM:1, ARGS
ENDIF

;-------------------------------------------------
;インサートではない특수な체위フラグの管理
;-------------------------------------------------
@CHECK_EX_EQUIP
;넘어뜨리기컨닐링구스orＡ舐めは안면기승플래그ON
SELECTCASE SELECTCOM
CASE 1, 9
	SIF TEQUIP:넘어뜨리기
		TEQUIP:안면기승 = SELECTCOM
ENDSELECT


;키스継続…ここではフラグONのみ
;フラグOFFはEVENTCOMで行う
SELECTCASE SELECTCOM
CASE 6, 311
	;連続するほどに소비や効果にボーナス
	TEQUIP:키스 += 1
ENDSELECT

;占有不可な場合
IF TEQUIP:Ｗ넘어뜨리기 || COND("３Ｐ")
	TEQUIP:키스 = 0
	TEQUIP:(TARGET:1):키스 = 0
	TEQUIP:(PLAYER:1):키스 = 0
	TEQUIP:ASSI:키스 = 0
ENDIF

;-------------------------------------------------
;派生커맨드などを判定する関数
;-------------------------------------------------
@CHECK_COM(ARGS, ARG)
#FUNCTION

VARSET LOCAL

SELECTCASE ARGS
CASE "連続実行"
	SIF PREVCOM == SELECTCOM && COND("前Ｔ조교자") == PLAYER
		RETURNF 1
CASE "로션마사지"
	SIF ITEM:플레이매트 == 0 && NOITEM == 0
		RETURNF 0
	SIF COND("前Ｔ조교자") != PLAYER || TEQUIP:넘어뜨리기 || TEQUIP:촉수
		RETURNF 0
	;基本的に１로션で一回のみ
	SIF COND("로션마사지実行済")
		RETURNF 0
	;細かい条件はあとで詰める
	SELECTCASE ARG
	CASE 0
		SIF PREVCOM != 260
			RETURNF 0
		RETURNF 1
	CASE 260
		SIF PREVCOM != 0
			RETURNF 0
		RETURNF 260
	ENDSELECT
CASE "플라트"
	SIF TEQUIP:넘어뜨리기 || TEQUIP:식스나인 || ABL:PLAYER:기교 < 3
		RETURNF 0
 	SIF RANDF(3) == 0
		RETURNF 1
CASE "청소컨닐링구스"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF CHECK_COM("치구청소컨닐링구스", ARG)
		RETURNF 1
	SELECTCASE ARG
	CASE 1
		SIF COND("청소컨닐링구스플래그", PLAYER)
			RETURNF 1
		SIF TALENT:남자
			RETURNF 0
		;넘어뜨리기状態等は今のところなし
		SIF TEQUIP:넘어뜨리기 || TEQUIP:촉수 || CHECK_CLO("Ｖ노출可") == 0
			RETURNF 0
		;尿のお청소or섹스のお청소
		SIF PREVEX("Ｖ내사정") && PREVPLAY("인서트") && CHECK_STAIN(STAIN:Ｖ, "정액")
			SETBIT LOCAL, 0
		SIF PREVEX("요도内사정") && PREVPLAY("요도인서트")
			SETBIT LOCAL, 0
		SIF (PREVPLAY("질내욕뇨") || (PREVPLAY("방뇨") && PENIS(TARGET) == 0) ) && CHECK_STAIN(STAIN:Ｖ, "尿") && TEQUIP:카테터 == 0
			SETBIT LOCAL, 1
	CASE 98
		SIF COND("청소컨닐링구스플래그")
			RETURNF 1
		SIF TALENT:PLAYER:남자
			RETURNF 0
		SIF MIN(ABL:기교, ABL:봉사정신) < 3
			RETURNF 0
		;尿のお청소or섹스のお청소
		SIF PREVEX("Ｖ내사정", PLAYER) && PREVPLAY("인서트", PLAYER) && CHECK_STAIN(STAIN:PLAYER:Ｖ, "정액")
			SETBIT LOCAL, 0
		SIF (PREVPLAY("질내욕뇨", PLAYER) || (PREVPLAY("방뇨", PLAYER) && PENIS(PLAYER) == 0) ) && CHECK_STAIN(STAIN:PLAYER:Ｖ, "尿")
			SETBIT LOCAL, 1
	ENDSELECT
	RETURNF LOCAL
CASE "치구청소컨닐링구스"
	SIF ARG == 0
		ARG = SELECTCOM
	SELECTCASE ARG
	CASE 1
		SIF COND("치구청소컨닐링구스플래그", PLAYER)
			RETURNF 1
		SIF TALENT:남자
			RETURNF 0
		;넘어뜨리기状態等は今のところなし
		SIF TEQUIP:넘어뜨리기 || TEQUIP:촉수 || CHECK_CLO("Ｖ노출可") == 0
			RETURNF 0
		;前回청소컨닐링구스実行の時に続けてやっちゃう感じで
		SIF PREVPLAY("청소컨닐링구스", PLAYER) == 0 || CHECK_STAIN(STAIN:Ｖ, "Ｖ치구") == 0
			RETURNF 0
		;청소컨닐링구스よりは難易度高い
		SIF TALENT:PLAYER:불결무시 || TALENT:PLAYER:도착적
			RETURNF 1
		IF PLAYER == MASTER
			SIF COND("성벽：냄새페티시", PLAYER) && TALENT:마음에듬 + TALENT:상사상애
				RETURNF 1
		ELSE
			SIF ABL:PLAYER:봉사정신 + TALENT:PLAYER:헌신 + TALENT:PLAYER:악취둔감 + TALENT:PLAYER:냄새민감 - TALENT:PLAYER:악취민감 >= 5
				RETURNF 1
		ENDIF
	CASE 98
		SIF COND("치구청소컨닐링구스플래그")
			RETURNF 1
		SIF TALENT:PLAYER:남자
			RETURNF 0
		SIF MIN(ABL:기교, ABL:봉사정신) < 3
			RETURNF 0
		;前回청소펠라実行の時に続けてやっちゃう感じで
		SIF PREVPLAY("청소컨닐링구스") == 0 || CHECK_STAIN(STAIN:PLAYER:Ｖ, "Ｖ치구") == 0
			RETURNF 0
		;청소컨닐링구스よりは難易度高い
		SIF PLAYER == MASTER && TALENT:연모
			RETURNF 1
		SIF ABL:봉사정신 + TALENT:헌신 + TALENT:악취둔감 + TALENT:냄새민감 - TALENT:악취민감 >= 5 || TALENT:도착적 || TALENT:불결무시
			RETURNF 1
	ENDSELECT
CASE "인서트자위"
	SIF INSERT("인서트") == 0 || INSERT("複数삽입") || INSERT("인서트상대") != PLAYER
		RETURNF 0
	;腕の自由が損なわれない체위
	SIF INSERT("정상위") || INSERT("굴곡위") || INSERT("배면좌위") || INSERT("기승위")
		RETURNF INSERT("인서트")
CASE "펠라자위"
	SIF COND("前回펠라") && ABL:정액중독 >= 3 && ABL:자위중독 && TCVAR:28 >= 40
		RETURNF 1
CASE "오나홀자위"
	;촉수플레이중は駄目
	SIF TEQUIP:촉수
		RETURNF 0
	;前回커맨드がオナホ
	SIF PREVCOM == 37 && ABL:Ｃ감각 >= 3 && ABL:자위중독
		RETURNF 1
CASE "유두핥기가능"
	SIF COND("입의 사용", PLAYER) == 0
		RETURNF 0
	IF INSERT("인서트")
		IF INSERT("후배위") || INSERT("배면좌위")
			RETURNF 0
		ELSEIF TALENT:거유 < 3 && INSERT("기승위")
			RETURNF 0
		ENDIF
	ENDIF
	SIF INSERT("인서트", PLAYER) && (INSERT("후배위", PLAYER) || INSERT("배면좌위", PLAYER) || INSERT("기승위", PLAYER) )
		RETURNF 0
	SIF TEQUIP:니플캡 || TEQUIP:착유기 || TEQUIP:촉수
		RETURNF 0
	IF TALENT:PLAYER:악취둔감 || TALENT:PLAYER:불결무시
	ELSEIF PLAYER == MASTER && (TALENT:마음에듬 || TALENT:상사상애)
	ELSEIF PLAYER == ASSI && ABL:ASSI:순종 >= 4
	ELSE
		SIF CHECK_STAIN(STAIN:Ｂ, "Ａ", "破瓜の血")
			RETURNF 0
		SIF TALENT:PLAYER:남자 && ABL:PLAYER:ＢＬ끼 == 0 && CHECK_STAIN(STAIN:Ｂ, "Ｐ")
			RETURNF 0
		SIF ABL:PLAYER:정액중독 == 0 && CHECK_STAIN(STAIN:Ｂ, "정액")
			RETURNF 0
		SIF TALENT:PLAYER:구지배자의자취 == 0 && CHECK_STAIN(STAIN:Ｂ, "촉수")
			RETURNF 0
	ENDIF
	RETURNF 1
CASE "모유마시기가능"
	SIF TEQUIP:니플캡 || TEQUIP:착유기 || TEQUIP:촉수 || TALENT:모유체질 == 0 || BASE:분유 < MAXBASE:분유*30/100
		RETURNF 0
	SIF CHECK_COM("유두핥기가능", ARG)
		RETURNF 1
;これがＯＮだと엉덩이애무が유두舐めに変わる
CASE "유두핥기に変化"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF CHECK_COM("유두핥기가능", ARG) == 0
		RETURNF 0
	;손で엉덩이애무中
	SIF CHECK_COM("가슴指애무", ARG)
		RETURNF 1
	;前回커맨드によっては変更される。例外的に유두舐めの方が先に来る方が嬉しい커맨드とかね
	SELECTCASE PREVCOM
	CASE 5
		;유두を舐めているが、触るのがまだの際には애무優先
		SIF CHECK_COM("가슴指애무", ARG) == 0
			RETURNF 0
		RETURNF 1
	CASE 0, 2, 7, 8, 10, 11, 15, 60, 62, 63, 70, 72, 73, 90, 97, 104, 105
		RETURNF 1
	ENDSELECT
;엉덩이애무커맨드での内容詳細（TEQUIP:엉덩이애무 で行為が記録されている）
;0bitで가슴을揉む 1bitで유두を弄る 3bitでピアスをいじめる 10bitで유두を舐める 11bitでおっぱいを飲む
CASE "가슴指애무"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBITS(TEQUIP:엉덩이애무, 0, 2)
		RETURNF 1
CASE "가슴揉み"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBIT(TEQUIP:엉덩이애무, 0)
		RETURNF 1
CASE "유두弄り"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBIT(TEQUIP:엉덩이애무, 1)
		RETURNF 1
CASE "유두指弄り"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBIT(TEQUIP:엉덩이애무, 1) && GETBIT(TEQUIP:엉덩이애무, 10) == 0
		RETURNF 1
CASE "Ｂ피어스弄り"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBIT(TEQUIP:엉덩이애무, 2)
		RETURNF 1
CASE "유두핥기"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 5
		RETURNF 0
	SIF GETBIT(TEQUIP:엉덩이애무, 10)
		RETURNF 1

CASE "키스"
	SIF FIRSTCOM(6) == 0 || TEQUIP:재갈 || TEQUIP:식스나인
		RETURNF 0
	SIF PLAYER == MASTER && !TALENT:MASTER:불결무시 && STAIN:Ｍ&(2+4+8)
		RETURNF 0
	RETURNF 1

CASE "음핵애무가능"
	;후타나리には클리토리스が無いという事になってます현재は
	SIF PENIS(TARGET)
		RETURNF 0
	;클리토리스が弄れないとダメ
	SIF TEQUIP:클리캡
		RETURNF 0
	;ふきふき優先
	SIF CHECK_COM("쓱쓱닦기", ARG)
		RETURNF 0
	RETURNF 1
;これがＯＮだと보지애무が음핵애무に変わる
CASE "음핵애무に変化"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 7
		RETURNF 0
	SIF CHECK_COM("음핵애무가능", ARG) == 0
		RETURNF 0
	;현재음핵애무以外の보지애무実行中
	SIF CHECK_COM("보지애무", ARG) || CHECK_COM("恥丘애무", ARG)
		RETURNF 1
	;Ｖ使用中
	SIF TEQUIP:바이브 || INSERT("Ｖ인서트")
		RETURNF 1
	;음핵노출状態だと優遇
	SIF RANDF(2) && CALCF("Ｃ발정") >= 2 && CHECK_CLO("Ｖ노출")
		RETURNF 1
	;前回커맨드によっては変更される。例外的に음핵애무の方が先に来る方が嬉しい커맨드とかね
	SELECTCASE PREVCOM
	;まだ未調整
	CASE 7
	;	;유두を舐めているが、揉むのがまだの際には애무優先
	;	SIF CHECK_COM("가슴揉み", ARG) == 0
	;		RETURNF 0
		RETURNF 1
	;컨닐링구스、Ｖくぱぁなど음핵を強調した커맨드
	CASE 0, 1, 13, 30, 32, 34
		RETURNF 1
	ENDSELECT

CASE "쓱쓱닦기"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF COND("쓱쓱닦기플래그")
		RETURNF 1
	SIF ARG != 7
		RETURNF 0
	;방뇨後はどうしようか悩む
	;SIF PREVEX("방뇨") && CHECK_STAIN(STAIN:Ｖ, "尿") && CHECK_CLO("Ｖ노출")
	;	RETURNF 1
	SIF PREVEX("Ｖ내사정") == 0 || CHECK_STAIN(STAIN:Ｖ, "정액") == 0 || TEQUIP:촉수 || CHECK_CLO("Ｖ노출") == 0
		RETURNF 0
	RETURNF 1
;보지애무커맨드での内容詳細（TEQUIP:보지애무 で行為が記録されている）
;0bitアソコ表層 1bit恥丘 2bitクリを弄る 3bitピアスをいじめる
CASE "보지애무"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 7
		RETURNF 0
	SIF GETBIT(TEQUIP:보지애무, 0)
		RETURNF 1
CASE "恥丘애무"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 7
		RETURNF 0
	SIF GETBIT(TEQUIP:보지애무, 1)
		RETURNF 1
CASE "음핵애무"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 7
		RETURNF 0
	SIF GETBIT(TEQUIP:보지애무, 2)
		RETURNF 1
CASE "Ｃ피어스弄り"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 7
		RETURNF 0
	SIF GETBIT(TEQUIP:보지애무, 3)
		RETURNF 1

CASE "両穴くぱぁ"
	;能力と소질で制限
	SIF ABL:노출벽 >= 5 || TALENT:마조
		RETURNF 1
	SIF ABL:노출벽 + ABL:마조끼 + TALENT:부끄럼없음 + TALENT:음란*2 + TALENT:마조 + TALENT:도착적 - TALENT:부끄럼쟁이*2 - TALENT:청초*2 < 5
		RETURNF 0
	RETURNF 1

CASE "삽입前폭발"
	;既に삽입してるor３Ｐ中orペニバンなら起きない
	SIF INSERT("인서트") || COND("３Ｐ") || PENIS(PLAYER) == 0
		RETURNF 0

	;절정게이지が振りきってないと폭발しない（절정게이지が多いほど폭발率が上がる）
	SELECTCASE BASE:PLAYER:절정 / MAXBASE:PLAYER:절정
	CASE 0
		RETURNF 0
	CASEELSE
		SIF RANDF(1 + (BASE:PLAYER:절정 / MAXBASE:PLAYER:절정) ) == 0
			RETURNF 0
	ENDSELECT

	;정력に余裕がある状態じゃないと起きない
	SIF BASE:PLAYER:정력 < MAXBASE:PLAYER:정력*8/10
		RETURNF 0
	;今回、既にＶＡ삽입行為を経験済みだと平気（この条件は消す…かも）
	SIF EXP_GAIN(15, PLAYER) || EXP_GAIN(16, PLAYER)
		RETURNF 0

	;기승위以外の체위
	SELECTCASE SELECTCOM
	CASE 60 TO 64, 70 TO 74
		;慣れてなかったり기교が低い필요がある
		SIF TALENT:PLAYER:동정 || TALENT:PLAYER:조루 || ABL:PLAYER:기교 - MAX(ABL:ＬＶ - ABL:PLAYER:ＬＶ, 0)/2 < 2
			RETURNF 1
	ENDSELECT
CASE "Ｇ스팟자극"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 8 || ABL:PLAYER:기교 + ABL:PLAYER:손가락놀림 < 3 || COND("前Ｔ조교자") != PLAYER || PREVCOM != 8 || TEQUIP:바이브 || TEQUIP:촉수
		RETURNF 0
	RETURNF 1
CASE "와일드스윙"
	SIF BASE:ARG:기력 <= 0 || TEQUIP:ARG:넘어뜨리기 == 0 || INSERT("기승위", ARG) == 0 || COND("다리 사용", ARG) == 0
		RETURNF 0
	;連続ではあまりしてこない
	SIF INSERT("와일드스윙", ARG) && RAND:4
		RETURNF 0
	SIF TEQUIP:ARG:Ｗ넘어뜨리기 || SELECTCOM:1 >= 0 || COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0
		RETURNF 0
	;基本値は욕망
	LOCAL = ABL:ARG:욕망
	IF INSERT("Ｖ인서트", ARG) && SELECTCOM >= 60 && SELECTCOM <= 69
		SIF EXP:ARG:Ｖ경험 + EXP:ARG:Ｖ성교경험*2 + EXP:ARG:허리사용경험 <= 50
			RETURNF 0
		IF TALENT:ARG:음호
			LOCAL += 5
		ELSE
			;부끄럼쟁이
			SIF TALENT:ARG:부끄럼쟁이
				LOCAL -= 5
			;청초
			SIF TALENT:ARG:청초
				LOCAL -= 3
		ENDIF
	ELSEIF INSERT("Ａ인서트", ARG) && SELECTCOM >= 70 && SELECTCOM <= 79
		SIF EXP:ARG:Ａ경험 + EXP:ARG:Ａ성교경험*2 <= 50 || EXP:ARG:허리사용경험 <= 20
			RETURNF 0
		SIF ABL:ARG:Ａ감각 < 3
			LOCAL -= 5
		SELECTCASE PALAM:ARG:Ａ윤 + PALAM:PLAYER:Ｐ윤
		CASE IS < 3000
			LOCAL -= 5
		CASE IS < 10000
			LOCAL -= 2
		ENDSELECT
		IF TALENT:ARG:애널광
			LOCAL += 5
		ELSE
			;부끄럼쟁이
			SIF TALENT:ARG:부끄럼쟁이
				LOCAL -= 5
			;청초
			SIF TALENT:ARG:청초
				LOCAL -= 3
		ENDIF
	ELSEIF INSERT("요도인서트", ARG) && SELECTCOM == 83
		SIF EXP:ARG:요도경험 + EXP:ARG:요도성교경험*2 <= 50 || EXP:ARG:허리사용경험 <= 20 || PENIS(ARG)
			RETURNF 0
		SIF TALENT:ARG:요도성감 == 0
			LOCAL -= 5

		IF TALENT:ARG:요도광
			LOCAL += 5
		ELSE
			;부끄럼쟁이
			SIF TALENT:ARG:부끄럼쟁이
				LOCAL -= 5
			;청초
			SIF TALENT:ARG:청초
				LOCAL -= 3
		ENDIF
	ELSE
		RETURNF 0
	ENDIF
	;강기
	IF TALENT:ARG:강기
		LOCAL += 2
		;PLAYERがあまりイってない
		SIF EXP_GAIN(6, ARG) < 5
			LOCAL += 1
	ENDIF
	;호색
	SIF TALENT:ARG:호색
		LOCAL += 1
	;음란
	SIF TALENT:ARG:음란
		LOCAL += 2
	;허리놀림
	SIF ABL:ARG:허리놀림 || EXP:ARG:허리사용경험 >= 100
		LOCAL += 1
	SIF COND("발정기", ARG)
		LOCAL += 2
	SIF LOCAL >= RAND:3 + 3
		RETURNF 1
CASE "삽입국소자극"
	SIF INSERT("와일드스윙") || COND("前Ｔ조교자") != PLAYER || INSERT("Ｖ인서트") == 0
		RETURNF ARG

	SELECTCASE PREVCOM
	;連続では起きない
	CASE 66 TO 69
		RETURNF ARG
	CASE ARG
		SIF INSERT("Ｖ対応커맨드") != ARG
			RETURNF ARG
	CASEELSE
		RETURNF ARG
	ENDSELECT

	;一時的に封印
	SIF COND("３Ｐ") || PREVCOM:2 >= 0
		RETURNF ARG
	IF TEQUIP:넘어뜨리기
		SIF ABL:기교 + ABL:허리놀림 <= 2 || ABL:Ｖ감각 < 3 || EXP:Ｖ성교경험 < 20 || EXP:허리사용경험 < 20
			RETURNF ARG
	ELSE
		SIF ABL:PLAYER:기교 + ABL:PLAYER:허리놀림 <= 2
			RETURNF ARG
	ENDIF
	;미니멈だとＧスポのみ
	SIF SIZE("페니스", PLAYER) == 0 && TALENT:요정 == 0
		RETURNF 66
	;たまにはＧスポ선택
	SIF RAND:5 == 0
		RETURNF 66

	;체위によってどっちになりやすいかがある
	SELECTCASE ARG
	CASE 61
		LOCAL = 80
	CASE 62
		LOCAL = 90
	CASE 63
		LOCAL = 70
	CASE 64
		LOCAL = 30
	CASEELSE
		LOCAL = 60
	ENDSELECT
	;Ｖ감각が高く욕정しているほど자궁구へ行きやすい
	LOCAL += (MIN(GET_PALAMLV(PALAM:욕정), 5) + ABL:Ｖ감각) * RAND:11
	;하드스킨だと하드피스톤しやすい
	SIF STATE("하드스킨", PLAYER)
		LOCAL += 20
	;페니스が大きめだと자궁구へ行きやすい
	SIF SIZE("페니스", PLAYER) > MAX(ABL:Ｖ확장, 1)
		LOCAL += 10
	;자궁성감が無い상대だとＧスポを攻めるのが無難
	SIF TALENT:자궁성감 == 0 && TALENT:슬라임 == 0
		LOCAL -= 50
	;LOCALの値は0～100
	SELECTCASE LOCAL
	CASE IS >= 100
		RETURNF 67
	CASEELSE
		RETURNF 66
	ENDSELECT
;意図せず자궁に入ってしまった
CASE "うっかり자궁삽입"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 67 || PREVCOM != 67
		RETURNF 0
	;자궁구が緩んでいない
	SIF COND("자궁구弛緩度") == 0
		RETURNF 0
	SIF COND("前Ｔ조교자") != PLAYER || INSERT("Ｖ인서트") == 0 || EXP_GAIN(68)
		RETURNF 0
	RETURNF 1
CASE "쌍두바이브플레이"
	SIF TALENT:PLAYER:남자 || COND("쌍두바이브") == 0
		RETURNF 0
	RETURNF 1
CASE "청소펠라"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF CHECK_COM("치구청소펠라", ARG)
		RETURNF 1
	SELECTCASE ARG
	CASE 4
		SIF COND("청소펠라플래그", PLAYER)
			RETURNF 1
		SIF PENIS(TARGET) == 0
			RETURNF 0
		;넘어뜨리기状態は今のところなし
		SIF TEQUIP:넘어뜨리기
			RETURNF 0
		;尿のお청소or섹스のお청소
		SIF PREVPLAY("삽입中") && CHECK_STAIN(STAIN:Ｐ, "Ｖ", "Ａ")
			RETURNF 1
		SIF PREVPLAY("요도인서트") && PREVEX("요도内사정")
			RETURNF 1
		SIF PREVPLAY("방뇨") && CHECK_STAIN(STAIN:Ｐ, "尿")
			RETURNF 1
	CASE 91
		SIF COND("청소펠라플래그")
			RETURNF 1
		SIF PENIS(PLAYER) == 0
			RETURNF 0
		SIF MIN(ABL:기교, ABL:봉사정신) < 3
			RETURNF 0
		;尿のお청소or섹스のお청소
		SIF PREVPLAY("삽입中", PLAYER) && CHECK_STAIN(STAIN:PLAYER:Ｐ, "Ｖ", "Ａ")
			RETURNF 1
		SIF PREVPLAY("요도삽입中", PLAYER) && PREVEX("요도内사정")
			RETURNF 1
		SIF PREVPLAY("방뇨", PLAYER) && CHECK_STAIN(STAIN:PLAYER:Ｐ, "尿")
			RETURNF 1
	ENDSELECT
	RETURNF LOCAL
CASE "치구청소펠라"
	SIF ARG == 0
		ARG = SELECTCOM
	SELECTCASE ARG
	CASE 4
		SIF COND("치구청소펠라플래그", PLAYER)
			RETURNF 1
		SIF PENIS(TARGET) == 0 || COND("진성포경")
			RETURNF 0
		;넘어뜨리기状態は今のところなし
		SIF TEQUIP:넘어뜨리기
			RETURNF 0
		;前回청소펠라実行の時に続けてやっちゃう感じで
		SIF PREVPLAY("청소펠라", PLAYER) == 0 || CHECK_STAIN(STAIN:Ｐ, "Ｐ치구") == 0
			RETURNF 0
		;청소펠라よりは難易度高い
		SIF TALENT:PLAYER:불결무시 || TALENT:PLAYER:도착적
			RETURNF 1
		IF PLAYER == MASTER
			SIF COND("성벽：냄새페티시", PLAYER) && TALENT:마음에듬 + TALENT:상사상애
				RETURNF 1
		ELSE
			SIF ABL:PLAYER:봉사정신 + TALENT:PLAYER:헌신 + TALENT:PLAYER:악취둔감 + TALENT:PLAYER:냄새민감 - TALENT:PLAYER:악취민감 >= 5
				RETURNF 1
		ENDIF
	CASE 91
		SIF COND("치구청소펠라플래그")
			RETURNF 1
		SIF PENIS(PLAYER) == 0 || COND("진성포경", PLAYER)
			RETURNF 0
		SIF MIN(ABL:기교, ABL:봉사정신) < 3
			RETURNF 0
		;前回청소펠라実行の時に続けてやっちゃう感じで
		SIF PREVPLAY("청소펠라") == 0 || CHECK_STAIN(STAIN:PLAYER:Ｐ, "Ｐ치구") == 0
			RETURNF 0
		;청소펠라よりは難易度高い
		SIF PLAYER == MASTER && TALENT:연모
			RETURNF 1
		SIF ABL:봉사정신 + TALENT:헌신 + TALENT:악취둔감 + TALENT:냄새민감 - TALENT:악취민감 >= 5 || TALENT:도착적 || TALENT:불결무시
			RETURNF 1
	ENDSELECT
CASE "손훑기펠라"
	SIF COND("前Ｔ조교자") != PLAYER || TEQUIP:Ｗ넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF (ARG == 90 && PREVCOM == 91) || (ARG == 90 && PREVCOM == 140) || (ARG == 91 && PREVCOM == 90)
		RETURNF ARG
CASE "파이즈리펠라"
	SIF COND("前Ｔ조교자") != PLAYER || TEQUIP:Ｗ넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF (ARG == 91 && PREVCOM == 81) || (ARG == 91 && PREVCOM == 92) || (ARG == 92 && PREVCOM == 91)
		RETURNF ARG
CASE "Ａ자극손훑기"
	SIF COND("前Ｔ조교자") != PLAYER || TEQUIP:Ｗ넘어뜨리기 || TEQUIP:식스나인
		RETURNF 0
	SIF ABL:봉사정신 + TALENT:헌신 < 3 && ABL:새드끼 < 3
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF (ARG == 90 || ARG == 97) && PREVCOM == 96
		RETURNF ARG
	SIF ARG == 96 && (PREVCOM == 97 || PREVCOM == 90)
		RETURNF ARG
CASE "파후파후손훑기"
	SIF !TALENT:거유 || COND("前Ｔ조교자") != PLAYER || TEQUIP:Ｗ넘어뜨리기 || TEQUIP:식스나인
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM

	SELECTCASE ARG
	CASE 90, 97
		SIF PREVCOM == 104
			RETURNF ARG
		SIF PREVCOM == 5 && PREVPLAY("모유마시기", PLAYER)
			RETURNF ARG
	CASE 104
		SIF PREVCOM == 90 || PREVCOM == 97
			RETURNF ARG
	ENDSELECT

CASE "풋잡：踏みつけ"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 95
		RETURNF 0
	SIF GETBIT(TEQUIP:풋잡, 0)
		RETURNF 1
CASE "풋잡：股間見せ"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 95
		RETURNF 0
	SIF GETBIT(TEQUIP:풋잡, 1)
		RETURNF 1
CASE "풋잡：한발풋잡"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 95
		RETURNF 0
	SIF GETBIT(TEQUIP:풋잡, 2) == 0
		RETURNF 1
CASE "풋잡：양발풋잡"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 95
		RETURNF 0
	SIF GETBIT(TEQUIP:풋잡, 2)
		RETURNF 1

CASE "멜티키스"
	;음탕한입술
	SIF TALENT:음탕한입술
		RETURNF 1
	LOCAL = RAND:(BASE:정력 + 1)
	;스투나には상성が悪い
	SIF NO:TARGET == 34
		LOCAL *= 5
	;멜로나が음탕한입술
	SIF TALENT:ARG:음탕한입술
		LOCAL /= 4
	;Ｍ민감
	SIF TALENT:Ｍ민감
		LOCAL /= 2
	;Ｍ둔감
	SIF TALENT:Ｍ둔감
		LOCAL *= 2
	SIF RAND:(BASE:ARG:정력 + 1) >= LOCAL
		RETURNF 1
CASE "입内방뇨"
	SIF COND("前Ｔ조교자") != PLAYER || TEQUIP:넘어뜨리기 || COND("입의 사용") == 0
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG != 138
		RETURNF 0
	IF PENIS(PLAYER)
		SIF PREVEX("구내사정")
			RETURNF 1
	ELSE
		SIF PREVCOM == 98
			RETURNF 1
	ENDIF
CASE "자궁内방뇨"
	SIF COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0 || TEQUIP:넘어뜨리기 || PREVCOM != 68
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	;인서트中＆前回내사정
	SIF ARG == 138 && INSERT("Ｖ인서트") && INSERT("인서트상대") == PLAYER && PREVEX("Ｖ내사정")
		RETURNF 1
CASE "질内방뇨"
	SIF COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0 || TEQUIP:넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	;인서트中＆前回내사정
	SIF ARG == 138 && INSERT("Ｖ인서트") && INSERT("인서트상대") == PLAYER && PREVEX("Ｖ내사정")
		RETURNF 1
CASE "온천관장"
	SIF COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0 || TEQUIP:넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	;인서트中＆前回내사정
	SIF ARG == 138 && INSERT("Ａ인서트") && INSERT("인서트상대") == PLAYER && PREVEX("Ａ내사정")
		RETURNF 1
CASE "유内방뇨"
	SIF COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0 || TEQUIP:넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	;니플퍽＆前回내사정
	SIF ARG == 138 && PREVCOM == 82 && PREVEX("유内사정")
		RETURNF 1
CASE "방광内방뇨"
	SIF COND("前Ｔ조교자") != PLAYER || PENIS(PLAYER) == 0 || TEQUIP:넘어뜨리기
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	;インサート中＆前回中出し
	SIF ARG == 138 && INSERT("요도인서트") && INSERT("인서트상대") == PLAYER && PREVEX("요도内사정")
		RETURNF 1
CASE "강제방뇨"
	SIF TEQUIP:넘어뜨리기
		RETURNF 0
	;목욕탕以外で순종３未満
	SIF TEQUIP:목욕탕플레이 == 0 && ABL:순종 <= 2
		RETURNF 1
	SIF MAX(ABL:순종 - 1, ABL:욕망 - 1, ABL:노출벽, ABL:마조끼) < 3
		RETURNF 1
CASE "양손피스트"
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG >= 141 && ARG <= 142 && GETBIT(TEQUIP:PLAYER:특수행동, 1)
		RETURNF 1
;이하３Ｐ協力커맨드
CASE "Ｖ두개삽입"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG == 60 && INSERT("Ｖ인서트", TARGET, PLAYER:1) && ABL:Ｖ확장 >= SIZE("Ｗ페니스")
		RETURNF 1
CASE "Ａ두개삽입"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG == 71 && INSERT("Ａ인서트", TARGET, PLAYER:1) && ABL:Ａ확장 >= SIZE("Ｗ페니스")
		RETURNF 1
CASE "양구멍삽입"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	IF ARG == 60 && INSERT("Ａ인서트", TARGET, PLAYER:1)
		RETURNF 1
	ELSEIF ARG == 71 && INSERT("Ｖ인서트", TARGET, PLAYER:1)
		RETURNF 1
	ENDIF
CASE "좌우니플퍽"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SIF ARG == 82 && PREVCOM:2 == 82
		RETURNF 1
CASE "Ｗ봉사"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SELECTCASE ARG
	CASE 90
		SIF (GROUPMATCH(ARG, SELECTCOM:1, PREVCOM:1) || PREVCOM:1 == 97) && PENIS(PLAYER)
			RETURNF 1
	CASE 91
		SIF GROUPMATCH(ARG, SELECTCOM:1, PREVCOM:1) || PREVCOM:1 == 140
			RETURNF 1
	CASE 92 TO 94, 104
		SIF GROUPMATCH(ARG, SELECTCOM:1, PREVCOM:1)
			RETURNF 1
	CASE 95
		SIF GROUPMATCH(ARG, SELECTCOM:1, PREVCOM:1) && PENIS(PLAYER)
			RETURNF 1
	CASE 97
		SIF GROUPMATCH(ARG, SELECTCOM:1, PREVCOM:1) && CHECK_CLO("팬티훑기", TARGET:1)
			RETURNF 1
	ENDSELECT
;広い意味だと何でもＯＫっぽいので, あえて봉사커맨드限定の方がいいかも
CASE "３Ｐ봉사"
	SIF PLAYER:1 <= 0 || STATE("撃沈", PLAYER:1)
		RETURNF 0
	SIF ARG == 0
		ARG = SELECTCOM
	SELECTCASE ARG
	;대면좌위はダメ
	CASE 63, 73
	;인서트系
	CASE 60 TO 79, 83
		;前回が손훑기, 펠라, 파이즈리, 애널봉사, 팬티훑기, 컨닐링구스시킨다, 이라마치오のどれかでないと駄目
		SIF GROUPMATCH(PREVCOM:2, 90, 91, 92, 96, 97, 98, 140) == 0
			RETURNF 0

		SELECTCASE PREVCOM:2
		CASE 90, 91, 96 TO 98, 140
			RETURNF PREVCOM:2
		CASE 92
			SELECTCASE ARG
			CASE 64, 65, 74, 75
				RETURNF PREVCOM:2
			ENDSELECT
		ENDSELECT
	;특수인서트系. 今のところ니플퍽のみ
	CASE 82
		;前回が, 니플퍽, 손훑기, 펠라, 팬티훑기でないと駄目
		SIF GROUPMATCH(PREVCOM:2, 82, 90, 91, 97) == 0
			RETURNF 0
		RETURNF PREVCOM:2
	;봉사系. 손훑기, 펠라, 파이즈리, 애널봉사, 팬티훑기, 컨닐링구스시킨다, 이라마치오
	CASE 90 TO 92, 96 TO 98, 140
		;삽입されながら봉사
		SIF INSERT("인서트", TARGET, PLAYER:1)
			RETURNF 1

		SELECTCASE ARG
		;손훑기
		CASE 90
			;두개손훑기or펠라＆손훑기or니플퍽＆손훑기
			SIF GROUPMATCH(PREVCOM:2, 90, 97)
				RETURNF 90
			SIF GROUPMATCH(PREVCOM:2, 91, 140)
				RETURNF 91
			SIF PREVCOM:2 == 82
				RETURNF 82
		;펠라
		CASE 91
			;두개펠라or펠라＆손훑기or니플퍽＆펠라
			SIF GROUPMATCH(PREVCOM:2, 91, 140)
				RETURNF 91
			SIF GROUPMATCH(PREVCOM:2, 90, 97)
				RETURNF 90
			SIF PREVCOM:2 == 82
				RETURNF 82
		;팬티훑기
		CASE 97
			;두개손훑기or펠라＆손훑기or니플퍽＆팬티훑기
			SIF PREVCOM:2 == 90
				RETURNF 90
			SIF GROUPMATCH(PREVCOM:2, 91, 140)
				RETURNF 91
			SIF PREVCOM:2 == 82
				RETURNF 82
		ENDSELECT
	ENDSELECT
ENDSELECT
RETURNF 0

@PRINT_TRAIN_NAME(ARG)
STR:2 = %TRAIN_NAME(ARG)%
PRINTFORML %STR:2%

;-------------------------------------------------
;変化する요정素を加味したTRAINNAME（커맨드中の表示）
;-------------------------------------------------
@TRAIN_NAME(ARG)
#FUNCTIONS
;３Ｐの時
IF CHECK_COM("３Ｐ봉사") && COND("３Ｐ")
	LOCALS = %TRAINNAME:(SELECTCOM:2)% ＆ %TRAINNAME:ARG%
	SELECTCASE ARG
	CASE 82
		SIF CHECK_COM("좌우니플퍽", ARG)
			LOCALS = 左右니플퍽
	CASE 90
		SIF CHECK_COM("３Ｐ봉사", ARG) == 90
			LOCALS = 두개손훑기
	CASE 91
		SIF CHECK_COM("３Ｐ봉사", ARG) == 91
			LOCALS = 두개펠라
	ENDSELECT
	RETURNF LOCALS
ENDIF

LOCALS = %TRAIN_NAME_SELECT(ARG)%
SELECTCASE ARG
CASE 0
	IF CHECK_COM("로션마사지", ARG)
		LOCALS = 로션尻애무
	ELSEIF CHECK_COM("플라트", ARG)
		LOCALS = 플라트
	ENDIF
CASE 1
	IF CHECK_COM("치구청소컨닐링구스", ARG)
		LOCALS = 치구청소컨닐링구스
	ELSEIF CHECK_COM("청소컨닐링구스", ARG)
		LOCALS = 청소컨닐링구스
	ELSEIF TEQUIP:넘어뜨리기
		IF CHECK_CLO("블루머노출")
			LOCALS = 블루머안면기승
		ELSE
			LOCALS = 안면기승
		ENDIF
	ELSEIF TEQUIP:수치플레이
		LOCALS = 석간수
	ELSE
		LOCALS = 컨닐링구스
	ENDIF
CASE 60 TO 69
	IF ARG == 60
		IF CHECK_COM("Ｖ두개삽입")
			LOCALS = Ｖ두개삽입
		ELSEIF CHECK_COM("양구멍삽입")
			LOCALS = 양구멍삽입
		ENDIF
	ELSEIF ARG == 64 && TEQUIP:수치플레이
		LOCALS = 흐트러진모란
	ELSEIF ARG == 65 && INSERT("와일드스윙")
		LOCALS = 와일드스윙
	ELSEIF ARG == 66
		LOCALS = %TRAINNAME:ARG%
		SIF INSERT("기승위")
			LOCALS = 기승Ｇ스팟자극
	ELSEIF ARG == 67
		LOCALS = %TRAINNAME:ARG%
		;굴곡위で連続実行
		IF PREVCOM == 67 && INSERT("굴곡위")
			LOCALS = 種付けプレス
		ELSEIF PENIS(PLAYER) && STATE("하드스킨", PLAYER) && TEQUIP:넘어뜨리기 == 0
			LOCALS = 하드피스톤
		ELSEIF INSERT("기승위")
			LOCALS = 기승자궁구자극
		ENDIF
	ENDIF
CASE 70 TO 79
	IF ARG == 75 && INSERT("와일드스윙")
		LOCALS = Ａ와일드스윙
	ELSEIF ARG == PREVCOM && PENIS(PLAYER) && COND("前Ｔ조교자") == PLAYER && STATE("하드스킨", PLAYER) && INSERT("Ａ인서트")
		LOCALS = 하드애널피스톤
	ENDIF
	IF ARG == 71
		IF CHECK_COM("Ａ두개삽입")
			LOCALS = Ａ두개삽입
		ELSEIF CHECK_COM("양구멍삽입")
			LOCALS = 양구멍삽입
		ENDIF
	ENDIF
CASE 83
	SIF INSERT("와일드스윙")
		LOCALS = 와일드스윙
CASE 90
	IF LOCALS != TRAINNAME:ARG
	ELSEIF EQUIP:장갑 && !CHECK_GLOVE("손가락노출") && PENIS(PLAYER)
		LOCALS = 장갑훑기
	ELSEIF TALENT:하피
		LOCALS = 날개훑기
	ENDIF
CASE 97
	IF LOCALS != TRAINNAME:ARG
	ELSEIF CHECK_OUTER("블루머")
		LOCALS = 블루머훑기
	ELSEIF CHECK_PANTIES("수영복")
		LOCALS = 비키니훑기
	ELSE
		LOCALS = 팬티훑기
	ENDIF
CASE 173
	IF TEQUIP:새댁플레이
		LOCALS = 새댁플레이종료
	ELSEIF CHECK_CLO("수영복차림")
		LOCALS = 새댁플레이(수영복에이프런)
	ELSEIF CHECK_CLO("블루머노출")
		LOCALS = 새댁플레이(블루머에이프런)
	ELSEIF CHECK_CLO("下着姿")
		LOCALS = 새댁플레이(下着에이프런)
	ELSEIF CHECK_CLO("알몸")
		LOCALS = 새댁플레이(알몸에이프런)
	ELSE
		LOCALS = 새댁플레이
	ENDIF
ENDSELECT
RETURNF LOCALS


;-------------------------------------------------
;変化する요정素を加味したTRAINNAME（커맨드선택するときの表示）
;-------------------------------------------------
@TRAIN_NAME_SELECT(ARG)
#FUNCTIONS
LOCALS = %TRAIN_NAME_STANDARD(ARG)%
;특수な名前
SELECTCASE ARG
CASE 0
	SIF CHECK_COM("로션마사지", ARG)
		LOCALS = 로션尻애무
CASE 1
	IF CHECK_COM("치구청소컨닐링구스", ARG)
		LOCALS = 치구청소컨닐링구스
	ELSEIF CHECK_COM("청소컨닐링구스", ARG)
		LOCALS = 청소컨닐링구스
	ENDIF
	SIF TEQUIP:넘어뜨리기
		LOCALS = 안면기승
CASE 2
	SIF TEQUIP:애널바이브 && TEQUIP:촉수 == 0
		LOCALS = Ａ바이브애무
CASE 3
	IF GETBIT(CHECK_ONANIE(ARG), 14)
		LOCALS = 오나홀%LOCALS%
	ELSEIF GETBIT(CHECK_ONANIE(ARG), 10)
		LOCALS = 샤워%LOCALS%
	ELSEIF GETBIT(CHECK_ONANIE(ARG), 13)
		LOCALS = 양구멍바이브%LOCALS%
	ELSEIF GETBIT(CHECK_ONANIE(ARG), 11)
		LOCALS = 바이브%LOCALS%
	ELSEIF GETBIT(CHECK_ONANIE(ARG), 12)
		LOCALS = Ａ바이브%LOCALS%
	ELSE
		;IF GETBIT(CHECK_ONANIE(ARG), 0)
		;	IF TALENT:남자
		;		LOCALS = Ｐ%LOCALS%
		;	ELSE
		;		LOCALS = Ｃ%LOCALS%
		;	ENDIF
		;ELSEIF GETBIT(CHECK_ONANIE(ARG), 1)
		;	LOCALS = Ｖ%LOCALS%
		;ELSEIF GETBIT(CHECK_ONANIE(ARG), 2)
		;	LOCALS = Ａ%LOCALS%
		;ELSEIF GETBIT(CHECK_ONANIE(ARG), 3)
		;	LOCALS = Ｂ%LOCALS%
		;ENDIF
	ENDIF

	IF CHECK_COM("인서트자위")
		IF INSERT("Ｖ인서트")
			LOCALS = %CONDS("체위")%%LOCALS%
		ELSEIF INSERT("Ａ인서트")
			LOCALS = Ａ%CONDS("체위")%%LOCALS%
		ELSEIF INSERT("요도인서트")
			LOCALS = %CONDS("체위")%%LOCALS%
		ENDIF
	ENDIF
	SIF STRLENS(LOCALS) > 14
		RETURNF LOCALS

	IF TEQUIP:비디오카메라
		LOCALS = 공개%LOCALS%
	ELSEIF TEQUIP:야외플레이
		LOCALS = 야외%LOCALS%
	ENDIF
CASE 4
	IF CHECK_COM("치구청소펠라", ARG)
		LOCALS = 치구청소펠라
	ELSEIF CHECK_COM("청소펠라", ARG)
		LOCALS = 청소펠라한다
	ENDIF
CASE 5
	IF CHECK_COM("유두핥기に変化", ARG)
		IF CHECK_COM("모유마시기가능", ARG)
			IF CHECK_COM("가슴揉み", ARG) && CHECK_COM("유두핥기", ARG)
				LOCALS = 엉덩이애무＆모유마시기
			ELSE
				LOCALS = 모유마시기
			ENDIF
		ELSEIF CHECK_COM("가슴揉み", ARG) && CHECK_COM("유두핥기", ARG)
			LOCALS = 엉덩이애무＆유두舐め
		ELSE
			LOCALS = 유두舐め
		ENDIF
	ENDIF
CASE 6
	SIF NUM("턴수") == 0
		LOCALS = 텐더키스
CASE 7
	IF CHECK_COM("ふきふき", ARG)
		LOCALS = 쓱쓱닦기
	ELSEIF CHECK_COM("음핵애무に変化", ARG)
		LOCALS = 음핵애무
	ENDIF
CASE 8
	IF CHECK_COM("Ｇ스팟자극", ARG)
		LOCALS = Ｇ스팟자극
	ELSEIF TEQUIP:바이브
		LOCALS = 바이브애무
	ENDIF
CASE 9
	SIF TEQUIP:넘어뜨리기
		LOCALS = Ａ안면기승
CASE 10
	SIF INSERT("요도인서트", TARGET, PLAYER)
		LOCALS = オナホプレイ
CASE 11
	SIF TEQUIP:넘어뜨리기
		LOCALS = 가슴계곡을범한다
CASE 12
	SIF PENIS(TARGET) == 0
		LOCALS = 맨발로가랑이를자극
CASE 13
	IF PREVCOM == 13
		IF COND("両穴くぱぁ")
			LOCALS = 両穴観察
		ELSE
			LOCALS = アソコ観察
		ENDIF
	ELSEIF PREVCOM == 14 && CHECK_COM("両穴くぱぁ")
		LOCALS = 両穴조개벌리기
	ENDIF
CASE 14
	IF PREVCOM == 14
		IF COND("両穴くぱぁ")
			LOCALS = 両穴観察
		ELSE
			LOCALS = 애널観察
		ENDIF
	ELSEIF PREVCOM == 13 && CHECK_COM("両穴くぱぁ")
		LOCALS = 両穴조개벌리기
	ENDIF
CASE 31
	SIF TEQUIP:바이브
		LOCALS = 바이브를뽑는다
CASE 33
	IF COND("애널비즈")
		LOCALS = 애널비즈를뽑는다
	ELSEIF TEQUIP:애널바이브
		LOCALS = Ａ바이브를뽑는다
	ENDIF
CASE 34
	SIF TEQUIP:클리캡
		LOCALS = 클리캡을뗀다
CASE 35
	SIF TEQUIP:니플캡
		LOCALS = 니플캡을뗀다
CASE 36
	SIF TEQUIP:착유기
		LOCALS = 착유기를뗀다
CASE 37
	SIF TEQUIP:오나홀
		LOCALS = 오나홀을뗀다
CASE 38
	SIF TEQUIP:샤워
		LOCALS = 샤워를멈춘다
CASE 39
	SIF TEQUIP:로터삽입
		LOCALS = 로터를뺀다
CASE 60 TO 79
	IF TEQUIP:넘어뜨리기 == 0 && ARG >= 60 && ARG <= 65
		SELECTCASE CHECK_COM("삽입국소자극", ARG)
		CASE 66, 67
			LOCALS = 삽입국소자극
		ENDSELECT
	ENDIF
	IF CHECK_COM("３Ｐ봉사", ARG)
		LOCALS = %TRAINNAME:ARG%(３Ｐ)
	ELSEIF (ARG == 60 || ARG == 71) && COND("３Ｐ")
		IF CHECK_COM("Ｖ두개삽입", ARG)
			LOCALS = Ｖ두개삽입(３Ｐ)
		ELSEIF CHECK_COM("Ａ두개삽입", ARG)
			LOCALS = Ａ두개삽입(３Ｐ)
		ELSEIF CHECK_COM("양구멍삽입", ARG)
			LOCALS = 양구멍삽입(３Ｐ)
		ENDIF
	ELSEIF ARG == 67
		;굴곡위で連続実行
		SIF PREVCOM == 67 && INSERT("굴곡위")
			LOCALS = 種付けプレス
	ELSEIF ARG == 68
		;기승위
		SIF INSERT("기승위")
			LOCALS = 자궁삽입기승위
	ENDIF
CASE 80
	SIF CHECK_COM("쌍두바이브플레이")
		LOCALS = 쌍두바이브플레이
CASE 82
	IF CHECK_COM("３Ｐ봉사", ARG)
		IF CHECK_COM("좌우니플퍽", ARG)
			LOCALS = 좌우니플퍽
		ELSE
			LOCALS = %LOCALS%(３Ｐ)
		ENDIF
	ELSEIF TEQUIP:넘어뜨리기
		LOCALS = 니플오나홀
	ENDIF
CASE 83
	SIF TEQUIP:넘어뜨리기
		LOCALS = 기승위
CASE 90
	IF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ손훑기
	ELSEIF CHECK_COM("３Ｐ봉사", ARG)
		IF CHECK_COM("３Ｐ봉사", ARG) == 90
			LOCALS = 두개손훑기(３Ｐ)
		ELSE
			LOCALS = %LOCALS%(３Ｐ)
		ENDIF
	ELSEIF CHECK_COM("손훑기펠라", ARG)
		LOCALS = 손훑기펠라
	ELSEIF CHECK_COM("Ａ자극손훑기", ARG)
		LOCALS = Ａ자극손훑기
	ELSEIF CHECK_COM("파후파후손훑기", ARG)
		IF CHECK_COM("모유마시기가능", ARG)
			LOCALS = 수유손훑기
		ELSE
			LOCALS = 파후파후손훑기
		ENDIF
	ENDIF
CASE 91
	IF CHECK_COM("Ｗ봉사", ARG)
		IF CHECK_COM("청소펠라", ARG)
			LOCALS = Ｗ청소펠라
		ELSE
			LOCALS = Ｗ펠라치오
		ENDIF
	ELSEIF CHECK_COM("３Ｐ봉사", ARG)
		IF CHECK_COM("３Ｐ봉사", ARG) == 91
			LOCALS = 두개펠라
		ELSE
			LOCALS = %LOCALS%(３Ｐ)
		ENDIF
	ELSEIF CHECK_COM("손훑기펠라", ARG)
		LOCALS = 손훑기펠라
	ELSEIF CHECK_COM("파이즈리펠라", ARG)
		LOCALS = 파이즈리펠라
	ELSEIF CHECK_COM("치구청소펠라", ARG)
		LOCALS = 치구청소펠라
	ELSEIF CHECK_COM("청소펠라", ARG)
		LOCALS = 청소펠라
	ENDIF
CASE 92
	IF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ파이즈리
	ELSEIF CHECK_COM("３Ｐ봉사", ARG)
		SIF INSERT("인서트", TARGET, PLAYER:1)
			LOCALS = %LOCALS%(３Ｐ)
	ELSEIF CHECK_COM("파이즈리펠라", ARG)
		LOCALS = 파이즈리펠라
	;ELSEIF TEQUIP:목욕탕플레이
	;	LOCALS = 潜望鏡
	ENDIF
CASE 93
	SIF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ스마타
CASE 94
	SIF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ거품춤
CASE 95
	SIF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ풋잡
CASE 96
	IF CHECK_COM("Ａ자극손훑기", ARG)
		IF PREVCOM == 97
			LOCALS = Ａ자극팬티훑기
		ELSE
			LOCALS = Ａ자극손훑기
		ENDIF
	ELSEIF CHECK_COM("３Ｐ봉사", ARG)
		SIF INSERT("인서트", TARGET, PLAYER:1)
			LOCALS = %LOCALS%(３Ｐ)
	ELSEIF TEQUIP:넘어뜨리기
		LOCALS = 애널자극
	ENDIF
CASE 97
	IF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ팬티훑기
	ELSEIF CHECK_COM("３Ｐ봉사", ARG)
		LOCALS = %LOCALS%(３Ｐ)
	ELSEIF CHECK_COM("Ａ자극손훑기", ARG)
		LOCALS = Ａ자극팬티훑기
	ELSEIF CHECK_COM("파후파후손훑기", ARG)
		IF CHECK_COM("모유마시기가능", ARG)
			LOCALS = 수유팬티훑기
		ELSE
			LOCALS = 파후파후팬티훑기
		ENDIF
	ENDIF
CASE 98
	IF CHECK_COM("３Ｐ봉사", ARG)
		SIF INSERT("인서트", TARGET, PLAYER:1)
			LOCALS = %LOCALS%(３Ｐ)
	ELSEIF CHECK_COM("치구청소컨닐링구스", ARG)
		LOCALS = 치구청소컨닐링구스
	ELSEIF CHECK_COM("청소컨닐링구스", ARG)
		LOCALS = 청소컨닐링구스시킨다
	ELSEIF TEQUIP:넘어뜨리기
		LOCALS = 성기핥기
	ENDIF
CASE 99
	IF TEQUIP:식스나인
		LOCALS = 식스나인종료
	;서로청소플레이
	ELSEIF CHECK_COM("청소펠라", 91) + CHECK_COM("청소컨닐링구스", 98) && CHECK_COM("청소펠라", 4) + CHECK_COM("청소컨닐링구스", 1)
		LOCALS = 서로청소６９
	ENDIF
CASE 104
	IF CHECK_COM("Ｗ봉사", ARG)
		LOCALS = Ｗ파후파후
	ELSEIF CHECK_COM("파후파후손훑기", 104)
		SIF CHECK_COM("모유마시기가능", ARG)
			LOCALS = 수유
		IF PREVCOM == 97
			LOCALS = %LOCALS%팬티훑기
		ELSE
			LOCALS = %LOCALS%손훑기
		ENDIF
	ELSEIF CHECK_COM("모유마시기가능", ARG)
		LOCALS = 수유%LOCALS%
	ENDIF
CASE 120
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역레이프
CASE 126
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역애널
CASE 133
	SIF TEQUIP:아이마스크
		LOCALS = 안대를뗀다
CASE 134, 206
	IF TEQUIP:구속
		LOCALS = 구속을푼다
	ELSEIF TEQUIP:촉수
		LOCALS = 촉수긴박
	ELSE
		LOCALS = 밧줄・구속
	ENDIF
CASE 135
	SIF TEQUIP:재갈
		LOCALS = 재갈을뗀다
CASE 136
	IF COND("애널栓")
		IF COND("액체관장")
			LOCALS = 배설
		ELSE
			LOCALS = 장내가스배설
		ENDIF
	ELSEIF COND("액체관장")
		LOCALS = 관장액추가
	ENDIF
CASE 137
	SIF TEQUIP:확장벌룬
		LOCALS = 확장벌룬종료
CASE 138
	IF CHECK_COM("입内방뇨", ARG)
		LOCALS = 구내방뇨
	ELSEIF CHECK_COM("질内방뇨", ARG)
		LOCALS = 질내방뇨
		SIF CHECK_COM("자궁内방뇨", ARG)
			LOCALS = 자궁내방뇨
	ELSEIF CHECK_COM("온천관장", ARG)
		LOCALS = 온천관장
	ELSEIF CHECK_COM("유内방뇨", ARG)
		LOCALS = 유내방뇨
	ELSEIF CHECK_COM("방광内방뇨", ARG)
		LOCALS = 膀胱内방뇨
	ENDIF
CASE 139
	IF INSERT("인서트") || INSERT("삽입中") || TEQUIP:구속 || TEQUIP:아이마스크

	ELSEIF TEQUIP:목욕탕플레이
		LOCALS = 욕탕에들어간다
	ENDIF
CASE 140
	IF CHECK_COM("３Ｐ봉사", ARG)
		SIF INSERT("인서트", TARGET, PLAYER:1)
			LOCALS = %LOCALS%(３Ｐ)
	ENDIF
CASE 144
	IF TEQUIP:넘어뜨리기
		LOCALS = 성수플레이
	ELSEIF CHECK_COM("강제방뇨", ARG)
		LOCALS = 강제방뇨
	ENDIF
CASE 145
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역제모
CASE 149
	SIF TEQUIP:카테터
		LOCALS = 카테터를뽑는다
CASE 150
	SIF TEQUIP:딥스로트
		LOCALS = 딥스로트종료
CASE 170
	SIF TEQUIP:비디오카메라
		LOCALS = 촬영종료
CASE 171
	SIF TEQUIP:야외플레이
		LOCALS = 야외플레이종료
CASE 172
	SIF TEQUIP:목욕탕플레이
		LOCALS = 욕탕에서나간다
CASE 173
	SIF TEQUIP:새댁플레이
		LOCALS = 새댁플레이종료
CASE 174
	SIF TEQUIP:관내노출플레이
		LOCALS = 방으로돌아간다
CASE 175
	IF TEQUIP:넘어뜨리기
		IF EQUIP:팬티 && EQUIP:보디슈츠 + EQUIP:겉옷 == 0 && CHECK_CLO("팬티노출")
			LOCALS = 속옷을벗는다
		ELSE
			LOCALS = 알몸이된다
		ENDIF
	ELSEIF TEQUIP:구속 || TEQUIP:관내노출플레이 || TEQUIP:야외플레이
		IF EQUIP:팬티 && EQUIP:보디슈츠 + EQUIP:겉옷 == 0 && CHECK_CLO("팬티노출")
			LOCALS = 속옷을벗긴다
		ELSE
			LOCALS = 전부벗긴다
		ENDIF
	ENDIF
CASE 179
	SIF TEQUIP:수치플레이
		LOCALS = 수치플레이종료
CASE 182
	SIF TEQUIP:PLAYER:넘어뜨리기
		LOCALS = 넘어뜨리기종료

CASE 200
	SIF TEQUIP:촉수
		LOCALS = 촉수송환
CASE 201
	SIF TEQUIP:바이브
		LOCALS = 촉수삽입終了
CASE 202
	SIF TEQUIP:애널바이브
		LOCALS = 애널촉수終了
CASE 203
	SIF TEQUIP:클리캡
		LOCALS = 촉수클리자극終了
CASE 204
	SIF TEQUIP:니플캡
		LOCALS = 촉수유두자극終了
CASE 205
	SIF TEQUIP:착유기
		LOCALS = 촉수착유終了
CASE 207
	SIF TEQUIP:관장
		LOCALS = 배설
CASE 208
	SIF TEQUIP:촉수구욕
		LOCALS = 촉수구욕終了
CASE 209
	SIF TEQUIP:오나홀
		LOCALS = 촉수페니스자극終了

CASE 243
	;TARGETが唱える際はＷ넘어뜨리기커맨드
	IF GETBIT(MAGIC_USER(ARG, "커맨드"), 2)
		LOCALS = %TALENT_NAME(ARG, TALENT:ARG)%넘어뜨리기
	;MASTERとASSIが両方使える
	ELSEIF GETBIT(MAGIC_USER(ARG, "커맨드"), 0) && GETBIT(MAGIC_USER(ARG, "커맨드"), 1)
		;名称が違う
		IF TALENT_NAME(ARG, TALENT:MASTER:ARG) != TALENT_NAME(ARG, TALENT:ASSI:ARG)
			LOCALS = %TALENT_NAME(ARG, TALENT:MASTER:ARG)%・%TALENT_NAME(ARG, TALENT:ASSI:ARG)%
		ELSE
			LOCALS = %TALENT_NAME(ARG, TALENT:MASTER:ARG)%
		ENDIF
	;使用者がASSIのみ
	ELSEIF GETBIT(MAGIC_USER(ARG, "커맨드"), 0)
		LOCALS = %TALENT_NAME(ARG, TALENT:ASSI:ARG)%
	;使用者がMASTERのみ
	ELSEIF GETBIT(MAGIC_USER(ARG, "커맨드"), 1)
		LOCALS = %TALENT_NAME(ARG, TALENT:MASTER:ARG)%
	ENDIF

CASE 260
	SIF CHECK_COM("로션마사지", ARG)
		LOCALS = 로션尻애무

CASE 280
	SIF TEQUIP:PLAYER:구속 || STATE("바인드", PLAYER)
		LOCALS = 구속을푼다

;자위한다
CASE 282
	SELECTCASE PREVCOM
	CASE 3
		LOCALS = 相互자위
	CASE 1, 4, 9, 13, 14
	CASEELSE
		SIF TEQUIP:PLAYER:자위한다 == 3
			LOCALS = 相互자위
	ENDSELECT

CASE 301
	SIF TEQUIP:손대중
		LOCALS = 손대중을멈춘다
CASE 302
	SIF TEQUIP:연주중
		LOCALS = 연주중단
CASE 304
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역용간
CASE 305
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역Ａ용간
CASE 306
	SIF STATE("하드스킨", PLAYER)
		LOCALS = 하드스킨해제
ENDSELECT
RETURNF LOCALS

;-------------------------------------------------
;おもに넘어뜨리기など場面変化を考慮した標準のTRAINNAME
;（ここで설정したものに커맨드名が変わっても、커맨드の色が変化しない）
;-------------------------------------------------
@TRAIN_NAME_STANDARD(ARG)
#FUNCTIONS
LOCALS = %TRAINNAME:ARG%
SELECTCASE ARG
CASE 1
	SIF TEQUIP:넘어뜨리기
		LOCALS = 안면기승
CASE 9
	SIF TEQUIP:넘어뜨리기
		LOCALS = Ａ안면기승
CASE 11
	SIF TEQUIP:넘어뜨리기
		LOCALS = 가슴계곡을범한다
CASE 12
	SIF PENIS(TARGET) == 0
		LOCALS = 맨발로가랑이를자극
CASE 82
	SIF TEQUIP:넘어뜨리기
		LOCALS = 니플오나홀
CASE 96
	SIF TEQUIP:넘어뜨리기
		LOCALS = 애널자극
CASE 98
	SIF TEQUIP:넘어뜨리기
		LOCALS = 성기핥기
CASE 120
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역레이프
CASE 126
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역애널
CASE 144
	SIF TEQUIP:넘어뜨리기
		LOCALS = 성수플레이
CASE 145
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역제모

;160番台,조수による범용커맨드
CASE 160
	LOCALS = %TEXTS("조수の명칭")%を犯す
CASE 161
	LOCALS = %TEXTS("조수の명칭")%を犯させる
CASE 162
	LOCALS = %TEXTS("조수の명칭")%펠라
CASE 163
	LOCALS = %TEXTS("조수の명칭")%に키스

CASE 175
	IF TEQUIP:넘어뜨리기
		IF EQUIP:팬티 && EQUIP:보디슈츠 + EQUIP:겉옷 == 0 && CHECK_CLO("팬티노출")
			LOCALS = 속옷을벗는다
		ELSE
			LOCALS = 알몸이된다
		ENDIF
	ELSEIF TEQUIP:구속 && TEQUIP:넘어뜨리기 == 0
		IF EQUIP:팬티 && EQUIP:보디슈츠 + EQUIP:겉옷 == 0 && CHECK_CLO("팬티노출")
			LOCALS = 속옷을벗긴다
		ELSE
			LOCALS = 전부벗긴다
		ENDIF
	ENDIF
CASE 280
	SIF TEQUIP:PLAYER:구속 || STATE("바인드", PLAYER)
		LOCALS = 구속을푼다
CASE 304
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역용간
CASE 305
	SIF TEQUIP:넘어뜨리기
		LOCALS = 역Ａ용간
ENDSELECT
RETURNF LOCALS

;-------------------------------------------------
;조교のジャンル判定
;-------------------------------------------------
@TRAIN_GENRE(ARGS, ARG)
#FUNCTION
SELECTCASE ARGS
CASE "Ｖ조교"
	SELECTCASE ARG
	CASE 8, 31, 39, 60 TO 69, 177, 201, 304, 307
		RETURNF 1
	ENDSELECT
CASE "Ａ조교"
	SELECTCASE ARG
	CASE 2, 9, 33, 70 TO 79, 136, 138, 142, 143, 202, 207, 305, 308
		RETURNF 1
	ENDSELECT
CASE "Ｐ조교"
	SELECTCASE ARG
	CASE 4, 10 TO 12, 37, 120 TO 129, 209
		RETURNF 1
	ENDSELECT
CASE "도구조교"
	SELECTCASE ARG
	CASE 30 TO 59
		RETURNF 1
	ENDSELECT
CASE "ＳＭ조교"
	SELECTCASE ARG
	CASE 130 TO 159, 206, 207
		RETURNF 1
	ENDSELECT
ENDSELECT

;-------------------------------------------------
;物の大きさを判定する関数
;-------------------------------------------------
@SIZE(ARGS, ARG)
#FUNCTION
VARSET LOCAL
SELECTCASE ARGS
CASE "손가락の直径"
	SIF ARG == 0
		ARG = TARGET
	;薬손가락の一番太い部分の値の平均値を使う
	;신장を(50+13x)cmとすると손가락は(7+x)mmぐらいか
	;요정だと7～8mm, 小柄な여성で13mm, 장신な여성でも16～17mmぐらい. 남자だとそれぞれ+2mm
	LOCAL = MAX(BASE:ARG:신장 - 50, 0)/13 + 7

	SIF TALENT:ARG:남자
		LOCAL += 2
CASE "基本페니스사이즈"
	SIF ARG == 0
		ARG = PLAYER
	IF CONFIG("페니스상세설정")
		IF GETBIT(TALENT:ARG:페니스, 5)
			RETURNF 5
		ELSEIF GETBIT(TALENT:ARG:페니스, 4)
			RETURNF 4
		ELSEIF GETBIT(TALENT:ARG:페니스, 3)
			RETURNF 3
		ELSEIF GETBIT(TALENT:ARG:페니스, 2)
			RETURNF 2
		ELSEIF GETBIT(TALENT:ARG:페니스, 1)
			RETURNF 0
		ELSEIF GETBIT(TALENT:ARG:페니스, 0)
			RETURNF 1
		ENDIF
	ELSE
		RETURNF 1 + (TALENT:ARG:용의혈통 > 0) - (TALENT:ARG:몽마 + TALENT:ARG:상위몽마 + TALENT:ARG:마왕의조각 == 0 && AGE(ARG) == 1)
	ENDIF
CASE "페니스の直径"
	SIF ARG == 0
		ARG = PLAYER

	IF TALENT:ARG:요정
		LOCAL = -7
	ELSEIF STATE("미니멈", ARG)
		LOCAL = 0
	;여자はペニバン
	ELSEIF TALENT:ARG:여자
		LOCAL = 7
	ELSE
		LOCAL = SIZE("基本페니스사이즈", ARG)*7
		;우르즈군
		LOCAL += STATE("우르즈군", ARG)*3
		IF STATE("인라지", ARG)
			LOCAL += 7
		ELSEIF STATE("미니멈", ARG)
			LOCAL -= 7
		ENDIF
	ENDIF

	RETURNF 27 + LOCAL + BASE:ARG:식별번호%6
CASE "페니스"
	SIF ARG == 0
		ARG = PLAYER
	;요정or미니멈
	SIF TALENT:ARG:요정 || STATE("미니멈", ARG)
		RETURNF 0
	;여자はペニバン
	SIF TALENT:ARG:여자
		RETURNF 1
	LOCAL = SIZE("基本페니스사이즈", ARG)
	IF TALENT:ARG:일반인
		SELECTCASE RAND:100
		CASE IS >= 95
			LOCAL = 3
		CASE IS >= 85
			LOCAL = 2
		CASE IS >= 10
			LOCAL = 1
		CASE 0
			LOCAL = 0
		ENDSELECT
	ENDIF
	;우르즈군
	SIF LOCAL <= 2 && STATE("우르즈군", ARG) >= 3
		LOCAL += 1
	SIF STATE("인라지", ARG)
		LOCAL += 1
CASE "Ｗ페니스"
	IF PLAYER:1
		RETURNF 1 + SIZE("페니스", MASTER) + SIZE("페니스", PLAYER:1)
	ELSE
		RETURNF 1 + SIZE("페니스", MASTER)
	ENDIF
CASE "바이브"
	SIF ARG == 0
		ARG = TARGET
	SIF TEQUIP:ARG:바이브 == 0
		RETURNF 0
	;요정用は大きさ-1
	SELECTCASE GETBITS(TEQUIP:ARG:바이브, 0, 9)
	CASE 1p0
		LOCAL = 0
	CASE 1p1
		LOCAL = 1
	CASE 1p2
		LOCAL = 2
	CASE 1p3
		LOCAL = 3
	CASE 1p4
		LOCAL = 4
	CASE 1p5
		LOCAL = 5
	ENDSELECT
	;요정用바이브
	SIF TALENT:ARG:요정
		LOCAL = MAX(LOCAL - 1, 0)
CASE "Ａ바이브"
	SIF ARG == 0
		ARG = TARGET
	SIF TEQUIP:ARG:애널바이브 == 0
		RETURNF 0
	;요정用は大きさ-1
	SELECTCASE GETBITS(TEQUIP:ARG:애널바이브, 0, 9)
	CASE 1p0
		LOCAL = 0
	CASE 1p1
		LOCAL = 1
	CASE 1p2
		LOCAL = 2
	CASE 1p3
		LOCAL = 3
	CASE 1p4
		LOCAL = 4
	CASE 1p5
		LOCAL = 5
	ENDSELECT
	;요정用바이브
	SIF TALENT:ARG:요정
		LOCAL = MAX(LOCAL - 1, 0)
CASE "피스트"
	SIF ARG == 0
		ARG = PLAYER
	;これはSELECTCOM等で変動する. 最小で１, 최대で５となる
	IF SELECTCOM == 143
		RETURNF SIZE("Ｗ피스트", ARG)
	ELSEIF CHECK_COM("양손피스트")
		RETURNF SIZE("양손피스트", ARG)
	ELSE
		RETURNF SIZE("한손피스트", ARG)
	ENDIF
CASE "Ｗ피스트"
	SIF ARG == 0
		ARG = PLAYER
	RETURNF SIZE("한손피스트", ARG) + 1
CASE "한손피스트"
	SIF ARG == 0
		ARG = PLAYER
	LOCAL = 3 + TALENT:ARG:남자 - TALENT:ARG:요정
	SIF TALENT:ARG:작은몸집 || TALENT:ARG:오토코노코
		LOCAL -= 1
CASE "양손피스트"
	SIF ARG == 0
		ARG = PLAYER
	LOCAL = SIZE("한손피스트", ARG)
	RETURNF MAX(LOCAL*2 - 1, LOCAL + 2)
CASE "드래곤"
	RETURNF 5
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF LOCAL

;-------------------------------------------------
;物の堅さを判定する関数
;-------------------------------------------------
@HARD(ARGS, ARG)
#FUNCTION

VARSET LOCAL

SELECTCASE ARGS
CASE "페니스"
	SIF ARG == 0
		ARG = PLAYER
	;ペニバン
	SIF PENIS(ARG) == 0
		RETURNF 3

	LOCAL = 1

	;하드스킨や우르즈군
	IF STATE("하드스킨", ARG) && STATE("우르즈군", ARG) >= 3
		LOCAL += 3
	ELSEIF STATE("하드스킨", ARG)
		LOCAL += 2
	ELSEIF STATE("우르즈군", ARG)
		LOCAL += 1
	ENDIF
	SIF TALENT:ARG:용의혈통
		LOCAL += 2
CASE "바이브"
	SIF ARG == 0
		ARG = TARGET
	SIF TEQUIP:ARG:바이브 == 0
		RETURNF 0
	LOCAL = 3
	;촉수
	SIF TEQUIP:ARG:촉수
		LOCAL = 2
CASE "Ａ바이브"
	SIF ARG == 0
		ARG = TARGET
	SIF TEQUIP:ARG:애널바이브 == 0
		RETURNF 0
	IF COND("애널비즈", ARG)
		LOCAL = 1
	ELSE
		SELECTCASE GETBITS(TEQUIP:ARG:바이브, 0, 9)
		CASE 1p0
			LOCAL = 2
		CASEELSE
			LOCAL = 3
		ENDSELECT
	ENDIF
	;촉수
	SIF TEQUIP:ARG:촉수
		LOCAL = 2
CASE "피스트"
	SIF ARG == 0
		ARG = PLAYER
	LOCAL = 3
	;남자
	SIF TALENT:ARG:남자
		LOCAL += 1
	;하드스킨
	SIF STATE("하드스킨", ARG)
		LOCAL += 1
	;슬라임
	SIF TALENT:ARG:슬라임
		LOCAL -= 2
CASE "드래곤"
	RETURNF 4
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF LOCAL

;-------------------------------------------------
;질を使える(中に入れることが出来る)か判定
;TEQUIPについては, ARG:1で例外を손가락定できる
;-------------------------------------------------
@USE_V(ARG, ARG:1)
#FUNCTION
;남자or検閲orＶ노출不可
SIF TALENT:ARG:남자 || COND("운명검열：보지", ARG) || !CHECK_CLO("Ｖ노출可")
	RETURNF 0
;바이브삽입中はダメ
SIF TEQUIP:ARG:바이브 && ARG:1 != 11
	RETURNF 0
;バルーン사용중は不可
SIF TEQUIP:ARG:확장벌룬 == 1 && ARG:1 != 48
	RETURNF 0
RETURNF 1

;-------------------------------------------------
;애널を使える(中に入れることが出来る)か判定
;TEQUIPについては, ARG:1で例外を손가락定できる
;-------------------------------------------------
@USE_A(ARG, ARG:1)
#FUNCTION
;検閲orＡ노출不可
SIF COND("운명검열：애널", ARG) || !CHECK_CLO("Ａ노출可")
	RETURNF 0
;애널바이브삽입中はダメ
SIF TEQUIP:ARG:애널바이브 && ARG:1 != 13
	RETURNF 0
;애널플러그사용중はダメ
SIF COND("애널플러그", ARG) && ARG:1 != 46
	RETURNF 0
;バルーン사용중は不可
SIF TEQUIP:ARG:확장벌룬 == 2 && ARG:1 != 48
	RETURNF 0
RETURNF 1

;-------------------------------------------------
;ARGのARGS状態をEQUIP:스테이트변화～9で管理する
;-------------------------------------------------
@STATE(ARGS, ARG)
#FUNCTION
SIF ARG < 0
	RETURNF 0
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS
CASE "미니멈"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 0)+TALENT:ARG:항상미니멈
CASE "센시브"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 1)+TALENT:ARG:항상센시브
CASE "투와이스"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 2)
CASE "피블"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 3)
CASE "드렁크", "ドランク"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 4)
CASE "술주정", "悪酔い"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 5)
CASE "황홀"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 6)
CASE "撃沈"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 7)
CASE "흐물흐물", "ふにゃふにゃ"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 8)
CASE "하드스킨"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 9)
CASE "구현"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 10)
CASE "바인드"
	RETURNF GETBITS(EQUIP:ARG:스테이트변화, 11, 14)
CASE "바인드：손"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 11)
CASE "바인드：다리"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 12)
CASE "바인드：입"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 13)
CASE "바인드：Ｐ"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 14)
CASE "인라지"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 15)+TALENT:ARG:항상인라지
CASE "비젼"
	RETURNF GETBIT(EQUIP:ARG:스테이트변화, 16)

CASE "우르즈군"
	RETURNF MIN(EQUIP:ARG:우르즈군+TALENT:ARG:항상우르즈군, 3)
CASE "시길군"
	RETURNF EQUIP:ARG:시길군
CASE "에올군"
	RETURNF EQUIP:ARG:에올군

CASE "군"
	RETURNF (EQUIP:ARG:우르즈군&&(TALENT:ARG:항상우르즈군 == 0) )+EQUIP:ARG:시길군+EQUIP:ARG:에올군
CASE "バッド"
	LOCAL = GETBIT(EQUIP:ARG:스테이트변화, 0) && (TALENT:ARG:항상미니멈 == 0)
	LOCAL += GETBIT(EQUIP:ARG:스테이트변화, 1) && (TALENT:ARG:항상센시브 == 0)
	LOCAL += GETBITS(EQUIP:ARG:스테이트변화, 3, 6, 8) + GETBITS(EQUIP:ARG:스테이트변화, 11, 14, 16)
	RETURNF LOCAL
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF 0

@ADD_STATE, ARG, ARGS
SIF ARG < 0
	RETURN 0
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS
CASE "미니멈"
	SETBIT EQUIP:ARG:스테이트변화, 0
CASE "센시브"
	SETBIT EQUIP:ARG:스테이트변화, 1
CASE "투와이스"
	SETBIT EQUIP:ARG:스테이트변화, 2
CASE "피블"
	SETBIT EQUIP:ARG:스테이트변화, 3
CASE "드렁크"
	SETBIT EQUIP:ARG:스테이트변화, 4
CASE "술주정"
	SETBIT EQUIP:ARG:스테이트변화, 5
CASE "황홀"
	SETBIT EQUIP:ARG:스테이트변화, 6
	TFLAG:99 = 0
CASE "撃沈"
	SETBIT EQUIP:ARG:스테이트변화, 7
CASE "흐물흐물"
	SETBIT EQUIP:ARG:스테이트변화, 8
CASE "하드스킨"
	SETBIT EQUIP:ARG:스테이트변화, 9
CASE "구현"
	SETBIT EQUIP:ARG:스테이트변화, 10
	TALENT:ARG:여자 = 0
	TALENT:ARG:후타나리 = 2
CASE "바인드：손"
	SETBIT EQUIP:ARG:스테이트변화, 11
	SETBIT TEQUIP:ARG:구속, 20
	SETBIT TEQUIP:ARG:구속, 30
	SIF ARG == PLAYER
		TEQUIP:넘어뜨리기 = 1
CASE "바인드：다리"
	SETBIT EQUIP:ARG:스테이트변화, 12
	SETBIT TEQUIP:ARG:구속, 21
	SETBIT TEQUIP:ARG:구속, 31
	SIF ARG == PLAYER
		TEQUIP:넘어뜨리기 = 1
CASE "바인드：입"
	SETBIT EQUIP:ARG:스테이트변화, 13
	SIF ARG == PLAYER
		TEQUIP:넘어뜨리기 = 1
CASE "바인드：Ｐ"
	SETBIT EQUIP:ARG:스테이트변화, 14
	SIF ARG == PLAYER
		TEQUIP:넘어뜨리기 = 1
CASE "인라지"
	SETBIT EQUIP:ARG:스테이트변화, 15
CASE "비젼"
	SETBIT EQUIP:ARG:스테이트변화, 16

CASE "미약"
	TEQUIP:ARG:미약 += 100
	SIF TALENT:ARG:약독내성
		TEQUIP:ARG:미약 /= 4

;グンは一回でMAXになるように変更
CASE "우르즈군"
	;EQUIP:ARG:우르즈군 = MIN(EQUIP:ARG:우르즈군 + 1, 3)
	EQUIP:ARG:우르즈군 = 3
CASE "시길군"
	;EQUIP:ARG:시길군 = MIN(EQUIP:ARG:시길군 + 1, 3)
	EQUIP:ARG:시길군 = 3
CASE "에올군"
	;EQUIP:ARG:에올군 = MIN(EQUIP:ARG:에올군 + 1, 3)
	EQUIP:ARG:에올군 = 3
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT

@REMOVE_STATE, ARG, ARGS
SIF ARG < 0
	RETURN 0
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS
CASE "미니멈"
	CLEARBIT EQUIP:ARG:스테이트변화, 0
CASE "센시브"
	CLEARBIT EQUIP:ARG:스테이트변화, 1
CASE "투와이스"
	CLEARBIT EQUIP:ARG:스테이트변화, 2
CASE "피블"
	CLEARBIT EQUIP:ARG:스테이트변화, 3
CASE "드렁크"
	CLEARBIT EQUIP:ARG:스테이트변화, 4
CASE "술주정"
	CLEARBIT EQUIP:ARG:스테이트변화, 5
CASE "황홀"
	CLEARBIT EQUIP:ARG:스테이트변화, 6
	TFLAG:99 = 0
CASE "撃沈"
	CLEARBIT EQUIP:ARG:스테이트변화, 7
CASE "흐물흐물"
	CLEARBIT EQUIP:ARG:스테이트변화, 8
CASE "하드스킨"
	CLEARBIT EQUIP:ARG:스테이트변화, 9
CASE "구현"
	CLEARBIT EQUIP:ARG:스테이트변화, 10
	TALENT:ARG:여자 = 1
	TALENT:ARG:후타나리 = 0
CASE "바인드"
	CLEARBIT EQUIP:ARG:스테이트변화, 11
	CLEARBIT EQUIP:ARG:스테이트변화, 12
	CLEARBIT EQUIP:ARG:스테이트변화, 13
	CLEARBIT EQUIP:ARG:스테이트변화, 14
	SIF GETBIT(TEQUIP:ARG:구속, 30)
		CLEARBIT TEQUIP:ARG:구속, 20
	SIF GETBIT(TEQUIP:ARG:구속, 31)
		CLEARBIT TEQUIP:ARG:구속, 21
	CLEARBIT TEQUIP:ARG:구속, 30
	CLEARBIT TEQUIP:ARG:구속, 31
CASE "바인드：손"
	CLEARBIT EQUIP:ARG:스테이트변화, 11
	SIF GETBIT(TEQUIP:ARG:구속, 30)
		CLEARBIT TEQUIP:ARG:구속, 20
	CLEARBIT TEQUIP:ARG:구속, 30
CASE "바인드：다리"
	CLEARBIT EQUIP:ARG:스테이트변화, 12
	SIF GETBIT(TEQUIP:ARG:구속, 31)
		CLEARBIT TEQUIP:ARG:구속, 21
	CLEARBIT TEQUIP:ARG:구속, 31
CASE "바인드：입"
	CLEARBIT EQUIP:ARG:스테이트변화, 13
CASE "바인드：Ｐ"
	CLEARBIT EQUIP:ARG:스테이트변화, 14
CASE "인라지"
	CLEARBIT EQUIP:ARG:스테이트변화, 15
CASE "비젼"
	CLEARBIT EQUIP:ARG:스테이트변화, 16

CASE "우르즈군"
	EQUIP:ARG:우르즈군 = 0
CASE "시길군"
	EQUIP:ARG:시길군 = 0
CASE "에올군"
	EQUIP:ARG:에올군 = 0
CASE "군"
	EQUIP:ARG:우르즈군 = 0
	EQUIP:ARG:시길군 = 0
	EQUIP:ARG:에올군 = 0

CASE "バッド"
	CLEARBIT EQUIP:ARG:스테이트변화, 0
	CLEARBIT EQUIP:ARG:스테이트변화, 1
	CLEARBIT EQUIP:ARG:스테이트변화, 3
	CLEARBIT EQUIP:ARG:스테이트변화, 4
	CLEARBIT EQUIP:ARG:스테이트변화, 5
	CLEARBIT EQUIP:ARG:스테이트변화, 6
	CLEARBIT EQUIP:ARG:스테이트변화, 8
	CLEARBIT EQUIP:ARG:스테이트변화, 11
	CLEARBIT EQUIP:ARG:스테이트변화, 12
	CLEARBIT EQUIP:ARG:스테이트변화, 13
	CLEARBIT EQUIP:ARG:스테이트변화, 14
	CLEARBIT EQUIP:ARG:스테이트변화, 16
	SIF GETBIT(TEQUIP:ARG:구속, 30)
		CLEARBIT TEQUIP:ARG:구속, 20
	SIF GETBIT(TEQUIP:ARG:구속, 31)
		CLEARBIT TEQUIP:ARG:구속, 21
	CLEARBIT TEQUIP:ARG:구속, 30
	CLEARBIT TEQUIP:ARG:구속, 31
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT

;-------------------------------------------------
;PALAMの上昇予定値
;-------------------------------------------------
@UP_PALAM(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
LOCAL = CUP:(ARG:1):ARG + PALAM:(ARG:1):ARG
RETURNF LOCAL

;-------------------------------------------------
;エラーのでないPALAMLV. 間違えやすそうな気もする. 
;-------------------------------------------------
@PALAM_LV(ARG)
#FUNCTION
SELECTCASE ARG
CASE IS <= 0
	RETURNF 0
;PALAMLVの値は、順に1:100, 2:500, 3:3000, 4:1万, 5:3万, 6:6万, 7:10万, 8:15万, 9:25万
CASE 1 TO 9
	LOCAL = PALAMLV:ARG
CASE 10
	LOCAL = 500000
CASE 11
	LOCAL = 1000000
CASE 12
	LOCAL = 2500000
CASE 13
	LOCAL = 5000000
CASE 14
	LOCAL = 10000000
CASE 15
	LOCAL = 50000000
CASEELSE
	LOCAL = 100000000
ENDSELECT

RETURNF LOCAL

;-------------------------------------------------
;ARGのPALAMLVを返す
;-------------------------------------------------
@GET_PALAMLV(ARG)
#FUNCTION
SELECTCASE ARG
CASE IS <= 0
	RETURNF 0
CASE IS < 250000
	LOCAL = GETPALAMLV(ARG, 8)
CASE IS < 500000
	LOCAL = 9
CASE IS < 1000000
	LOCAL = 10
CASE IS < 2500000
	LOCAL = 11
CASE IS < 5000000
	LOCAL = 12
CASE IS < 10000000
	LOCAL = 13
CASE IS < 50000000
	LOCAL = 14
CASE IS < 100000000
	LOCAL = 15
CASEELSE
	LOCAL = 16
ENDSELECT

RETURNF LOCAL

;-------------------------------------------------
;ARGの数値をPALAM_LVを用いてARG = PALAM_LV(n) + (PALAM_LV(n+1) - PALAM_LV(n) ) * X で表し、
;nにARG:1少ない値を代入した値を返させる。ARG:1を省略したらARG:1は1
;例)ARG = 3512, ARG:1 = 1 なら ARG = PALAM_LV(3) + (PALAM_LV(4) - PALAM_LV(3) ) * 0.073なので、
;　 ARGをPALAM_LV(2) + (PALAM_LV(3) - PALAM_LV(2) ) * 0.073 = 682にする
;おもに、소질の影響で得るPALAMを少なくさせたい時に使う
;-------------------------------------------------
@DOWN_PALAMLV(ARG, ARG:1)
#FUNCTION
#DIM LCOUNT
#DIM MEMO_PALAMLV
#DIM MEMO_DIF, 2
#DIM MEMO_PER

;ARGが100未満なら０
SIF GET_PALAMLV(ARG) <= 0
	RETURNF 0
SIF ARG:1 <= 0
	ARG:1 = 1

;ARGのPALAMLVを求める
MEMO_PALAMLV = GET_PALAMLV(ARG)
MEMO_DIF = PALAM_LV(MEMO_PALAMLV + 1) - PALAM_LV(MEMO_PALAMLV)
MEMO_DIF:1 = ARG - PALAM_LV(MEMO_PALAMLV)

FOR LCOUNT, 0, 101
	SELECTCASE MEMO_DIF * LCOUNT / 100
	CASE IS >= MEMO_DIF:1
		MEMO_PER = LCOUNT
		BREAK
	ENDSELECT
NEXT

RETURNF PALAM_LV(MEMO_PALAMLV - ARG:1) + (PALAM_LV(MEMO_PALAMLV + 1 - ARG:1) - PALAM_LV(MEMO_PALAMLV - ARG:1) ) * MEMO_PER / 100

;-------------------------------------------------
;@DOWN_PALAMLV(ARG)の逆方向版
;-------------------------------------------------
@UP_PALAMLV(ARG, ARG:1)
#FUNCTION
#DIM LCOUNT
#DIM MEMO_PALAMLV
#DIM MEMO_DIF, 2
#DIM MEMO_PER

;ARGが100未満の時に０を100にするか、マイルドに５倍にしておくか…
;試しに０を100にしてみる
;SIF ARG <= 100
;	RETURNF ARG * 5
SIF ARG:1 <= 0
	ARG:1 = 1

;ARGのPALAMLVを求める
MEMO_PALAMLV = GET_PALAMLV(ARG)
MEMO_DIF = PALAM_LV(MEMO_PALAMLV + 1) - PALAM_LV(MEMO_PALAMLV)
MEMO_DIF:1 = ARG - PALAM_LV(MEMO_PALAMLV)

FOR LCOUNT, 0, 101
	SELECTCASE MEMO_DIF * LCOUNT / 100
	CASE IS >= MEMO_DIF:1
		MEMO_PER = LCOUNT
		BREAK
	ENDSELECT
NEXT

RETURNF PALAM_LV(MEMO_PALAMLV + ARG:1) + (PALAM_LV(MEMO_PALAMLV + 1 + ARG:1) - PALAM_LV(MEMO_PALAMLV + ARG:1) ) * MEMO_PER / 100


;-------------------------------------------------
;EXPの段階でよく用いる値をLVにしてみた. EXPLVとは別物なので注意! 
;-------------------------------------------------
@EXP_LV(ARG)
#FUNCTION
SELECTCASE ARG
CASE IS <= 0
	RETURNF 0
CASE 1
	LOCAL = 5
CASE 2
	LOCAL = 20
CASE 3
	LOCAL = 50
CASE 4
	LOCAL = 150
CASE 5
	LOCAL = 300
CASE 6
	LOCAL = 600
CASE 7
	LOCAL = 1000
CASEELSE
	LOCAL = 1000 + (ARG - 7)*500
ENDSELECT

RETURNF LOCAL

@GET_EXP_LV(ARG)
#FUNCTION
SELECTCASE ARG
CASE IS < 5
	RETURNF 0
CASE IS < 20
	RETURNF 1
CASE IS < 50
	RETURNF 2
CASE IS < 150
	RETURNF 3
CASE IS < 300
	RETURNF 4
CASE IS < 600
	RETURNF 5
CASE IS < 1000
	RETURNF 6
CASEELSE
	LOCAL = (ARG - 1000)/500 + 7
ENDSELECT

RETURNF LOCAL


;-------------------------------------------------
;今回の조교でARG:1が得たARG経験
;@EVENTTURNEND内で初期化される
;-------------------------------------------------
@EXP_GAIN(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
LOCAL = EXP:(ARG:1):ARG - TCVAR:(ARG:1):(ARG + 200)
RETURNF LOCAL

@RESET_EXP_GAIN, ARG
FOR LOCAL, 0, 100
	TCVAR:ARG:(LOCAL + 200) = EXP:ARG:LOCAL
NEXT


@EQ_EXP_GAIN, ARG, ARG:1
TCVAR:(ARG:1):(ARG + 200) = EXP:(ARG:1):ARG

;-------------------------------------------------
;キャラARG:1が得たARGS経験の値ARGを, 加算しつつ表示させるための関数. ARGはTARGETならば省略가능
;例）CALL PRINT_EXP_ADD, "수치쾌락경험", 10, PLAYERだと, 
;EXP:PLAYER:수치쾌락경험 += 10
;PRINTFORML 수치쾌락경험＋{10}（%CALLNAME:PLAYER%）
;に等しい. 
;-------------------------------------------------
@PRINTL_EXP_ADD, ARGS, ARG, ARG:1
SIF ARG <= 0 || ARG:1 < 0
	RETURN 0
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET

EXP:(ARG:1):ARGS += ARG
PRINTFORML %ARGS%＋{ARG}\@ ARG:1 != TARGET ? （%CALLNAME:(ARG:1)%） # \@

;-------------------------------------------------
;PRINTL_EXP_ADDのウェイト有り版
;-------------------------------------------------
@PRINTW_EXP_ADD, ARGS, ARG, ARG:1
SIF ARG <= 0 || ARG:1 < 0
	RETURN 0
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET

EXP:(ARG:1):ARGS += ARG
PRINTFORMW %ARGS%＋{ARG}\@ ARG:1 != TARGET ? （%CALLNAME:(ARG:1)%） # \@

;-------------------------------------------------
;FIRSTEXPは今までの조교でARG経験を得たことがあるかどうかの判定等に用いる
;-------------------------------------------------
@FIRSTEXP(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
LOCAL = MAX(CFLAG:(ARG:1):(800 + ARG), EXP_GAIN(ARG, ARG:1) )
RETURNF LOCAL

;-------------------------------------------------
;FIRSTEXPの플래그をセットする
;タイミングは@EVENTTURNEND_FLAGで조교종료後の一回のみ見る（조교以外で得た経験は無視する）
;-------------------------------------------------
@SET_FIRSTEXP, ARG
SIF EXP:ARG:조교횟수 == 0
	RETURN 0

FOR LOCAL, 0, 100
	CFLAG:ARG:(800 + LOCAL) += EXP:ARG:LOCAL - TCVAR:ARG:(LOCAL+200)
NEXT

;-------------------------------------------------
;PREVUP(ARG, ARG:1)は前回ターンでARG:1が得たUP
;-------------------------------------------------
@PREVUP(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
LOCAL = TCVAR:(ARG:1):(40 + ARG)
RETURNF LOCAL

@SET_PREVUP, ARG
FOR LOCAL, 0, 16
	TCVAR:ARG:(40 + LOCAL) = CUP:ARG:LOCAL
NEXT

;-------------------------------------------------
;PREVEX(ARGS, ARG)は前回ターンでARG:1が得たNOWEX:ARGS
;-------------------------------------------------
@PREVEX(ARGS, ARG)
#FUNCTION
SIF ARG == 0 && TARGET
	ARG = TARGET

RETURNF TCVAR:ARG:(GETNUM(EX, ARGS) + 60)


@SET_PREVEX, ARG
FOR LOCAL, 0, 40
	TCVAR:ARG:(60 + LOCAL) = NOWEX:ARG:LOCAL
NEXT

;-------------------------------------------------
;SEXUAL_PLAYは, 호색なキャラに보정がかかる플레이
;ABNORMAL_PLAYは도착적なキャラに보정がかかる플레이
;ORAL_PLAYはお입を使った플레이
;-------------------------------------------------
@SEXUAL_PLAY()
#FUNCTION
SELECTCASE SELECTCOM
CASE 0 TO 14, 30 TO 32, 60 TO 129, 260, 261
	RETURNF 1
ENDSELECT
RETURNF 0

@ABNORMAL_PLAY()
#FUNCTION
SELECTCASE SELECTCOM
CASE 2, 9, 14, 33, 70 TO 79, 96, 130 TO 159, 170, 171, 174, 179, 260 TO 279, 303 TO 305, 505
	RETURNF 1
ENDSELECT
RETURNF 0

@ORAL_PLAY()
#FUNCTION
SELECTCASE SELECTCOM
CASE 6, 91, 96, 98, 99, 140, 208, 311
	RETURNF 1
ENDSELECT
RETURNF 0

;-------------------------------------------------
;FIRSTCOMは今までに선택した커맨드の記録
;今までの조교でARGを選んだかどうか判定
;とりあえず, Train番号640番までとする
;-------------------------------------------------
@FIRSTCOM(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
SIF GETBIT(CFLAG:(ARG:1):(710 + ARG/64), ARG%64)
	RETURNF 1
RETURNF 0

;-------------------------------------------------
;FIRSTCOMの状態ごとの記録版
;ARGSに入る文字列は基本的には全部全角です. 間違えやすいので注意
;-------------------------------------------------
@FIRSTCOM_EX(ARGS, ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
SELECTCASE ARGS
CASE "굴복각인ＬＶ１", "굴복각인ＬＶ1", "굴복각인LV1", "굴복각인LV１", "굴복각인Lv1", "굴복각인Lv１"
	SIF GETBIT(CFLAG:(ARG:1):(720 + ARG/64), ARG%64)
		RETURNF 1
CASE "굴복각인ＬＶ２", "굴복각인ＬＶ2", "굴복각인LV2", "굴복각인LV２", "굴복각인Lv2", "굴복각인Lv２"
	SIF GETBIT(CFLAG:(ARG:1):(730 + ARG/64), ARG%64)
		RETURNF 1
CASE "굴복각인ＬＶ３", "굴복각인ＬＶ3", "굴복각인LV3", "굴복각인LV３", "굴복각인Lv3", "굴복각인Lv３"
	SIF GETBIT(CFLAG:(ARG:1):(740 + ARG/64), ARG%64)
		RETURNF 1
CASE "연모"
	SIF GETBIT(CFLAG:(ARG:1):(750 + ARG/64), ARG%64)
		RETURNF 1
CASE "음란"
	SIF GETBIT(CFLAG:(ARG:1):(760 + ARG/64), ARG%64)
		RETURNF 1
CASE "상사상애"
	SIF GETBIT(CFLAG:(ARG:1):(770 + ARG/64), ARG%64)
		RETURNF 1
CASE "반발각인ＬＶ３", "반발각인ＬＶ3", "반발각인LV3", "반발각인LV３", "반발각인Lv3", "반발각인Lv３"
	SIF GETBIT(CFLAG:(ARG:1):(780 + ARG/64), ARG%64)
		RETURNF 1
ENDSELECT
RETURNF 0

;-------------------------------------------------
;FIRSTCOMS_EX(ARGS, ARGS:1, ARG)はSELECTCOMでなく커맨드群(ARGS:1部分)対応のFIRSTCOM_EX
;ARGSに入る文字列は基本的には全部全角です. 間違えやすいので注意
;-------------------------------------------------
@FIRSTCOMS_EX(ARGS, ARGS:1, ARG)
#FUNCTION
#DIM LCOUNT
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS:1
CASE "Ｖ삽입"
	;Ｖ인서트を선택済みなら1を返す
	SIF FIRSTCOM_EX(ARGS, 177, ARG)
		RETURNF 1
	FOR LCOUNT, 60, 70
		SIF FIRSTCOM_EX(ARGS, LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ삽입"
	;Ａ인서트を선택済みなら1を返す
	FOR LCOUNT, 70, 80
		SIF FIRSTCOM_EX(ARGS, LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "요도삽입"
	;インサートを선택済みなら1を返す
	SIF FIRSTCOM_EX(ARGS, 83, ARG)
		RETURNF 1
CASE "Ｖ逆삽입"
	FOR LCOUNT, 120, 125
		SIF FIRSTCOM_EX(ARGS, LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ逆삽입"
	FOR LCOUNT, 125, 130
		SIF FIRSTCOM_EX(ARGS, LCOUNT, ARG)
			RETURNF 1
	NEXT
ENDSELECT
RETURNF 0


;-------------------------------------------------
;CHOSECOMは今回선택した커맨드の記録
;今回の조교でARGを選んだかどうか判定
;とりあえず, Train番号640番までとする
;-------------------------------------------------
@CHOSECOM(ARG, ARG:1)
#FUNCTION
SIF ARG:1 == 0 && TARGET
	ARG:1 = TARGET
SIF GETBIT(TCVAR:(ARG:1):(30 + ARG/64), ARG%64)
	RETURNF 1
RETURNF 0

;-------------------------------------------------
;FIRST_EVは今までに経験した이벤트の記録
;-------------------------------------------------
@FIRST_EV(ARGS, ARG)
#FUNCTION
SIF ARG == 0 && TARGET
	ARG = TARGET
LOCAL = NUM_EV(ARGS)
SIF GETBIT(CFLAG:ARG:(700 + LOCAL/64), LOCAL%64)
	RETURNF 1
RETURNF 0

@SET_CHOSECOM, ARG, ARG:1
SIF ARG < 0
	RETURN 0
;基本的にはSELECTCOMだが, Ｗ넘어뜨리기のとき対応
IF ARG:1 >= 0
	LOCAL = ARG:1
	;TCVAR:30～39に記録し, CFLAG:710～719に@FIRSTCOMの変数もセット
	SETBIT TCVAR:ARG:(30 + LOCAL/64), LOCAL%64
	SETBIT CFLAG:ARG:(710 + LOCAL/64), LOCAL%64
	;CFLAG:720～に@FIRSTCOM_EXの変数もセット
	SIF MARK:ARG:굴복각인 >= 1
		SETBIT CFLAG:ARG:(720 + LOCAL/64), LOCAL%64
	SIF MARK:ARG:굴복각인 >= 2
		SETBIT CFLAG:ARG:(730 + LOCAL/64), LOCAL%64
	SIF MARK:ARG:굴복각인 >= 3
		SETBIT CFLAG:ARG:(740 + LOCAL/64), LOCAL%64
	SIF TALENT:ARG:연모
		SETBIT CFLAG:ARG:(750 + LOCAL/64), LOCAL%64
	SIF TALENT:ARG:음란
		SETBIT CFLAG:ARG:(760 + LOCAL/64), LOCAL%64
	SIF TALENT:ARG:상사상애
		SETBIT CFLAG:ARG:(770 + LOCAL/64), LOCAL%64
	SIF MARK:ARG:반발각인 == 3
		SETBIT CFLAG:ARG:(780 + LOCAL/64), LOCAL%64
ENDIF
;ARGが조수ならば, 今回の커맨드も記録する
IF ARG == ASSI
	PREVCOM:1 = SELECTCOM:1
	PREVCOM:2 = SELECTCOM:2
	PREVCOM:3 = SELECTCOM:3
ENDIF


@RESET_CHOSECOM, ARG
VARSET TCVAR:ARG:0, 0, 30, 40
VARSET TCVAR:ARG:0, 0, 140, 150

;-------------------------------------------------
;FIRSTCOMS(ARGS)は今までに선택した커맨드群の記録
;CHOSECOMS(ARGS)は今回선택した커맨드群の記録
;-------------------------------------------------
@FIRSTCOMS(ARGS, ARG)
#FUNCTION
#DIM LCOUNT
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS
CASE "삽입"
	;ＶorＡorインサートを선택済みなら1を返す
	SIF FIRSTCOM(83, ARG)
		RETURNF 1
	SIF FIRSTCOM(177, ARG)
		RETURNF 1
	FOR LCOUNT, 60, 80
		SIF FIRSTCOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ｖ삽입"
	;Ｖ인서트を선택済みなら1を返す
	SIF FIRSTCOM(177, ARG)
		RETURNF 1
	FOR LCOUNT, 60, 70
		SIF FIRSTCOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ삽입"
	;Ａ인서트を선택済みなら1を返す
	FOR LCOUNT, 70, 80
		SIF FIRSTCOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "요도삽입"
	SIF FIRSTCOM(83, ARG)
		RETURNF 1
CASE "Ｖ逆삽입"
	FOR LCOUNT, 120, 125
		SIF FIRSTCOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ逆삽입"
	FOR LCOUNT, 125, 130
		SIF FIRSTCOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
ENDSELECT
RETURNF 0

@CHOSECOMS(ARGS, ARG)
#FUNCTION
#DIM LCOUNT
SIF ARG == 0 && TARGET
	ARG = TARGET
SELECTCASE ARGS
CASE "삽입"
	;ＶorＡorインサートを선택済みなら1を返す
	SIF CHOSECOM(83, ARG)
		RETURNF 1
	SIF CHOSECOM(177, ARG)
		RETURNF 1
	FOR LCOUNT, 60, 80
		SIF CHOSECOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ｖ삽입"
	;Ｖ인서트を선택済みなら1を返す
	SIF CHOSECOM(177, ARG)
		RETURNF 1
	FOR LCOUNT, 60, 70
		SIF CHOSECOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ삽입"
	;Ａ인서트を선택済みなら1を返す
	FOR LCOUNT, 70, 80
		SIF CHOSECOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "요도삽입"
	;インサートを선택済みなら1を返す
	SIF CHOSECOM(83, ARG)
		RETURNF 1
CASE "Ｖ逆삽입"
	FOR LCOUNT, 120, 125
		SIF CHOSECOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
CASE "Ａ逆삽입"
	FOR LCOUNT, 125, 130
		SIF CHOSECOM(LCOUNT, ARG)
			RETURNF 1
	NEXT
ENDSELECT
RETURNF 0

;-------------------------------------------------
;CHOSE_EVは今回経験した이벤트の記録
;特に, このターンに得たものについては2を返す
;-------------------------------------------------
@CHOSE_EV(ARGS, ARG)
#FUNCTION
SIF ARG == 0 && TARGET
	ARG = TARGET
LOCAL = NUM_EV(ARGS)
SIF GETBIT(TCVAR:ARG:(10 + LOCAL/64), LOCAL%64)
	RETURNF 2
SIF GETBIT(TCVAR:ARG:(140 + LOCAL/64), LOCAL%64)
	RETURNF 1
RETURNF 0

@SET_EV, ARG, ARGS
LOCAL = NUM_EV(ARGS)
SETBIT TCVAR:ARG:(10 + LOCAL/64), LOCAL%64
SETBIT TCVAR:ARG:(140 + LOCAL/64), LOCAL%64
SETBIT CFLAG:ARG:(700 + LOCAL/64), LOCAL%64

;-------------------------------------------------
;특수な이벤트の番号と이벤트名の対応
;조교中などの이벤트番号管理もここで行う(이벤트番号0は설정禁止)
;記録するために用意されているFLAGのビット数の問題があるので, とりあえず640番まで. 
;-------------------------------------------------
@NUM_EV(ARGS)
#FUNCTION
SELECTCASE ARGS
CASE "조교후자위"
	RETURNF 1
CASE "조교후레즈플레이"
	RETURNF 2
CASE "조교후섹스"
	RETURNF 3
CASE "조교후Ａ섹스"
	RETURNF 4
CASE "조교後랄스자위"
	RETURNF 9

CASE "요바이기승위"
	RETURNF 20
CASE "요바이Ａ기승위"
	RETURNF 21
CASE "요바이키스"
	RETURNF 22
CASE "添い寝"
	RETURNF 23
CASE "요바이복수"
	RETURNF 24
CASE "요바이기승위구상操作"
	RETURNF 31

CASE "아침펠라"
	RETURNF 40
CASE "아침파이즈리"
	RETURNF 41
CASE "아침기승위"
	RETURNF 42
CASE "아침の새댁플레이"
	RETURNF 43
CASE "아침키스"
	RETURNF 44
CASE "아침の모유搾り"
	RETURNF 45
CASE "아침풋잡"
	RETURNF 46
CASE "아침컨닐링구스"
	RETURNF 47
CASE "아침逆정상위"
	RETURNF 48

CASE "아침ＳＭ"
	RETURNF 60
CASE "아침구속기승위"
	RETURNF 61
CASE "아침구속Ａ기승위"
	RETURNF 62
CASE "아침구속역레이프"
	RETURNF 63
CASE "아침구속역애널"
	RETURNF 64

CASE "휴식：목욕"
	RETURNF 70
CASE "휴식：곁잠"
	RETURNF 71
CASE "휴식：다과"
	RETURNF 72
CASE "휴식：맛사지"
	RETURNF 73
CASE "휴식：귀파기"
	RETURNF 74
CASE "휴식：에로"
	RETURNF 75

CASE "청소펠라"
	RETURNF 80
CASE "청소컨닐링구스"
	RETURNF 81

CASE "自発脱ぎ"
	RETURNF 83

CASE "임신発覚"
	RETURNF 85
CASE "출산"
	RETURNF 86
CASE "子離れ"
	RETURNF 87

CASE "Ｖ바이브추가구상"
	RETURNF 90
CASE "Ａ바이브추가구상"
	RETURNF 91

CASE "플러그無し관장이벤트"
	RETURNF 93

;페니스を抜いた時の対応
CASE "질내사정후벌리기"
	RETURNF 95
CASE "질내사정후부끄러움"
	RETURNF 96
CASE "질내사정후정액퍼내기"
	RETURNF 97
CASE "질내사정후황홀"
	RETURNF 98

CASE "관내노출플레이出現"
	RETURNF 100
CASE "관내노출플레이見物"
	RETURNF 101
CASE "관내노출플레이見物人증가"
	RETURNF 102

;용간についてはSELECTCOM==141or142内で使用
CASE "용간구상개시"
	RETURNF 105
CASE "용간구상종료"
	RETURNF 106

CASE "피임약"
	RETURNF 107
CASE "긴급피임약"
	RETURNF 108
CASE "피임의부적"
	RETURNF 109
CASE "서약의두루마리"
	RETURNF 110
CASE "서약의반지"
	RETURNF 111

CASE "매각した"
	RETURNF 113

CASE "一晩해방の動向"
	RETURNF 115
CASE "하룻밤개방スキンシップ"
	RETURNF 116

CASE "비디오保存"
	RETURNF 120
CASE "비디오送付"
	RETURNF 121
CASE "비디오매각"
	RETURNF 122
CASE "비디오매각失敗"
	RETURNF 123

;이하は조교中などの이벤트経験など
CASE "처녀상실"
	RETURNF 130
CASE "Ａ처녀상실"
	RETURNF 131
CASE "Ｖ윤LV3돌파"
	RETURNF 132
CASE "욕정LV3돌파"
	RETURNF 133
CASE "치정LV3돌파"
	RETURNF 134
CASE "공포LV3돌파"
	RETURNF 135

CASE "Ｃ절정"
	RETURNF 140
CASE "Ｖ절정"
	RETURNF 141
CASE "Ａ절정"
	RETURNF 142
CASE "Ｂ절정"
	RETURNF 143
CASE "Ｍ절정"
	RETURNF 144
CASE "요도절정"
	RETURNF 145

CASE "사정했다"
	RETURNF 147
CASE "분유했다"
	RETURNF 148
CASE "절정방뇨"
	RETURNF 149

CASE "Ｃ안달남"
	RETURNF 150
CASE "Ｖ안달남"
	RETURNF 151
CASE "Ａ안달남"
	RETURNF 152
CASE "Ｂ안달남"
	RETURNF 153
CASE "Ｍ안달남"
	RETURNF 154
CASE "요도焦らし"
	RETURNF 155

CASE "사정안달남"
	RETURNF 157

CASE "Ｃ절정20회이상"
	RETURNF 160
CASE "Ｖ절정20회이상"
	RETURNF 161
CASE "Ａ절정20회이상"
	RETURNF 162
CASE "Ｂ절정20회이상"
	RETURNF 163
CASE "Ｍ절정20회이상"
	RETURNF 164
CASE "요도절정20回이상"
	RETURNF 165
CASE "고통각인Lv3취득"
	RETURNF 166
CASE "쾌락각인Lv3취득"
	RETURNF 167
CASE "굴복각인Lv3취득"
	RETURNF 168
CASE "반발각인Lv3취득"
	RETURNF 169

CASE "절정：입"
	RETURNF 170
CASE "절정：손"
	RETURNF 171
CASE "절정：Ｖ내사정"
	RETURNF 172
CASE "절정：Ａ내사정"
	RETURNF 173
CASE "절정：가슴"
	RETURNF 174
CASE "절정：다리"
	RETURNF 175
CASE "절정：스마타"
	RETURNF 176
CASE "절정：키스"
	RETURNF 177
CASE "절정：역컨닐링구스"
	RETURNF 178
CASE "절정：역레이프"
	RETURNF 179
CASE "절정：역애널"
	RETURNF 180
CASE "절정：역용간"
	RETURNF 181
CASE "절정：역Ａ용간"
	RETURNF 182
CASE "절정：안면기승"
	RETURNF 183
CASE "절정：애널봉사"
	RETURNF 184
CASE "절정：ＶＡ핥기"
	RETURNF 185
CASE "절정：파후파후"
	RETURNF 186
CASE "절정：조수"
	RETURNF 187
CASE "절정：정액세례"
	RETURNF 188
CASE "절정：보온병"
	RETURNF 189
CASE "절정：조교자가여자"
	RETURNF 190

CASE "에너지드레인"
	RETURNF 200
CASE "레벨ドレイン"
	RETURNF 201

CASE "삽입前폭발"
	RETURNF 205

CASE "하룻밤개방：스트립극장"
	RETURNF 300
CASE "하룻밤개방：글로리홀가게"
	RETURNF 301
CASE "하룻밤개방：주점"
	RETURNF 302
CASE "하룻밤개방：여관"
	RETURNF 303
CASE "하룻밤개방：집회소"
	RETURNF 304
CASE "하룻밤개방：비밀의 놀이터"
	RETURNF 305

CASE "하룻밤개방：모험자상대"
	RETURNF 320
CASE "하룻밤개방：청년상대"
	RETURNF 321
CASE "하룻밤개방：소년상대"
	RETURNF 322
CASE "하룻밤개방：여성상대"
	RETURNF 323
CASE "하룻밤개방：소녀상대"
	RETURNF 324

CASE "다방"
	RETURNF 340

;카페 이벤트
CASE "パンチラ"
CASE "セクハラ"
CASE "オムライス"
CASE "스커트めくり"
CASE "こけてパンもろ"
CASE "자위중독"
CASE "身体が화照る"
CASE "テーブル拭き１"
CASE "クリーム拭き取り"
CASE "あ～ん"
CASE "노팬티接손님"
CASE "飲み物溢してつまみ食い"
CASE "トイレでつまみ食い"
CASE "テーブル拭き２"
CASE "チップ"
CASE "財布忘れた상대をつまみ食い"
CASE "暇なときの시간潰し"
CASE "휴식"
CASE "査察"
CASE "눈에띄고싶어함"
CASE "레즈끼"
CASE "不遜な接손님"
CASE "모유"
CASE "아이"
CASE "폭유"
CASE "팬티見せつけ"
CASE "내성적"
CASE "양기"
CASE "음기"
CASE "쿨"
CASE "요정"
CASE "라미아"
CASE "머메이드"
CASE "カオス料理"
CASE "盗撮"
;CASE "꼬리"
CASE "가슴の谷間"
CASE "치료の名目でつまみ食い"
CASE "ハーブティー"
CASE "주인がトイレで"
CASE "お茶を淹れる"
CASE "コスプレ"

;기타
CASE "무지개의약"
CASE "おねだり：Ｖ피스트"
CASE "おねだり：Ｖ삽입"
CASE "おねだり：Ａ피스트"
CASE "おねだり：Ａ삽입"
CASE "おねだり：요도삽입"
CASE "おねだり：정액"
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF 0

;-------------------------------------------------
;@CEVENTはキャラクターごとの각종이벤트の記録を参照する関数. 経験済みなら１を, 未経験なら０を返す
;セットする時には@SET_CEVENTを用い、消去する際には@DEL_CEVENTを使う
;記録にはCSTR:10を놀림, CSTR:10 = 이벤트１/이벤트２/ と"/"を用いて区切る
;특수な이벤트群を作る際には, 頭に"이벤트名："とするのを推奨
;また、記述と操作の都合により、全角の"："と"＾"、半角の"/"の使用は禁止
;-------------------------------------------------
@CEVENT(ARGS, ARG)
#FUNCTION
#DIM LCOUNT
SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%/

;既に이벤트経験済みかを調べる
RETURNF STRCOUNT(CSTR:ARG:10, ARGS)


@SET_CEVENT, ARGS, ARG
#DIM LCOUNT

SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%/

;経験済みなら追加せずに終了
SIF STRCOUNT(CSTR:ARG:10, ARGS)
	RETURN 1

;経験していないなら追加
CSTR:ARG:10 = %CSTR:ARG:10%%ARGS%


@DEL_CEVENT, ARGS, ARG
#DIM LCOUNT

SIF ARG == 0 && TARGET
	ARG = TARGET

VARSET LOCALS
;이벤트ごとに分解する
SPLIT CSTR:ARG:10, "/", LOCALS

;一旦CSTR:10を初期化
CSTR:ARG:10 = 

FOR LCOUNT, 0, 100
	SIF LOCALS:LCOUNT == ""
		BREAK
	;経験済みだった
	SIF ARGS == LOCALS:LCOUNT
		CONTINUE

	;経験していないなら戻す
	CSTR:ARG:10 = %CSTR:ARG:10%%LOCALS:LCOUNT%/
NEXT

;-------------------------------------------------
;@CEVENTS(ARGS, ARG)はキャラARGが経験した이벤트 ARGS = 이벤트名：内容 の"内容"部分を文字列で返す関数
;当然のことながら複数記録されてる이벤트群に使うには適していない
;-------------------------------------------------
@CEVENTS(ARGS, ARG)
#FUNCTIONS
#DIM LCOUNT

SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%：

VARSET LOCALS
;이벤트ごとに分解する
SPLIT CSTR:ARG:10, "/", LOCALS

FOR LCOUNT, 0, 100
	SIF LOCALS:LCOUNT == ""
		BREAK
	;이벤트群ARGSでないならCONTINUE
	SIF STRCOUNT(LOCALS:LCOUNT, ARGS) == 0
		CONTINUE

	;이벤트名：内容 となっているので"内容"部分を抜き出す
	LOCALS:LCOUNT = %SUBSTRING(LOCALS:LCOUNT, STRLENS(ARGS), -1)%

	;특수な処理があるならここで
	IF STRCOUNT(LOCALS:LCOUNT, "CALLNAME_PLAYER")
		LOCALS:LCOUNT = %CALLNAME:PLAYER%%SUBSTRING(LOCALS:LCOUNT, STRLENS("CALLNAME_PLAYER"), -1)%
	ELSEIF STRCOUNT(LOCALS:LCOUNT, "CALLNAME_TARGET")
		LOCALS:LCOUNT = %CALLNAME:TARGET%%SUBSTRING(LOCALS:LCOUNT, STRLENS("CALLNAME_TARGET"), -1)%
	ELSEIF STRCOUNT(LOCALS:LCOUNT, "CALLNAME_MASTER")
		LOCALS:LCOUNT = %CALLNAME:MASTER%%SUBSTRING(LOCALS:LCOUNT, STRLENS("CALLNAME_MASTER"), -1)%
	ELSEIF ASSI && STRCOUNT(LOCALS:LCOUNT, "CALLNAME_ASSI")
		LOCALS:LCOUNT = %CALLNAME:ASSI%%SUBSTRING(LOCALS:LCOUNT, STRLENS("CALLNAME_ASSI"), -1)%
	ENDIF

	RETURNF LOCALS:LCOUNT
NEXT

LOCALS = 
RETURNF LOCALS

;-------------------------------------------------
;이벤트群ARGSを全て消去するのに使う
;例えば, ARGS = 조수 とすると, "조수："で始まる全ての이벤트記録を取り除く
;-------------------------------------------------
@DEL_CEVENT_GROUP, ARGS, ARG
#DIM LCOUNT
#DIMS MEMOS

SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%：

VARSET LOCALS
;이벤트ごとに分解する
SPLIT CSTR:ARG:10, "/", LOCALS

;一旦CSTR:10を初期化
CSTR:ARG:10 = 

FOR LCOUNT, 0, 100
	SIF LOCALS:LCOUNT == ""
		BREAK

	;이벤트群ARGSならCONTINUEさせて, 文字列を組み込まない
	;（LOCALS:LCOUNTの先頭からARGSの長さ分だけ抜き出したものがARGSならLOCALS:LCOUNTは이벤트群ARGS）
	SIF SUBSTRING(LOCALS:LCOUNT, 0, STRLENS(ARGS) ) == ARGS
		CONTINUE

	;이벤트群ARGSでないなら戻す
	CSTR:ARG:10 = %CSTR:ARG:10%%LOCALS:LCOUNT%/
NEXT

;-------------------------------------------------
;@DEL_CEVENT_GROUPのCSTR범용版
;CSTR:(ARG:1)に影響する
;-------------------------------------------------
@DEL_CSTR_GROUP, ARGS, ARG, ARG:1
#DIM LCOUNT

SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%：

VARSET LOCALS
;이벤트ごとに分解する
SPLIT CSTR:ARG:(ARG:1), "/", LOCALS

;一旦CSTR:(ARG:1)を初期化
CSTR:ARG:(ARG:1) = 

FOR LCOUNT, 0, 100
	SIF LOCALS:LCOUNT == ""
		BREAK

	;이벤트群ARGSならCONTINUEさせて, 文字列を組み込まない
	;（LOCALS:LCOUNTの先頭からARGSの長さ分だけ抜き出したものがARGSならLOCALS:LCOUNTは이벤트群ARGS）
	SIF SUBSTRING(LOCALS:LCOUNT, 0, STRLENS(ARGS) ) == ARGS
		CONTINUE

	;이벤트群ARGSでないなら戻す
	CSTR:ARG:(ARG:1) = %CSTR:ARG:(ARG:1)%%LOCALS:LCOUNT%/
NEXT


;-------------------------------------------------
;@DEL_CEVENT_GROUPの특수版
;ARGSに応じて複雑な処理をさせたい場合にはこっち
;-------------------------------------------------
@DEL_CEVENT_GROUP_EX, ARGS, ARG
#DIM LCOUNT

SIF ARG == 0 && TARGET
	ARG = TARGET

ARGS = %ARGS%：

VARSET LOCALS
;이벤트ごとに分解する
SPLIT CSTR:ARG:10, "/", LOCALS

;一旦CSTR:10を初期化
CSTR:ARG:10 = 

FOR LCOUNT, 0, 100
	SIF LOCALS:LCOUNT == ""
		BREAK

	;이벤트群ARGSに応じた種類ならCONTINUEさせて、文字列を組み込まない
	;記述が楽だから使ってるけど若干例外が発生する処理です実は。でもまぁ私が見ている限りは問題起きないはず
	SELECTCASE ARGS
	CASE "人称全部："
		SIF STRCOUNTS(LOCALS:LCOUNT, "一人称：", "一人称かな：", "一人称주인：", "一人称주인かな：", "一人称조수：", "一人称조수かな：")
			CONTINUE
		SIF STRCOUNTS(LOCALS:LCOUNT, "二人称：", "二人称かな：", "二人称주인：", "二人称주인かな：", "二人称조수：", "二人称조수かな：")
			CONTINUE
	CASE "一人称全部："
		SIF STRCOUNTS(LOCALS:LCOUNT, "一人称：", "一人称かな：", "一人称주인：", "一人称주인かな：", "一人称조수：", "一人称조수かな：")
			CONTINUE
	CASE "一人称："
		SIF STRCOUNTS(LOCALS:LCOUNT, "一人称：", "一人称かな：")
			CONTINUE
	CASE "一人称주인："
		SIF STRCOUNTS(LOCALS:LCOUNT, "一人称주인：", "一人称주인かな：")
			CONTINUE
	CASE "一人称조수："
		SIF STRCOUNTS(LOCALS:LCOUNT, "一人称조수：", "一人称조수かな：")
			CONTINUE
	CASE "二人称全部："
		SIF STRCOUNTS(LOCALS:LCOUNT, "二人称：", "二人称かな：", "二人称주인：", "二人称주인かな：", "二人称조수：", "二人称조수かな：")
			CONTINUE
	CASE "二人称："
		SIF STRCOUNTS(LOCALS:LCOUNT, "二人称：", "二人称かな：")
			CONTINUE
	CASE "二人称주인："
		SIF STRCOUNTS(LOCALS:LCOUNT, "二人称주인：", "二人称주인かな：")
			CONTINUE
	CASE "二人称조수："
		SIF STRCOUNTS(LOCALS:LCOUNT, "二人称조수：", "二人称조수かな：")
			CONTINUE
	CASEELSE
		;その他の場合には@DEL_CEVENT_GROUPと同じ挙動をする
		SIF SUBSTRING(LOCALS:LCOUNT, 0, STRLENS(ARGS) ) == ARGS
			CONTINUE
	ENDSELECT

	;問題ない部分は戻す
	CSTR:ARG:10 = %CSTR:ARG:10%%LOCALS:LCOUNT%/
NEXT


;-------------------------------------------------
;PREVPLAYは前のターンの인서트状況など
;-------------------------------------------------
@PREVPLAY(ARGS, ARG)
#FUNCTION
SIF ARG == 0 && TARGET
	ARG = TARGET

SELECTCASE ARGS
CASE "인서트"
	SIF GETBIT(TCVAR:ARG:151, 0) || GETBIT(TCVAR:ARG:151, 1) || GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "Ｖ인서트"
	SIF GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ인서트"
	SIF GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도인서트"
	SIF GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "정상위"
	SIF GETBIT(TCVAR:ARG:151, 2)
		RETURNF 1
CASE "Ｖ정상위"
	SIF GETBIT(TCVAR:ARG:151, 2) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ정상위"
	SIF GETBIT(TCVAR:ARG:151, 2) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도정상위"
	SIF GETBIT(TCVAR:ARG:151, 2) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "후배위"
	SIF GETBIT(TCVAR:ARG:151, 3)
		RETURNF 1
CASE "Ｖ후배위"
	SIF GETBIT(TCVAR:ARG:151, 3) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ후배위"
	SIF GETBIT(TCVAR:ARG:151, 3) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도후배위"
	SIF GETBIT(TCVAR:ARG:151, 3) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "굴곡위"
	SIF GETBIT(TCVAR:ARG:151, 4)
		RETURNF 1
CASE "Ｖ굴곡위"
	SIF GETBIT(TCVAR:ARG:151, 4) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ굴곡위"
	SIF GETBIT(TCVAR:ARG:151, 4) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도굴곡위"
	SIF GETBIT(TCVAR:ARG:151, 4) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "대면좌위"
	SIF GETBIT(TCVAR:ARG:151, 5)
		RETURNF 1
CASE "Ｖ대면좌위"
	SIF GETBIT(TCVAR:ARG:151, 5) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ대면좌위"
	SIF GETBIT(TCVAR:ARG:151, 5) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도대면좌위"
	SIF GETBIT(TCVAR:ARG:151, 5) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "배면좌위"
	SIF GETBIT(TCVAR:ARG:151, 6)
		RETURNF 1
CASE "Ｖ배면좌위"
	SIF GETBIT(TCVAR:ARG:151, 6) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ배면좌위"
	SIF GETBIT(TCVAR:ARG:151, 6) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도배면좌위"
	SIF GETBIT(TCVAR:ARG:151, 6) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1
CASE "기승위"
	SIF GETBIT(TCVAR:ARG:151, 7)
		RETURNF 1
CASE "Ｖ기승위"
	SIF GETBIT(TCVAR:ARG:151, 7) && GETBIT(TCVAR:ARG:151, 0)
		RETURNF 1
CASE "Ａ기승위"
	SIF GETBIT(TCVAR:ARG:151, 7) && GETBIT(TCVAR:ARG:151, 1)
		RETURNF 1
CASE "요도기승위"
	SIF GETBIT(TCVAR:ARG:151, 7) && GETBIT(TCVAR:ARG:151, 8)
		RETURNF 1

CASE "삽입中", "삽입中"
	SIF GETBIT(TCVAR:ARG:151, 10) || GETBIT(TCVAR:ARG:151, 11) || GETBIT(TCVAR:ARG:151, 12)
		RETURNF 1
CASE "Ｖ삽입中", "Ｖ삽입中"
	SIF GETBIT(TCVAR:ARG:151, 10)
		RETURNF 1
CASE "Ａ삽입中", "Ａ삽입中"
	SIF GETBIT(TCVAR:ARG:151, 11)
		RETURNF 1
CASE "요도삽입中"
	SIF GETBIT(TCVAR:ARG:151, 12)
		RETURNF 1

CASE "Ｇ스팟자극", "Ｇスポ責め"
	SIF GETBIT(TCVAR:ARG:151, 15)
		RETURNF 1

CASE "절정"
	SIF GETBIT(TCVAR:ARG:151, 20)
		RETURNF 1
CASE "방뇨"
	SIF GETBIT(TCVAR:ARG:151, 21)
		RETURNF 1
CASE "모유마시기"
	SIF GETBIT(TCVAR:ARG:151, 22)
		RETURNF 1

CASE "飲尿"
	SIF GETBIT(TCVAR:ARG:151, 30)
		RETURNF 1
CASE "질내욕뇨"
	SIF GETBIT(TCVAR:ARG:151, 31)
		RETURNF 1
CASE "자궁内욕뇨"
	SIF GETBIT(TCVAR:ARG:151, 32)
		RETURNF 1
CASE "온천관장"
	SIF GETBIT(TCVAR:ARG:151, 33)
		RETURNF 1
CASE "유内욕뇨"
	SIF GETBIT(TCVAR:ARG:151, 34)
		RETURNF 1
CASE "방광内욕뇨"
	SIF GETBIT(TCVAR:ARG:151, 35)
		RETURNF 1

CASE "청소펠라"
	SIF GETBIT(TCVAR:ARG:151, 40)
		RETURNF 1
CASE "Ａ청소펠라"
	SIF GETBIT(TCVAR:ARG:151, 41)
		RETURNF 1
CASE "尿청소펠라"
	SIF GETBIT(TCVAR:ARG:151, 42)
		RETURNF 1
CASE "치구청소펠라"
	SIF GETBIT(TCVAR:ARG:151, 43)
		RETURNF 1

CASE "청소컨닐링구스"
	SIF GETBIT(TCVAR:ARG:151, 45)
		RETURNF 1
CASE "尿청소컨닐링구스"
	SIF GETBIT(TCVAR:ARG:151, 46)
		RETURNF 1
CASE "치구청소컨닐링구스"
	SIF GETBIT(TCVAR:ARG:151, 47)
		RETURNF 1

CASE "청소Ａ핥기"
	SIF GETBIT(TCVAR:ARG:151, 50)
		RETURNF 1
CASEELSE
    THROW "%ARGS%" 를 찾을 수 없습니다.
ENDSELECT
RETURNF 0


@SET_PREVPLAY, ARG
LOCAL = 0
IF INSERT("인서트", ARG)
	SIF INSERT("Ｖ인서트", ARG)
		SETBIT LOCAL, 0
	SIF INSERT("Ａ인서트", ARG)
		SETBIT LOCAL, 1
	SIF INSERT("정상위", ARG)
		SETBIT LOCAL, 2
	SIF INSERT("후배위", ARG)
		SETBIT LOCAL, 3
	SIF INSERT("굴곡위", ARG)
		SETBIT LOCAL, 4
	SIF INSERT("대면좌위", ARG)
		SETBIT LOCAL, 5
	SIF INSERT("배면좌위", ARG)
		SETBIT LOCAL, 6
	SIF INSERT("기승위", ARG)
		SETBIT LOCAL, 7

	SIF INSERT("요도인서트", ARG)
		SETBIT LOCAL, 8
ENDIF

SIF INSERT("Ｖ삽입中", ARG)
	SETBIT LOCAL, 10
SIF INSERT("Ａ삽입中", ARG)
	SETBIT LOCAL, 11
SIF INSERT("요도삽입中", ARG)
	SETBIT LOCAL, 12

SELECTCASE ARG
CASE PLAYER
	SELECTCASE SELECTCOM
	CASE 60 TO 69, 177
		SETBIT LOCAL, 10
	CASE 70 TO 79
		SETBIT LOCAL, 11
	CASE 83
		SETBIT LOCAL, 12
	CASE 120 TO 124
		SETBIT LOCAL, 0
	CASE 125 TO 129
		SETBIT LOCAL, 1
	ENDSELECT

	SELECTCASE SELECTCOM
	CASE 120, 125
		SETBIT LOCAL, 2
	CASE 121, 126
		SETBIT LOCAL, 3
	CASE 122, 127
		SETBIT LOCAL, 7
	ENDSELECT
CASE TARGET
	SELECTCASE SELECTCOM
	CASE 60 TO 69, 177
		SETBIT LOCAL, 0
	CASE 70 TO 79
		SETBIT LOCAL, 1
	CASE 83
		SETBIT LOCAL, 8
	CASE 120 TO 124
		SETBIT LOCAL, 10
	CASE 125 TO 129
		SETBIT LOCAL, 11
	ENDSELECT

	SELECTCASE SELECTCOM
	CASE 60, 70
		SETBIT LOCAL, 2
	CASE 61, 71
		SETBIT LOCAL, 3
	CASE 62, 72
		SETBIT LOCAL, 4
	CASE 63, 73
		SETBIT LOCAL, 5
	CASE 64, 74
		SETBIT LOCAL, 6
	CASE 65, 75
		SETBIT LOCAL, 7
	ENDSELECT

	;Gスポ刺激
	SIF CHECK_COM("Ｇ스팟자극") || SELECTCOM == 66
		SETBIT LOCAL, 15
ENDSELECT

SIF COND("절정", ARG)
	SETBIT LOCAL, 20
SIF NOWEX:ARG:방뇨 || NOWEX:ARG:절정실금
	SETBIT LOCAL, 21
SIF COND("모유마시기플래그", ARG)
	SETBIT LOCAL, 22

SIF COND("飲尿플래그", ARG)
	SETBIT LOCAL, 30
SIF COND("질내욕뇨플래그", ARG)
	SETBIT LOCAL, 31
SIF COND("자궁内욕뇨플래그", ARG)
	SETBIT LOCAL, 32
SIF COND("온천관장플래그", ARG)
	SETBIT LOCAL, 33
SIF COND("유内욕뇨플래그", ARG)
	SETBIT LOCAL, 34
SIF COND("방광内욕뇨플래그", ARG)
	SETBIT LOCAL, 35

SIF COND("청소펠라플래그", ARG)
	SETBIT LOCAL, 40
;청소펠라플래그も立っているので, Ａ청소펠라を行った場合には40bitもＯＮになる
SIF COND("Ａ청소펠라플래그", ARG)
	SETBIT LOCAL, 41
SIF COND("尿청소펠라플래그", ARG)
	SETBIT LOCAL, 42
SIF COND("치구청소펠라플래그", ARG)
	SETBIT LOCAL, 43

SIF COND("청소컨닐링구스플래그", ARG)
	SETBIT LOCAL, 45
SIF COND("尿청소컨닐링구스플래그", ARG)
	SETBIT LOCAL, 46
SIF COND("치구청소컨닐링구스플래그", ARG)
	SETBIT LOCAL, 47

SIF COND("청소Ａ핥기플래그", ARG)
	SETBIT LOCAL, 50


TCVAR:ARG:151 = LOCAL

