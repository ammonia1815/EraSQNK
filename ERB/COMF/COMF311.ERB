@COM311
;멜티키스
;멜로나専用技. 상대を황홀にする. 内容的には아르카나が近い. 

PRINTL 멜티키스

CALL TRAIN_MESSAGE_B

SIF REFUSE_CHECK()
	RETURN 0

STR:0 = 멜티키스

RETURN 1

@FLAG_COM311, ARG
;몽마の입⇔조교자の입の汚れが移動
CALL EQ_STAIN, TARGET, PLAYER, 0, 0

@SOURCE_COM311, ARG
VARSET LOCAL

LOCAL:20 += 20
LOCAL:21 += 100

LOCAL:8 = COM_ORDER_STAIN("Ｍ", "Ｍ")*100 + 100

;상위몽마の時
IF TALENT:상위몽마
	LOCAL:13 = 50
;몽마の時
ELSEIF TALENT:몽마
	LOCAL:13 = 70
	LOCAL:14 = 5
ELSE
	LOCAL:13 = 100
	LOCAL:14 = 10
ENDIF

;汚れデータを元に, LOCAL:8は上で決定

;정애のソース
LOCAL:3 = 100

;開幕키스はちょっと보너스
SIF NUM("턴수") == 0
	LOCAL:3 += 400
;ABL:Ｍ감각をみる
LOCAL:18 = CALCF("Ｍ刺激", 1, 120)
;조교자の혀놀림をみる
LOCAL:18 = SOURCE_EXABL(LOCAL:18, 30, PLAYER)

;ABL:봉사정신をみる
SELECTCASE ABL:봉사정신
CASE 0
	LOCAL:4 = 50
CASE 1
	LOCAL:4 = 150
	LOCAL:5 = 50
CASE 2
	LOCAL:4 = 200
	LOCAL:5 = 100
CASE 3
	LOCAL:4 = 250
	LOCAL:5 = 180
CASE 4
	LOCAL:4 = 300
	LOCAL:5 = 300
CASEELSE
	LOCAL:4 = 350
	LOCAL:5 = 500
ENDSELECT

;ABL:기교をみる
SELECTCASE ABL:기교
CASE 0
	TIMES LOCAL:4 , 0.50
	TIMES LOCAL:5 , 0.50
CASE 1
	TIMES LOCAL:4 , 0.80
	TIMES LOCAL:5 , 0.80
CASE 2
CASE 3
	TIMES LOCAL:4 , 1.20
	TIMES LOCAL:5 , 1.20
CASE 4
	TIMES LOCAL:4 , 1.50
	TIMES LOCAL:5 , 1.50
CASEELSE
	TIMES LOCAL:4 , 2.00
	TIMES LOCAL:5 , 2.00
ENDSELECT

CALL CALC, "조교소스", LOCAL:0, LOCAL:1, LOCAL:2, LOCAL:3, LOCAL:4, LOCAL:5, LOCAL:6, LOCAL:7, LOCAL:8, LOCAL:9, LOCAL:10, LOCAL:11, LOCAL:12, LOCAL:13, LOCAL:14, LOCAL:15, LOCAL:16, LOCAL:17, LOCAL:18, LOCAL:19, LOCAL:20, LOCAL:21, ARG


@TRAIN_MESSAGE_COM311
PRINTFORML %CALLNAME:PLAYER%의 황홀한 입맞춤! 
;하드스킨状態なら元に戻す. フニャフニャにするかは考え中. 
IF STATE("하드스킨", TARGET)
	CALL REMOVE_STATE, TARGET, "하드스킨"
	PRINTFORML %조사처리(CALLNAME:TARGET,"는")% 부드러워 졌다! 
	PRINTFORMW %CALLNAME:TARGET%의 하드스킨 효과가 사라졌다! 
ELSE
	IF CHECK_COM("멜티키스", PLAYER)
		PRINTFORMW %조사처리(CALLNAME:TARGET,"는")% %CALLNAME:PLAYER%에게 흐물흐물하게 되었다! 
		CALL ADD_STATE, TARGET, "흐물흐물"
	ELSE
		PRINTFORMW 그러나 %CALLNAME:TARGET%에게는 효과가 없었다! 
	ENDIF
ENDIF

