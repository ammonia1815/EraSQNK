@SHOW_COM_ORDER_COM, ARG, ARG:1
;ARG:1が1なら텍스트が出力されない
TRYCALLFORM COM_ORDER_COM{ARG}, ARG:1
TCVAR:28 = RESULT

@PRINT_COM_ORDER_COM, ARGS, ARG, ARG:1, ARG:2
IF ARG == 0
	PRINTFORM %ARGS% = {ARG:1} 
	SELECTCASE ARG:1
	CASE IS < ARG:2
		PRINT <
	CASE ARG:2
		PRINT =
	CASEELSE
		PRINT >
	ENDSELECT
	PRINTFORMW  실행치{ARG:2}
ENDIF

;RESULT > 0で실행치CLEAR
RETURN MAX(ARG:1 - ARG:2 + 1, 0)


@COM_ORDER, ARG
VARSET LOCAL
;少しは早くなるか…？
IF TCVAR:27 && ARG
	LOCAL = TCVAR:27
	RETURN LOCAL
ENDIF
LOCALS = 
;몽마
IF TALENT:몽마 || TALENT:상위몽마
	LOCAL += 5
	LOCALS = %LOCALS%몽마(5)
ELSEIF TALENT:마왕의조각
	LOCAL -= 5
	LOCALS = %LOCALS%마왕의 조각(-5)
ELSE
	LOCALS = %LOCALS%몽마가 아님(0)
ENDIF

;ABL:순종
IF ABL:순종
	LOCAL += ABL:순종 * 4
	LOCALS = %LOCALS% + %ABLNAME:0%LV{ABL:순종}({ABL:순종 * 4})
ENDIF
;ABL:욕망
IF ABL:욕망
	LOCAL += ABL:욕망 * 1
	LOCALS = %LOCALS% + %ABLNAME:1%LV{ABL:욕망}({ABL:욕망 * 1})
ENDIF

;レズorＢＬ조교
IF (TALENT:PLAYER:여자 && TALENT:여자) || (TALENT:PLAYER:남자 && TALENT:남자)
	IF TALENT:PLAYER:여자 && TALENT:여자
		;ABL:레즈끼
		IF ABL:레즈끼
			LOCAL += ABL:레즈끼*2
			LOCALS = %LOCALS% + %ABLNAME:9%LV{ABL:레즈끼}({ABL:레즈끼*2})
		ELSE
			LOCAL -= 10
			LOCALS = %LOCALS% - 레즈끼없음(10)
		ENDIF
	ELSEIF TALENT:PLAYER:남자 && TALENT:남자
		;ABL:ＢＬ끼
		IF ABL:ＢＬ끼
			LOCAL += ABL:ＢＬ끼*2
			LOCALS = %LOCALS% + %ABLNAME:13%LV{ABL:ＢＬ끼}({ABL:ＢＬ끼*2})
		ELSE
			LOCAL -= 10
			LOCALS = %LOCALS% - ＢＬ끼없음(10)
		ENDIF
	ENDIF
	;TALENT:바이
	IF TALENT:바이
		LOCAL += 5
		LOCALS = %LOCALS% + %TALENTNAME:81%(5)
	ENDIF
	;호기심
	IF TALENT:호기심
		LOCAL += 7
		LOCALS = %LOCALS% + %TALENTNAME:23%(7)
	ENDIF
	;보수적
	IF TALENT:보수적
		LOCAL -= 13
		LOCALS = %LOCALS% - %TALENTNAME:24%(13)
	ENDIF
;ＢＬ조교
ELSE
	;호기심
	IF TALENT:호기심
		LOCAL += 5
		LOCALS = %LOCALS% + %TALENTNAME:23%(5)
	ENDIF
	;보수적
	IF TALENT:보수적
		LOCAL -= 10
		LOCALS = %LOCALS% - %TALENTNAME:24%(10)
	ENDIF
ENDIF

;刻印체크
IF MARK:고통각인
	LOCAL += MARK:고통각인 * 5
	LOCALS = %LOCALS% + %MARKNAME:0%LV{MARK:고통각인}({MARK:고통각인 * 5})
ENDIF

IF MARK:쾌락각인
	LOCAL += MARK:쾌락각인 * 1
	LOCALS = %LOCALS% + %MARKNAME:1%LV{MARK:쾌락각인}({MARK:쾌락각인 * 1})
ENDIF
IF MARK:정액각인 && TALENT:남자 == 0
	LOCAL += MARK:정액각인 * 1
	LOCALS = %LOCALS% + %MARKNAME:8%LV{MARK:정액각인}({MARK:정액각인 * 1})
ENDIF

IF TALENT:교만
	LOCAL:1 = 6
ELSEIF TALENT:프라이드낮음
	LOCAL:1 = 2
ELSE
	LOCAL:1 = 3
ENDIF
IF MARK:굴복각인
	LOCAL += MARK:굴복각인 * LOCAL:1
	LOCALS = %LOCALS% + %MARKNAME:2%LV{MARK:굴복각인}({MARK:굴복각인 * LOCAL:1})
ENDIF

SELECTCASE CONDS("기분")
CASE "상황살핌"
	LOCAL -= 15
	LOCALS = %LOCALS% - 상황살핌(15)
CASE "의욕없음"
	LOCAL -= 30
	LOCALS = %LOCALS% - 의욕없음(30)
ENDSELECT

IF TALENT:교만
	LOCAL:1 = 4
ELSEIF TALENT:프라이드낮음
	LOCAL:1 = 1
ELSE
	LOCAL:1 = 2
ENDIF
IF MARK:반발각인
	LOCAL -= MARK:반발각인 * 2 * LOCAL:1
	LOCALS = %LOCALS% - %MARKNAME:3%LV{MARK:반발각인}({MARK:반발각인 * 2 * LOCAL:1})
ENDIF

SELECTCASE ABS(CFLAG:2)
CASE IS < 20
	LOCAL:1 = 0
CASE IS < 50
	LOCAL:1 = 1
CASE IS < 90
	LOCAL:1 = 2
CASE IS < 150
	LOCAL:1 = 3
CASE IS < 220
	LOCAL:1 = 4
CASE IS < 300
	LOCAL:1 = 5
CASE IS < 780
	LOCAL:1 = (CFLAG:2-300)/80 + 6
CASE IS < 1500
	LOCAL:1 = (CFLAG:2-780)/120 + 12
CASE IS < 17500
	LOCAL:1 = (CFLAG:2-1500)/500 + 18
CASEELSE
	LOCAL:1 = 50
ENDSELECT

SIF CFLAG:2 < 0
	LOCAL:1 = (-LOCAL:1) * 2

SIF TALENT:교만 == 0 && LOCAL:1 > 0
	TIMES LOCAL:1 , 0.50

;호감도(보정のMAXは50)
IF LOCAL:1 && PLAYER == MASTER
	LOCAL += LOCAL:1
	IF LOCAL:1 > 0
		LOCALS = %LOCALS% + 호감도({LOCAL:1})
	ELSEIF LOCAL:1 < 0
		LOCALS = %LOCALS% - 호감도({-LOCAL:1})
	ENDIF
ENDIF

;PALAM:욕정
SELECTCASE PALAM:욕정
CASE IS < PALAMLV:1
	LOCAL:1 = 0
CASE IS < PALAMLV:2
	LOCAL:1 = 1
CASE IS < PALAMLV:3
	LOCAL:1 = 2
CASE IS < PALAMLV:4
	LOCAL:1 = 3
CASE IS < PALAMLV:5
	LOCAL:1 = 4
CASEELSE
	LOCAL:1 = 5
ENDSELECT
IF LOCAL:1
	LOCAL += LOCAL:1 * 1
	LOCALS = %LOCALS% + %PALAMNAME:5%LV{LOCAL:1}({LOCAL:1 * 1})
ENDIF

;PALAM:공포
SELECTCASE PALAM:공포
CASE IS < PALAMLV:1
	LOCAL:1 = 0
CASE IS < PALAMLV:2
	LOCAL:1 = 1
CASE IS < PALAMLV:3
	LOCAL:1 = 2
CASE IS < PALAMLV:4
	LOCAL:1 = 3
CASE IS < PALAMLV:5
	LOCAL:1 = 4
CASEELSE
	LOCAL:1 = 5
ENDSELECT
IF LOCAL:1
	LOCAL += LOCAL:1 * 2
	LOCALS = %LOCALS% + %PALAMNAME:10%LV{LOCAL:1}({LOCAL:1 * 2})
ENDIF

;반항적
IF TALENT:반항적
	LOCAL -= 10
	LOCALS = %LOCALS% - %TALENTNAME:11%(10)
ENDIF
;꿋꿋함
IF TALENT:꿋꿋함
	LOCAL -= 5
	LOCALS = %LOCALS% - %TALENTNAME:12%(5)
ENDIF
;솔직
IF TALENT:솔직
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:13%(5)
ENDIF
;교만(넘어뜨리기てるなら無視)
IF TALENT:교만 && TEQUIP:넘어뜨리기 == 0
	LOCAL -= 15
	LOCALS = %LOCALS% - %TALENTNAME:15%(15)
ENDIF
;프라이드낮음
IF TALENT:프라이드낮음
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:17%(5)
ENDIF
;눈에띄고싶어함
IF TALENT:눈에띄고싶어함
	LOCAL += 2
	LOCALS = %LOCALS% + %TALENTNAME:28%(2)
ENDIF
;억압
IF TALENT:억압
	LOCAL -= 10
	LOCALS = %LOCALS% - %TALENTNAME:32%(10)
ENDIF
;저항
IF TALENT:저항
	LOCAL -= 20
	LOCALS = %LOCALS% - %TALENTNAME:34%(20)
ENDIF

;호색
IF TALENT:호색
	LOCAL += 10
	LOCALS = %LOCALS% + %TALENTNAME:75%(10)
ENDIF

;음란
IF TALENT:음란
	LOCAL += 10
	LOCALS = %LOCALS% + %TALENTNAME:76%(10)
ENDIF

;남성혐오
IF TALENT:남성혐오 && TALENT:PLAYER:남자
	LOCAL -= 10
	LOCALS = %LOCALS% - %TALENTNAME:82%(10)
ENDIF

;상사상애
IF TALENT:상사상애 && PLAYER == MASTER
	LOCAL += 10
	LOCALS = %LOCALS% + %TALENTNAME:211%(10)
;연모
ELSEIF TALENT:연모 && PLAYER == MASTER
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:85%(5)
ENDIF

;망신
IF TALENT:망신 && PLAYER == MASTER
	LOCAL += 20
	LOCALS = %LOCALS% + %TALENTNAME:86%(20)
ENDIF

;드렁크
IF STATE("술주정", TARGET)
	LOCAL += 20
	LOCALS = %LOCALS% + 술주정(20)
ELSEIF STATE("드렁크", TARGET)
	LOCAL += 10
	LOCALS = %LOCALS% + 드렁크(10)
ENDIF

;마도인형
IF TALENT:마도인형
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:154%(5)
ENDIF

;서약
IF TALENT:서약 && PLAYER == MASTER
	LOCAL += 3
	LOCALS = %LOCALS% + %TALENTNAME:210%(3)
ENDIF

;기력０
IF BASE:기력 <= 0
	LOCAL -= 30
	LOCALS = %LOCALS% - 기력０(30)
ENDIF

;조교자の소질
;매혹
IF TALENT:PLAYER:매혹
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:91%(5)
ENDIF
;수수께끼의매력
IF TALENT:PLAYER:수수께끼의매력
	LOCAL += 5
	LOCALS = %LOCALS% + %TALENTNAME:92%(5)
ENDIF
IF TALENT:PLAYER:고무
	LOCAL += 10
	LOCALS = %LOCALS% + %TALENTNAME:118%(10)
ENDIF

;관내노출
IF TEQUIP:관내노출플레이
	LOCAL -= 5
	LOCALS = %LOCALS% - 관내노출(5)
ENDIF

;촬영중
IF TEQUIP:비디오카메라
	LOCAL -= 10
	LOCALS = %LOCALS% - 촬영중(10)
ENDIF

;야외플레이
IF TEQUIP:야외플레이
	IF COND("마을")
		LOCAL -= 10
		LOCALS = %LOCALS% - 야외(마을)(10)
	ELSE
		LOCAL -= 5
		LOCALS = %LOCALS% - 야외(5)
	ENDIF
ENDIF

;넘어뜨리기時の보너스を追加
IF TEQUIP:넘어뜨리기
	LOCAL += 10
	LOCALS = %LOCALS% + 쓰러뜨려지기 특별보너스(10)
ENDIF

;조수の소질
;고무
IF ASSI
	IF TALENT:ASSI:고무
		LOCAL += 10
		LOCALS = %LOCALS% + %TEXTS("조수の명칭")%の고무(10)
	ENDIF
ENDIF

;인센스
IF TEQUIP:MASTER:인센스
	LOCAL:1 = 0
	SELECTCASE GETBITS(TEQUIP:MASTER:인센스, 4, 6)
	CASE 1p4
		LOCAL:1 = 1
	CASE 1p5
		LOCAL:1 = 3
	CASE 1p6
		LOCAL:1 = 6
	ENDSELECT
	LOCALS = %LOCALS% + %TEXTS("인센스", TEQUIP:MASTER:인센스)%({LOCAL:1})
	LOCAL += LOCAL:1
ENDIF

;달콤한말効果発揮中
IF TEQUIP:달콤한말 >= 1 && TEQUIP:달콤한말 <= 8
	IF TEQUIP:달콤한말 <= 4
		LOCAL:1 = 7
	ELSE
		LOCAL:1 = 5
	ENDIF
	LOCAL += LOCAL:1
	LOCALS = %LOCALS% + 달콤한말({LOCAL:1})
ENDIF

;演奏(비가갠뒤의윤무곡)
IF TEQUIP:연주중 == 3
	IF TEQUIP:MASTER:연주중
		LOCAL += TALENT:MASTER:가창기능*3
		LOCALS = %LOCALS% + 비가갠뒤의윤무곡({TALENT:MASTER:가창기능*3})
	ELSE
		LOCAL += TALENT:ASSI:가창기능*3
		LOCALS = %LOCALS% + 비가갠뒤의윤무곡({TALENT:ASSI:가창기능*3})
	ENDIF
ENDIF

;무드
LOCAL:1 = MOOD() / 10
IF LOCAL:1
	LOCAL += LOCAL:1
	LOCALS = %LOCALS% + 무드({LOCAL:1})
ENDIF

;악세사리効果（실행치보정）
IF TALENT:PLAYER:실행치
	LOCAL += TALENT:PLAYER:실행치
	LOCALS = %LOCALS% + 악세사리 효과({TALENT:PLAYER:실행치})
ENDIF

;상성체크
SELECTCASE RELATION:(NO:PLAYER)
CASE 1 TO 30
	LOCAL -= 30
	LOCALS = %LOCALS% - %TEXTS("조수の명칭")%와 상성이 최악(30)
CASE 31 TO 50
	LOCAL -= 15
	LOCALS = %LOCALS% - %TEXTS("조수の명칭")%와 상성이 나쁨(15)
CASE 51 TO 80
	LOCAL -= 5
	LOCALS = %LOCALS% - %TEXTS("조수の명칭")%와 상성이 좋지 않음(5)
CASE 120 TO 149
	LOCAL += 5
	LOCALS = %LOCALS% + %TEXTS("조수の명칭")%와 상성이 나쁘지 않음(5)
CASE 150 TO 199
	LOCAL += 15
	LOCALS = %LOCALS% + %TEXTS("조수の명칭")%와 상성이 좋음(15)
CASE IS >= 200
	LOCAL += 30
	LOCALS = %LOCALS% + %TEXTS("조수の명칭")%와 상성이 최고(30)
ENDSELECT

IF ASSI
	SELECTCASE RELATION:(NO:ASSI)
	CASE 1 TO 30
		LOCAL -= 30
		LOCALS = %LOCALS% - 상성최악(30)
	CASE 31 TO 50
		LOCAL -= 15
		LOCALS = %LOCALS% - 상성나쁨(15)
	CASE 51 TO 80
		LOCAL -= 5
		LOCALS = %LOCALS% - 상성별로(5)
	CASE 120 TO 149
		LOCAL += 5
		LOCALS = %LOCALS% + 상성괜찮음(5)
	CASE 150 TO 199
		LOCAL += 15
		LOCALS = %LOCALS% + 상성좋음(15)
	CASE IS >= 200
		LOCAL += 30
		LOCALS = %LOCALS% + 상성최고(30)
	ENDSELECT
ENDIF

SIF ARG == 0
	PRINTFORM %LOCALS%

;@COMORDERでの실행치を記録する
TCVAR:27 = LOCAL

RETURN LOCAL


;ARGSにPLAYERの場所, ARGS:1にTARGETの場所
@COM_ORDER_STAIN(ARGS, ARGS:1)
#FUNCTION
#DIM STAIN_TARGET
#DIM STAIN_PLAYER

;불결무시
SIF TALENT:불결무시
	RETURNF 0

SELECTCASE ARGS
CASE "Ｍ", "손", "Ｐ", "Ｖ", "Ａ", "Ｂ"
	STAIN_PLAYER = STAIN:PLAYER:ARGS
CASEELSE
	RETURNF 0
ENDSELECT

SELECTCASE ARGS:1
CASE "Ｍ", "손", "Ｐ", "Ｖ", "Ａ", "Ｂ"
	STAIN_TARGET = STAIN:(ARGS:1)
CASEELSE
	STAIN_TARGET = 0
ENDSELECT

VARSET LOCAL
;愛液の汚れ(레즈끼で相殺)
IF CHECK_STAIN(STAIN_PLAYER, "Ｖ")
	LOCAL:0 = 17 - ABL:레즈끼*4
	SIF TALENT:남자
		LOCAL:0 -= 6
	SIF TALENT:냄새민감
		LOCAL:0 -= 2
	SIF COND("몽마")
		LOCAL:0 -= 5
	;場所自体がＶで목욕후ならペナ軽減
	SIF LOCAL:0 > 0 && ARGS == "Ｖ" && TEQUIP:PLAYER:목욕후
		LOCAL:0 /= 2
ENDIF
;페니스の汚れ
IF CHECK_STAIN(STAIN_PLAYER, "Ｐ")
	LOCAL:1 = 5
	SIF TALENT:남성혐오 && TALENT:PLAYER:남자
		LOCAL:1 += 10
	SIF TALENT:냄새민감
		LOCAL:1 -= 2
	;場所自体がＰで목욕후ならペナ軽減
	SIF LOCAL:1 > 0 && ARGS == "Ｐ" && TEQUIP:PLAYER:목욕후
		LOCAL:1 /= 2
	SIF CALCF("페니스好き度", TARGET) > 0
		LOCAL:1 -= CALCF("페니스好き度", TARGET)
ENDIF
;정액の汚れ(몽마, 정액중독で相殺)
IF CHECK_STAIN(STAIN_PLAYER, "정액")
	SIF ABL:정액중독
		LOCAL:2 = 6 - ABL:정액중독*2 - (TALENT:냄새민감 > 0)
	SIF COND("몽마") || TALENT:흡정체질
		LOCAL:2 -= 6
ENDIF
;애널の汚れ
IF CHECK_STAIN(STAIN_PLAYER, "Ａ")
	LOCAL:3 = 65 - ABL:마조끼*5 - ABL:새드끼*2
	SIF COND("몽마")
		LOCAL:3 -= 10
	SIF TALENT:애널광
		LOCAL:3 -= 20
	SIF TALENT:마조
		LOCAL:3 -= 10
	SIF TALENT:새드
		LOCAL:3 -= 10
	SIF TALENT:냄새민감 && TALENT:연모
		LOCAL:3 /= 2
	;場所自体がＡで목욕후ならペナ軽減
	SIF LOCAL:3 > 0 && ARGS == "Ａ" && TEQUIP:PLAYER:목욕후
		LOCAL:3 /= 2
ENDIF
;모유の汚れ
IF CHECK_STAIN(STAIN_PLAYER, "乳")
	LOCAL:4 += 1
	;유치で相殺
	SIF TALENT:유아／유아퇴행 || TALENT:유치
		LOCAL:4 -= 4
ENDIF
;尿の汚れ
IF CHECK_STAIN(STAIN_PLAYER, "尿")
	LOCAL:5 += 15
	SIF TALENT:냄새민감 && TALENT:연모
		LOCAL:5 /= 2
	SIF COND("몽마")
		LOCAL:5 -= 7
ENDIF
;촉수の汚れ
IF CHECK_STAIN(STAIN_PLAYER, "촉수")
	LOCAL:6 += 20
	SIF TALENT:냄새민감 && TALENT:연모
		LOCAL:6 /= 2
	;촉수경험,구지배자의자취
	SELECTCASE EXP:촉수경험 + TALENT:구지배자의자취*500
	CASE IS >= 500
		LOCAL:6 -= 20
	CASE IS >= 300
		LOCAL:6 -= 15
	CASE IS >= 100
		LOCAL:6 -= 10
	CASE IS >= 20
		LOCAL:6 -= 5
	ENDSELECT
ENDIF
;アソコの치구汚れ
IF CHECK_STAIN(STAIN_PLAYER, "Ｖ치구")
	LOCAL:20 = 20
	SIF TALENT:냄새민감 && TALENT:연모
		LOCAL:20 /= 2
	;場所自体がＶで목욕후ならペナ軽減
	SIF LOCAL:20 > 0 && ARGS == "Ｖ" && TEQUIP:PLAYER:목욕후
		LOCAL:20 /= 2
ENDIF
;ちんかすの汚れ
IF CHECK_STAIN(STAIN_PLAYER, "Ｐ치구")
	LOCAL:21 = 20
	SIF TALENT:남성혐오 && TALENT:PLAYER:남자
		LOCAL:21 += 10
	SIF TALENT:냄새민감 && TALENT:연모
		LOCAL:21 /= 2
	;場所自体がＰで목욕후ならペナ軽減
	SIF LOCAL:21 > 0 && ARGS == "Ｐ" && TEQUIP:PLAYER:목욕후
		LOCAL:21 /= 2
	IF CALCF("페니스好き度", TARGET) > 0
		LOCAL:21 /= CALCF("페니스好き度", TARGET)
		SIF TALENT:헌신
			LOCAL:21 -= 5
		SIF TALENT:도착적
			LOCAL:21 -= 5
	ENDIF
ENDIF


;もともとある汚れは無視する＆場所によっては汚れの強さＵＰ
SELECTCASE ARGS:1
CASE "Ｍ"
	LOCAL:3 = MIN(MULTIPLY(LOCAL:3, 150), LOCAL:3 + 20)
CASE "Ｐ"
	LOCAL:0 = 0
	LOCAL:1 = 0
	LOCAL:2 = 0
	LOCAL:5 = 0
CASE "Ｖ"
	LOCAL:0 = 0
	LOCAL:1 = 0
	LOCAL:3 = MIN(MULTIPLY(LOCAL:3, 200), LOCAL:3 + 50)
CASE "Ａ"
	LOCAL:0 = 0
	LOCAL:1 = 0
	LOCAL:3 = 0
CASE "요도"
	LOCAL:5 = 0
	LOCAL:3 = MIN(MULTIPLY(LOCAL:3, 200), LOCAL:3 + 50)
ENDSELECT

LOCAL = LOCAL:0 + LOCAL:1 + LOCAL:2 + LOCAL:3 + LOCAL:4 + LOCAL:5 + LOCAL:6 + LOCAL:20 + LOCAL:21

SIF TALENT:악취둔감
	LOCAL = MAX(DIVIDE(LOCAL, 200), LOCAL - 20)
SIF TALENT:악취민감
	LOCAL = MIN(MULTIPLY(LOCAL, 200), LOCAL + 20)

LOCAL = MAX(LOCAL, 0)

RETURNF LOCAL

